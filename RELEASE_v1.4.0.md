# FIT跑步数据分析器 v1.4.0 发布说明

**发布日期**: 2025-12-15  
**版本号**: v1.4.0

## 📦 发布说明

本次发布主要修复了IQ扩展字段的配速显示问题，并优化了字段选择器的用户体验，确保所有速度相关字段都能正确显示为配速格式。

## 🐛 Bug修复

### Bug #15: fractional_cadence字段在UI中不应显示
- **问题**: `fractional_cadence`字段作为独立字段在UI字段选择器中显示，但该字段是步频的小数部分，不应单独展示
- **修复**: 
  - 保持后端继续读取该字段，维持解析完整性
  - 从`available_fields`中排除`fractional_cadence`
  - UI字段选择器不再显示该字段
- **影响**: 字段选择器更简洁，用户体验改善

### Bug #14: IQ speed没有转成配速
- **问题**: IQ扩展字段中的`dr_speed`显示为"DR_速度 (m/s)"而非"DR_配速 (min/km)"
- **修复**: 
  - 更新`IQ_FIELD_LABELS`中`dr_speed`标签为"DR_配速 (min/km)"
  - 将`dr_speed`添加到`PACE_FIELDS`配速字段列表
  - 在`FIELD_UNIT_TYPES`中添加`dr_speed`的配速类型映射
- **影响**: 所有速度字段（标准+IQ扩展）现在都统一显示为配速，Y轴倒序排列

## ✨ 改进内容

### 配速字段一致性
- ✅ 所有速度相关字段统一显示为配速 (min/km)
- ✅ 标准字段：speed, enhanced_speed, avg_speed, max_speed
- ✅ IQ扩展字段：dr_speed
- ✅ 配速字段自动应用倒序Y轴（配速越小越快）

### 字段选择器优化
- ✅ 移除无实际数据的内部计算字段（fractional_cadence）
- ✅ 只显示对用户有意义的独立数据字段
- ✅ 提升字段选择器的可用性

### 用户体验提升
- ✅ 单活动详情页：dr_speed字段正确显示并转换为配速
- ✅ 多活动对比页：dr_speed字段正确对比
- ✅ 图表图例显示准确："活动名 - DR_配速 (min/km)"
- ✅ Y轴标签清晰，数值倒序排列符合跑步习惯

## 🔧 技术改进

### 后端优化
- 保持FIT文件解析的完整性，继续读取所有标准字段
- 通过`available_fields`过滤机制控制UI显示
- 前端选择性展示，后端数据完整

### 前端优化
- 完善配速字段配置（PACE_FIELDS, FIELD_UNIT_TYPES）
- 统一字段标签映射（IQ_FIELD_LABELS）
- 确保所有配速字段应用相同的显示规则

## 📊 数据验证

### fractional_cadence字段分析
- 所有活动中该字段值均为 0.0
- 无有效数据，确认不需要在UI展示
- 作为步频计算的内部字段处理

### dr_speed字段验证
- 单活动详情页：配速正确显示和转换
- 多活动对比页：图表正常绘制，Y轴倒序
- 数据转换准确，符合跑步配速习惯

## 🎯 下一步计划

- 考虑支持更多IQ扩展字段
- 优化字段分组显示
- 增强多活动对比功能

## 📝 备注

- 本次发布确保了速度相关字段的一致性
- 所有配速字段都遵循相同的显示和转换规则
- 字段选择器只显示对用户有价值的独立数据字段

---

**修复的Bug**:
- Bug #15: fractional_cadence字段在UI中不应显示
- Bug #14: IQ speed没有转成配速

**影响的文件**:
- `backend/fit_parser.py` - 字段收集逻辑
- `frontend/js/charts.js` - 配速字段配置和标签映射

**兼容性**:
- 完全向后兼容，现有数据无需迁移
- 新功能自动应用于所有活动
