# FITè·‘æ­¥æ•°æ®åˆ†æå™¨ ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ (SDD)

## å¼€å‘è§„èŒƒ (Development Guidelines)

### ç‰ˆæœ¬ç®¡ç†è§„èŒƒ (Version Management)

**é‡è¦åŸåˆ™ï¼šå•ä¸€ç‰ˆæœ¬æº (Single Source of Truth)**

æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯å¿…é¡»ä» `config.py` çš„ `VERSION` å¸¸é‡è¯»å–ï¼Œç¦æ­¢åœ¨å…¶ä»–æ–‡ä»¶ä¸­ç¡¬ç¼–ç ç‰ˆæœ¬å·ã€‚

**ç‰ˆæœ¬å·å®šä¹‰ä½ç½®ï¼š**
- ğŸ“ **å”¯ä¸€æ¥æº**: `config.py` â†’ `VERSION = "x.y.z"`

**è‡ªåŠ¨è¯»å–ç‰ˆæœ¬å·çš„ç»„ä»¶ï¼š**
- âœ… `build.py` - æ„å»ºè„šæœ¬è‡ªåŠ¨å¯¼å…¥ `from config import VERSION`
- âœ… `backend/main.py` - å¯åŠ¨ä¿¡æ¯å’Œ `/api/version` æ¥å£è¯»å–
- âœ… `frontend/js/app.js` - é€šè¿‡ API è·å–å¹¶æ˜¾ç¤ºåœ¨ UI
- âœ… `fitanalysis.spec` - æ‰‹åŠ¨åŒæ­¥æ›´æ–°ï¼ˆPyInstalleré™åˆ¶ï¼‰

**ç¦æ­¢çš„åšæ³•ï¼š**
- âŒ åœ¨å…¶ä»– Python æ–‡ä»¶ä¸­å®šä¹‰ç‰ˆæœ¬å·å¸¸é‡
- âŒ åœ¨ JavaScript ä¸­ç¡¬ç¼–ç ç‰ˆæœ¬å·
- âŒ åœ¨æ–‡æ¡£ä¸­æ‰‹åŠ¨ç»´æŠ¤ç‰ˆæœ¬å·ï¼ˆåº”å¼•ç”¨æˆ–è‡ªåŠ¨ç”Ÿæˆï¼‰

**ç‰ˆæœ¬å·æ ¼å¼ï¼š**
- éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ (Semantic Versioning)
- æ ¼å¼: `Major.Minor.Patch`
- ç¤ºä¾‹: `"1.6.0"`

---

### ç‰ˆæœ¬å‘å¸ƒå‰æ£€æŸ¥æ¸…å• (Pre-Release Checklist)

**âš ï¸ AGENTå¥‘çº¦ï¼šæ¯æ¬¡æ„å»ºå‰å¿…é¡»æ‰§è¡Œ `pre_build_check.py`**

åœ¨æ‰§è¡Œæ„å»º(build)ä¹‹å‰ï¼Œå¿…é¡»è¿è¡Œè‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬ï¼š

```bash
python pre_build_check.py
```

**å¥‘çº¦è¦æ±‚ï¼š**
1. **å¼ºåˆ¶æ‰§è¡Œ**: æ„å»ºå‰å¿…é¡»å…ˆè¿è¡Œæ£€æŸ¥è„šæœ¬ï¼Œç¡®ä¿æ‰€æœ‰æ£€æŸ¥é¡¹é€šè¿‡
2. **é›¶å®¹å¿**: ä»»ä½•æ£€æŸ¥å¤±è´¥éƒ½å¿…é¡»å…ˆä¿®å¤ï¼Œä¸å…è®¸å¸¦é—®é¢˜æ„å»º
3. **æ–‡æ¡£æ›´æ–°**: æ¯æ¬¡æ›´æ–° `agent.md` åï¼Œå¿…é¡»é‡æ–°è¿è¡Œæ£€æŸ¥è„šæœ¬ç¡®è®¤
4. **ç‰ˆæœ¬åŒæ­¥**: ç¡®ä¿ `config.py`, `fitanalysis.spec`, `agent.md` ç‰ˆæœ¬å·ä¸€è‡´

**æ£€æŸ¥è„šæœ¬è¦†ç›–èŒƒå›´ï¼š**

1. **ç‰ˆæœ¬å·æ£€æŸ¥** (Version Consistency):
   - âœ… `config.py` VERSION å®šä¹‰
   - âœ… `fitanalysis.spec` CFBundleShortVersionString åŒæ­¥
   - âœ… `fitanalysis.spec` CFBundleVersion åŒæ­¥
   - âœ… `RELEASE_v{VERSION}.md` æ–‡æ¡£å­˜åœ¨

2. **é…ç½®æ£€æŸ¥** (Configuration Validation):
   - âœ… `config.py` PORT = 8082
   - âœ… `config.py` HOST = 127.0.0.1 æˆ– localhost

3. **æ ¸å¿ƒæ¨¡å—æ£€æŸ¥** (Core Modules):
   - âœ… backend/main.py å­˜åœ¨
   - âœ… backend/device_mappings.py å­˜åœ¨å¹¶å¯å¯¼å…¥
   - âœ… backend/field_units.py å­˜åœ¨
   - âœ… backend/fit_parser.py å­˜åœ¨
   - âœ… backend/data_store.py å­˜åœ¨
   - âœ… backend/csv_exporter.py å­˜åœ¨
   - âœ… backend/models.py å­˜åœ¨
   - âœ… backend/hr_csv_merge.py å­˜åœ¨

4. **Frontendæ–‡ä»¶æ£€æŸ¥** (Frontend Files):
   - âœ… frontend/index.html å­˜åœ¨
   - âœ… frontend/css/styles.css å­˜åœ¨
   - âœ… frontend/js/app.js å­˜åœ¨
   - âœ… frontend/js/charts.js å­˜åœ¨
   - âœ… frontend/js/export.js å­˜åœ¨

5. **æ„å»ºé…ç½®æ£€æŸ¥** (Build Configuration):
   - âœ… fitanalysis.spec hiddenimports åŒ…å«æ‰€æœ‰æ ¸å¿ƒæ¨¡å—
   - âœ… build.py å­˜åœ¨
   - âœ… run.bat (Windows) å­˜åœ¨
   - âœ… run.sh (macOS) å­˜åœ¨

6. **æ–‡æ¡£æ£€æŸ¥** (Documentation):
   - âœ… README.md å­˜åœ¨
   - âœ… agent.md å­˜åœ¨
   - âœ… agent.md åŒ…å«å½“å‰ç‰ˆæœ¬è®°å½•

**é€šè¿‡æ ‡å‡†ï¼š**
- æ‰€æœ‰æ£€æŸ¥é¡¹å¿…é¡»å…¨éƒ¨é€šè¿‡ (100% pass rate)
- è„šæœ¬é€€å‡ºç ä¸º 0
- è¾“å‡ºæ˜¾ç¤º "âœ“ å¯ä»¥å®‰å…¨æ„å»º v{VERSION}"

**å¤±è´¥å¤„ç†ï¼š**
- ä¿®å¤æ‰€æœ‰å¤±è´¥é¡¹
- é‡æ–°è¿è¡Œæ£€æŸ¥è„šæœ¬
- ä¸å…è®¸è·³è¿‡ä»»ä½•æ£€æŸ¥é¡¹

---

### æ‰‹åŠ¨æ£€æŸ¥æ¸…å• (Manual Checklist - å¯é€‰)
ä»¥ä¸‹ä¸ºè¡¥å……æ€§æ‰‹åŠ¨æ£€æŸ¥ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬æœªè¦†ç›–çš„éƒ¨åˆ†ï¼š

1. **è·¨å¹³å°ä¸€è‡´æ€§**: 
   - âœ… ç¡®ä¿ Windows å’Œ macOS çš„åŠŸèƒ½å’Œ UI å®Œå…¨ä¸€è‡´
   - âœ… éªŒè¯è‹±æ–‡æ–‡æœ¬åœ¨ä¸¤ä¸ªå¹³å°ä¸Šæ˜¾ç¤ºæ­£ç¡®
   - âœ… ä½¿ç”¨ç›¸åŒçš„æµ‹è¯•æ•°æ®è¿›è¡ŒåŠŸèƒ½éªŒè¯

2. **ä»£ç æäº¤**:
   - âœ… æ‰€æœ‰å˜æ›´å·²æäº¤åˆ° Git
   - âœ… ç¡®ä¿æ— æœªè¿½è¸ªçš„é‡è¦æ–‡ä»¶

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®åç§°
FIT Running Data Analyzer (FITè·‘æ­¥æ•°æ®åˆ†æå™¨)

### 1.2 é¡¹ç›®æè¿°
ä¸€ä¸ªæœ¬åœ°Webåº”ç”¨ï¼Œç”¨äºè§£æGarminç­‰è¿åŠ¨è®¾å¤‡äº§ç”Ÿçš„FITæ–‡ä»¶ï¼Œæä¾›ç±»ä¼¼Garmin Connectçš„æ´»åŠ¨ç®¡ç†ä½“éªŒã€‚æ”¯æŒç§’çº§æ•°æ®è¶‹åŠ¿å›¾å±•ç¤ºã€æ¯åœˆæ±‡æ€»è¡¨æ ¼ã€åŒå­—æ®µå åŠ å¯¹æ¯”ã€å¤šæ´»åŠ¨å¯¹æ¯”åˆ†æï¼Œä»¥åŠçµæ´»çš„CSVå¯¼å‡ºåŠŸèƒ½ã€‚

**æ”¯æŒå¹³å°**: Windows, macOS

### 1.3 é¡¹ç›®ç›®æ ‡
- [x] è§£æFITæ–‡ä»¶ï¼Œè‡ªåŠ¨æå–æ‰€æœ‰å­—æ®µï¼ˆåŒ…æ‹¬IQ Podæ‰©å±•å­—æ®µå¦‚é¾™è±†è·‘æ­¥dr_å­—æ®µï¼‰
- [x] æœ¬åœ°å­˜å‚¨æ´»åŠ¨æ•°æ®ï¼Œæä¾›æ´»åŠ¨åˆ—è¡¨ç®¡ç†ï¼ˆæ’åºã€è¿‡æ»¤ã€åˆ†é¡µï¼‰
- [x] å±•ç¤ºç§’çº§è¶‹åŠ¿å›¾å’Œæ¯åœˆæ±‡æ€»æ•°æ®
- [x] æ”¯æŒåŒå­—æ®µå åŠ å¯¹æ¯”å’Œå¤šæ´»åŠ¨å¤šå­—æ®µçŸ©é˜µå¼å¯¹æ¯”ï¼ˆæ—¶é—´/è·ç¦»å¯¹é½å¯é€‰ï¼‰
- [x] Xè½´æ”¯æŒæ—¶é—´/è·ç¦»åˆ‡æ¢æ˜¾ç¤º
- [x] é…é€Ÿå­—æ®µè‡ªåŠ¨è½¬æ¢æ˜¾ç¤ºï¼ˆmin/kmï¼‰
- [x] æä¾›æ‚¬åœæ˜¾ç¤ºç»†èŠ‚æ•°æ®åŠŸèƒ½
- [x] æ”¯æŒåˆ†ç±»æˆ–åˆå¹¶å¯¼å‡ºCSV
- [x] è·¨å¹³å°æ”¯æŒï¼ˆWindowsã€macOSï¼‰
- [x] åŒå‡»å¯åŠ¨è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨

### 1.4 é¡¹ç›®èŒƒå›´
- **åŒ…å«åŠŸèƒ½**: FITæ–‡ä»¶ä¸Šä¼ è§£æã€æ´»åŠ¨å­˜å‚¨ç®¡ç†ã€è¶‹åŠ¿å›¾å¯è§†åŒ–ã€å­—æ®µå åŠ å¯¹æ¯”ã€å¤šæ´»åŠ¨å¯¹æ¯”ã€CSVå¯¼å‡ºã€Xè½´æ—¶é—´/è·ç¦»åˆ‡æ¢ã€è·¨å¹³å°æ‰“åŒ…
- **ä¸åŒ…å«åŠŸèƒ½**: ç”¨æˆ·è®¤è¯ã€äº‘ç«¯åŒæ­¥ã€åœ°å›¾è·¯çº¿å±•ç¤ºã€ç¤¾äº¤åˆ†äº«

## 2. éœ€æ±‚åˆ†æ

### 2.1 åŠŸèƒ½éœ€æ±‚
| éœ€æ±‚ID | åŠŸèƒ½æè¿° | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|--------|----------|--------|------|
| FR001 | ä¸Šä¼ FITæ–‡ä»¶å¹¶è§£æ | High | DONE |
| FR002 | åŠ¨æ€æå–æ‰€æœ‰å­—æ®µï¼ˆå«IQæ‰©å±•å­—æ®µã€dr_é¾™è±†å­—æ®µï¼‰ | High | DONE |
| FR003 | å­˜å‚¨æ´»åŠ¨æ•°æ®åˆ°æœ¬åœ°JSON | High | DONE |
| FR004 | æ´»åŠ¨åˆ—è¡¨å±•ç¤ºï¼ˆç±»Garmin Connectï¼‰ | High | DONE |
| FR005 | æ´»åŠ¨åˆ—è¡¨æ’åºï¼ˆæ—¥æœŸ/è·ç¦»/æ—¶é•¿/é…é€Ÿï¼‰ | Medium | DONE |
| FR006 | æ´»åŠ¨åˆ—è¡¨è¿‡æ»¤ï¼ˆæ—¥æœŸèŒƒå›´/è·ç¦»èŒƒå›´ï¼‰ | Medium | DONE |
| FR007 | ç§’çº§è¶‹åŠ¿å›¾å±•ç¤ºï¼ˆå¯é€‰å­—æ®µï¼‰ | High | DONE |
| FR008 | æ¯åœˆæ±‡æ€»è¡¨æ ¼å±•ç¤º | High | DONE |
| FR009 | åŒå­—æ®µå åŠ å¯¹æ¯”ï¼ˆåŒå›¾å¤štraceï¼‰ | High | DONE |
| FR010 | å¤šæ´»åŠ¨å¤šå­—æ®µçŸ©é˜µå¼å¯¹æ¯”ï¼ˆæ´»åŠ¨Ã—å­—æ®µï¼Œæ—¶é—´/è·ç¦»å¯¹é½å¯é€‰ï¼‰ | High | DONE |
| FR011 | é¼ æ ‡æ‚¬åœæ˜¾ç¤ºç»†èŠ‚æ•°æ® | High | DONE |
| FR012 | CSVå¯¼å‡ºï¼ˆmerged/categorizedæ¨¡å¼ï¼‰ | Medium | DONE |
| FR013 | Xè½´æ—¶é—´/è·ç¦»åˆ‡æ¢æŒ‰é’® | Medium | DONE |
| FR014 | é…é€Ÿå­—æ®µè‡ªåŠ¨è½¬æ¢æ˜¾ç¤º(min/km) | Medium | DONE |
| FR015 | elapsed_timeè‡ªåŠ¨è®¡ç®—ï¼ˆä»æ—¶é—´æˆ³æ¨ç®—ï¼‰ | Medium | DONE |
| FR016 | å­—æ®µåœ¨è¶‹åŠ¿å›¾ä¸Šæ˜¾ç¤ºåŠ ä¸Šå‰ç¼€ã€‚æ ¼å¼å¦‚DR_æ­¥é¢‘ã€‚ | Medium | DONE |
| FR017 | (å·²åˆå¹¶åˆ°FR010) å¤šæ´»åŠ¨å¤šå­—æ®µçŸ©é˜µå¼å¯¹æ¯” | High | DONE |
| FR018 | å¤šæ´»åŠ¨æ—¥æœŸæ—¶é—´æˆ³ | High | DONE |
| FR019 | ï¼ˆå–ä»£FR017å’ŒFR010ï¼‰å¤šæ´»åŠ¨å•å­—æ®µå¯¹æ¯”ï¼Œæ—¶é—´/è·ç¦»å¯é€‰ | High | DONE |
| FR020 | æ‰“å¼€ç½‘é¡µæ—¶å°±loadingæœ¬åœ°å­˜å‚¨çš„json æ´»åŠ¨ |High|DONE|
| FR021 | å­—æ®µå•ä½è½¬æ¢ç³»ç»Ÿé‡æ„ - é…ç½®åŒ–+æ™ºèƒ½æ£€æµ‹ | High | DONE |
| FR022 | ç»Ÿä¸€å­—æ®µé€‰æ‹©å™¨UIå¸ƒå±€ - å¤šæ´»åŠ¨é¡µé¢æ¨ªå‘ç½‘æ ¼æ˜¾ç¤º | Medium | DONE |
| FR023 | åŠ å…¥åˆå¹¶å¿ƒç‡csvçš„åŠŸèƒ½ | medium | DONE |
| FR024 | åˆå¹¶å¿ƒç‡CSVæ—¶åˆ›å»ºæ–°æ´»åŠ¨ï¼ˆè€Œéä¿®æ”¹åŸæ´»åŠ¨ï¼‰ | Medium | âœ… DONE |
| FR025 | IQé€Ÿåº¦å­—æ®µé…é€Ÿæ˜¾ç¤ºå¯¹é½ - ç»Ÿä¸€æ‰€æœ‰é€Ÿåº¦å­—æ®µå•ä½å’ŒYè½´ | High | âœ… DONE |
| FR026 | macOSè·¨å¹³å°æ”¯æŒ | High | âœ… DONE |
| FR027 | è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨åŠŸèƒ½ | Medium | âœ… DONE |
| FR028 | UIç‰ˆæœ¬å·æ˜¾ç¤º | Low | âœ… DONE |
| FR029 | ç«¯å£å˜æ›´8080->8082 | Low | âœ… DONE |
| FR030 | åº”ç”¨å›¾æ ‡æ”¯æŒ | Low | âœ… DONE |
| FR022 | ç»Ÿä¸€å­—æ®µé€‰æ‹©å™¨UIå¸ƒå±€ - å¤šæ´»åŠ¨é¡µé¢æ¨ªå‘ç½‘æ ¼æ˜¾ç¤º | Medium | DONE |
| FR023 | åŠ å…¥åˆå¹¶å¿ƒç‡csvçš„åŠŸèƒ½ | medium | DONE |
| FR024 | åˆå¹¶å¿ƒç‡CSVæ—¶åˆ›å»ºæ–°æ´»åŠ¨ï¼ˆè€Œéä¿®æ”¹åŸæ´»åŠ¨ï¼‰ | Medium | âœ… DONE |
| FR025 | IQé€Ÿåº¦å­—æ®µé…é€Ÿæ˜¾ç¤ºå¯¹é½ - ç»Ÿä¸€æ‰€æœ‰é€Ÿåº¦å­—æ®µå•ä½å’ŒYè½´ | High | âœ… DONE |


### 2.2 éåŠŸèƒ½éœ€æ±‚
- **æ€§èƒ½è¦æ±‚**: 10MBä»¥å†…FITæ–‡ä»¶è§£ææ—¶é—´<5ç§’ï¼Œå›¾è¡¨æ¸²æŸ“æµç•…
- **å¯ç”¨æ€§è¦æ±‚**: æœ¬åœ°è¿è¡Œï¼Œæ— éœ€ç½‘ç»œè¿æ¥
- **å®‰å…¨è¦æ±‚**: ä»…æœ¬åœ°è®¿é—®ï¼Œæ— éœ€è®¤è¯
- **å¯æ‰©å±•æ€§**: æ”¯æŒåŠ¨æ€å­—æ®µï¼Œæ— éœ€ç¡¬ç¼–ç IQ Podç±»å‹
- **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä»£ç æ³¨é‡Šå®Œæ•´

### 2.3 ç”¨æˆ·æ•…äº‹


#### US-001: åŸºç¡€æ•°æ®æŸ¥çœ‹
```
ä½œä¸º è·‘æ­¥çˆ±å¥½è€…
æˆ‘å¸Œæœ› ä¸Šä¼ æˆ‘çš„Garminæ‰‹è¡¨FITæ–‡ä»¶ï¼ŒæŸ¥çœ‹è¯¦ç»†çš„è·‘æ­¥æ•°æ®è¶‹åŠ¿å›¾
ä»¥ä¾¿ åˆ†ææˆ‘çš„è·‘æ­¥è¡¨ç°ï¼Œå¯¹æ¯”ä¸åŒè®­ç»ƒçš„æ•ˆæœ

éªŒæ”¶æ¡ä»¶:
- [x] å¯ä»¥ä¸Šä¼ .fitæ–‡ä»¶å¹¶è‡ªåŠ¨è§£æ
- [x] å¯ä»¥åœ¨è¶‹åŠ¿å›¾ä¸­é€‰æ‹©æ˜¾ç¤ºå¿ƒç‡ã€é…é€Ÿã€æ­¥é¢‘ç­‰å­—æ®µ
- [x] å¯ä»¥å åŠ ä¸¤ä¸ªå­—æ®µè¿›è¡Œå¯¹æ¯”
- [x] æ‚¬åœæ—¶æ˜¾ç¤ºè¯¥æ—¶é—´ç‚¹çš„æ‰€æœ‰æ•°æ®å€¼
- [x] å¯ä»¥é€‰æ‹©å¤šä¸ªæ´»åŠ¨è¿›è¡Œå¤šå­—æ®µçŸ©é˜µå¼å¯¹æ¯”åˆ†æ
- [x] å¯ä»¥å¯¼å‡ºæ•°æ®ä¸ºCSVæ–‡ä»¶
```
#### US-002: å•æ´»åŠ¨å¤šå­—æ®µå¯¹æ¯”
ä½œä¸º è·‘æ­¥çˆ±å¥½è€…
æˆ‘å¸Œæœ› åœ¨ä¸€ä¸ªæ´»åŠ¨è¯¦æƒ…ä¸­åŒæ—¶æŸ¥çœ‹å¤šä¸ªæŒ‡æ ‡çš„å˜åŒ–è¶‹åŠ¿
ä»¥ä¾¿ ç†è§£ä¸åŒæŒ‡æ ‡ä¹‹é—´çš„ç›¸å…³æ€§ï¼ˆå¦‚å¿ƒç‡å’Œé…é€Ÿçš„å…³ç³»ï¼‰

éªŒæ”¶æ¡ä»¶:
- [x] å¯ä»¥é€šè¿‡å¤é€‰æ¡†é€‰æ‹©å¤šä¸ªå­—æ®µï¼ˆå¿ƒç‡ã€æ­¥é¢‘ã€é…é€Ÿã€åŠŸç‡ç­‰ï¼‰
- [x] ä¸åŒå­—æ®µä½¿ç”¨ä¸åŒé¢œè‰²çš„æ›²çº¿æ˜¾ç¤º
- [x] ç›¸åŒå•ä½ç±»å‹çš„å­—æ®µå…±äº«Yè½´ï¼ˆå¦‚å¿ƒç‡å­—æ®µå…±äº«å·¦Yè½´ï¼‰
- [x] é…é€Ÿå­—æ®µè‡ªåŠ¨è½¬æ¢ä¸ºmin/kmæ ¼å¼æ˜¾ç¤º
- [x] æ”¯æŒXè½´åœ¨æ—¶é—´å’Œè·ç¦»ä¹‹é—´åˆ‡æ¢
- [x] æ‚¬åœæ—¶åŒæ—¶æ˜¾ç¤ºæ‰€æœ‰é€‰ä¸­å­—æ®µçš„å½“å‰å€¼

#### US-003: å¤šæ´»åŠ¨å¤šå­—æ®µçŸ©é˜µå¼å¯¹æ¯”ï¼ˆå½“å‰åŠŸèƒ½ - å®Œæˆ- å·²å˜æ›´ - å‚çœ‹US-004ï¼‰
ä½œä¸º è·‘æ­¥çˆ±å¥½è€…
æˆ‘å¸Œæœ› åŒæ—¶å¯¹æ¯”å¤šæ¬¡è®­ç»ƒçš„å¤šä¸ªæŒ‡æ ‡
ä»¥ä¾¿ å…¨é¢è¯„ä¼°è®­ç»ƒè´¨é‡å·®å¼‚ï¼ˆå¦‚å¯¹æ¯”3æ¬¡é—´æ­‡è·‘çš„å¿ƒç‡ã€é…é€Ÿã€æ­¥é¢‘å˜åŒ–ï¼‰

ä¸šåŠ¡ä»·å€¼:

å¯ä»¥æ¨ªå‘å¯¹æ¯”ä¸åŒè®­ç»ƒæ—¥çš„ç›¸åŒæŒ‡æ ‡ï¼ˆå¦‚3æ¬¡è®­ç»ƒçš„å¿ƒç‡æ›²çº¿ï¼‰
å¯ä»¥çºµå‘å¯¹æ¯”åŒä¸€è®­ç»ƒçš„ä¸åŒæŒ‡æ ‡ï¼ˆå¦‚è®­ç»ƒ1çš„å¿ƒç‡+é…é€Ÿ+æ­¥é¢‘ï¼‰
å‘ç°è®­ç»ƒæ¨¡å¼å’Œç“¶é¢ˆï¼ˆå¦‚æŸæ¬¡è®­ç»ƒå¿ƒç‡é«˜ä½†é…é€Ÿæ…¢ï¼Œè¯´æ˜çŠ¶æ€ä¸ä½³ï¼‰

éªŒæ”¶æ¡ä»¶:
- [x] å¯¹æ¯”è§†å›¾æ”¯æŒå¤šå­—æ®µå¤é€‰æ¡†é€‰æ‹©ï¼ˆç±»ä¼¼å•æ´»åŠ¨è¯¦æƒ…è§†å›¾ï¼‰
- [x] é»˜è®¤å‹¾é€‰"é…é€Ÿ"å­—æ®µï¼ˆspeedï¼‰
- [x] å­—æ®µåˆ—è¡¨ä¸ºæ‰€æœ‰é€‰ä¸­æ´»åŠ¨çš„å­—æ®µå¹¶é›†
- [x] å¦‚æœæŸæ´»åŠ¨ç¼ºå°‘æŸå­—æ®µï¼Œè¯¥æ›²çº¿åœ¨ç¼ºå¤±éƒ¨åˆ†æ˜¾ç¤ºä¸ºé—´æ–­
- [x] å›¾è¡¨æ˜¾ç¤º"æ´»åŠ¨æ•°Ã—å­—æ®µæ•°"æ¡æ›²çº¿ï¼ˆå¦‚3æ´»åŠ¨Ã—2å­—æ®µ=6æ¡æ›²çº¿ï¼‰
- [x] æ›²çº¿å‘½åæ ¼å¼ï¼š"æ´»åŠ¨å - å­—æ®µå"ï¼ˆå¦‚"æ™¨è·‘ - å¿ƒç‡"ï¼‰
- [x] é¢œè‰²æ–¹æ¡ˆï¼šæ¯ä¸ªæ´»åŠ¨ä½¿ç”¨ä¸€ç»„é¢œè‰²ï¼Œè¯¥æ´»åŠ¨çš„ä¸åŒå­—æ®µä½¿ç”¨è¯¥ç»„å†…çš„ä¸åŒé¢œè‰²
- [x] ç›¸åŒå•ä½ç±»å‹çš„å­—æ®µå…±äº«Yè½´ï¼ˆå¦‚æ‰€æœ‰å¿ƒç‡å­—æ®µå…±äº«å·¦Yè½´ï¼‰
- [x] é…é€Ÿå­—æ®µè‡ªåŠ¨è½¬æ¢ä¸ºmin/kmæ ¼å¼
- [x] é™åˆ¶ï¼šæœ€å¤šåŒæ—¶å¯¹æ¯”10ä¸ªæ´»åŠ¨ï¼Œæœ€å¤šé€‰æ‹©5ä¸ªå­—æ®µ
- [x] æ˜¾ç¤ºå·²é€‰æ´»åŠ¨åˆ—è¡¨ï¼Œæ¯ä¸ªæ´»åŠ¨å¸¦é¢œè‰²æ ‡è¯†ç‚¹
- [x] å­—æ®µé€‰æ‹©å™¨é¡¶éƒ¨æç¤ºï¼š"å·²é€‰ X/5 ä¸ªå­—æ®µ"
- [x] å¤šå­—æ®µåŠ è½½ï¼Œlegendéœ€è¦åŠ å…¥æ—¥æœŸæ—¶é—´æˆ³æ¥åŒºåˆ†ï¼Œç›´æ¥å‰ç¼€å°±å¯ä»¥ã€‚ä¾‹å¦‚20251208_546218476ã€‚ä¸èƒ½ç¡¬ç¼–ç ï¼Œä»fitä¸­è¯»å–ã€‚

æŠ€æœ¯çº¦æŸ:

  ä½¿ç”¨é¢œè‰²æ–¹æ¡ˆAï¼šæ¯ä¸ªæ´»åŠ¨ä¸€ç»„é¢œè‰²ï¼ˆå¦‚æ´»åŠ¨1ç”¨çº¢è‰²ç³»ï¼Œæ´»åŠ¨2ç”¨è“è‰²ç³»ï¼‰
  å­—æ®µå–å¹¶é›†ï¼šæ˜¾ç¤ºæ‰€æœ‰æ´»åŠ¨ä¸­å‡ºç°è¿‡çš„ä»»ä½•å­—æ®µ
  Xè½´å¯¹é½ä¿æŒå½“å‰çš„radioæŒ‰é’®æ–¹å¼ï¼ˆæ—¶é—´/è·ç¦»äº’æ–¥é€‰æ‹©ï¼‰
  åç«¯API /api/compare å·²æ”¯æŒå¤šå­—æ®µï¼Œæ— éœ€ä¿®æ”¹

ç”¨æˆ·æµç¨‹:

  åœ¨æ´»åŠ¨åˆ—è¡¨å‹¾é€‰2-10ä¸ªæ´»åŠ¨
  ç‚¹å‡»"å¯¹æ¯”é€‰ä¸­æ´»åŠ¨"æŒ‰é’®
  è¿›å…¥å¯¹æ¯”è§†å›¾ï¼Œçœ‹åˆ°é€‰ä¸­æ´»åŠ¨åˆ—è¡¨ï¼ˆå¸¦é¢œè‰²ç‚¹ï¼‰
  çœ‹åˆ°å­—æ®µå¤é€‰æ¡†åŒºåŸŸï¼Œé»˜è®¤å‹¾é€‰"é…é€Ÿ"
  å‹¾é€‰æ›´å¤šå­—æ®µï¼ˆå¦‚å¿ƒç‡ã€æ­¥é¢‘ï¼‰ï¼Œæœ€å¤š5ä¸ª
  é€‰æ‹©å¯¹é½æ–¹å¼ï¼ˆæ—¶é—´/è·ç¦»ï¼‰
  å›¾è¡¨è‡ªåŠ¨æ›´æ–°ï¼ˆ300msé˜²æŠ–å»¶è¿Ÿï¼‰
  æŸ¥çœ‹å¤šæ´»åŠ¨Ã—å¤šå­—æ®µçš„çŸ©é˜µå¼å¯¹æ¯”å›¾è¡¨
  æ‚¬åœæŸ¥çœ‹å…·ä½“æ•°å€¼
  å–æ¶ˆå‹¾é€‰æŸäº›å­—æ®µæˆ–æ´»åŠ¨ï¼Œå›¾è¡¨è‡ªåŠ¨æ›´æ–°
ç¤ºä¾‹åœºæ™¯:

  å¯¹æ¯”3æ¬¡10kmè·‘çš„é…é€Ÿ+å¿ƒç‡ï¼Œçœ‹å“ªæ¬¡è®­ç»ƒæ•ˆç‡æœ€é«˜
  å¯¹æ¯”5æ¬¡é—´æ­‡è·‘çš„æ­¥é¢‘+è§¦åœ°æ—¶é—´ï¼Œè¯„ä¼°è·‘æ­¥æŠ€æœ¯æ”¹å–„
  å¯¹æ¯”2æ¬¡é•¿è·ç¦»çš„åŠŸç‡+å¿ƒç‡+é…é€Ÿï¼Œåˆ†æé…é€Ÿç­–ç•¥å·®å¼‚

#### US-004: å¤šæ´»åŠ¨å•å­—æ®µå¯¹æ¯”ï¼ˆâœ…å·²å®Œæˆï¼‰
ä½œä¸º è·‘æ­¥çˆ±å¥½è€…
æˆ‘å¸Œæœ› åŒæ—¶å¯¹æ¯”å¤šæ¬¡è®­ç»ƒçš„å•ä¸ªæŒ‡æ ‡
ä»¥ä¾¿ å…¨é¢è¯„ä¼°è®­ç»ƒè´¨é‡å·®å¼‚ï¼ˆå¦‚å¯¹æ¯”3æ¬¡é—´æ­‡è·‘çš„å¿ƒç‡å˜åŒ–ï¼‰

éªŒæ”¶æ¡ä»¶:
- [x] å¯¹æ¯”è§†å›¾æ”¯æŒå•å­—æ®µå•é€‰æ¡†é€‰æ‹©ï¼ˆradioè€Œécheckboxï¼‰
- [x] é»˜è®¤å‹¾é€‰"é…é€Ÿ"å­—æ®µï¼ˆspeedï¼‰
- [x] å­—æ®µåˆ—è¡¨ä¸ºæ‰€æœ‰é€‰ä¸­æ´»åŠ¨çš„å­—æ®µå¹¶é›†
- [x] å¦‚æœæŸæ´»åŠ¨ç¼ºå°‘æŸå­—æ®µï¼Œè¯¥æ›²çº¿åœ¨ç¼ºå¤±éƒ¨åˆ†æ˜¾ç¤ºä¸ºé—´æ–­
- [x] å›¾è¡¨æ˜¾ç¤º"æ´»åŠ¨æ•°Ã—1"æ¡æ›²çº¿ï¼ˆæ¯ä¸ªæ´»åŠ¨ä¸€æ¡æ›²çº¿ï¼‰
- [x] æ›²çº¿å‘½åæ ¼å¼ï¼š"æ—¥æœŸ_æ–‡ä»¶ID - å­—æ®µå"ï¼ˆå¦‚"20251208_546564164 - å¿ƒç‡"ï¼‰
- [x] é¢œè‰²æ–¹æ¡ˆï¼šæ¯ä¸ªæ´»åŠ¨ä½¿ç”¨ä¸åŒé¢œè‰²
- [x] å•ä¸€å­—æ®µä½¿ç”¨å•Yè½´
- [x] é…é€Ÿå­—æ®µè‡ªåŠ¨è½¬æ¢ä¸ºmin/kmæ ¼å¼å¹¶åè½¬Yè½´
- [x] é™åˆ¶ï¼šæœ€å¤šåŒæ—¶å¯¹æ¯”10ä¸ªæ´»åŠ¨
- [x] æ˜¾ç¤ºå·²é€‰æ´»åŠ¨åˆ—è¡¨ï¼Œæ¯ä¸ªæ´»åŠ¨å¸¦é¢œè‰²æ ‡è¯†ç‚¹
- [x] å­—æ®µé€‰æ‹©åªå…è®¸å•ä¸ªï¼Œä½¿ç”¨radioå•é€‰
- [x] legendåŒ…å«æ—¥æœŸæ—¶é—´æˆ³å‰ç¼€ã€‚æ ¼å¼ï¼šYYYYMMDD_FileID
- [x] å›¾è¡¨æ ‡é¢˜æ˜¾ç¤ºå½“å‰å¯¹æ¯”çš„å­—æ®µå

å®ç°è¯´æ˜ï¼š
  1. å‰ç«¯ä¿®æ”¹ï¼šindex.htmlæ›´æ–°UIï¼Œcharts.jsæ”¹ä¸ºå•é€‰é€»è¾‘
  2. åç«¯æ— éœ€ä¿®æ”¹ï¼š/api/compareå·²æ”¯æŒ
  3. ä¼˜åŒ–ï¼šç§»é™¤å­—æ®µæ•°é‡é™åˆ¶é€»è¾‘ï¼Œç®€åŒ–Yè½´é…ç½®

#### US-005: æ‰“å¼€ç½‘é¡µæ—¶å°±loadingæœ¬åœ°å­˜å‚¨çš„json æ´»åŠ¨ï¼ˆâœ…å·²å®Œæˆï¼‰
ä½œä¸º è·‘æ­¥çˆ±å¥½è€…
æˆ‘å¸Œæœ› æ‰“å¼€ç½‘é¡µæ—¶å°±loadingå·²ç»åœ¨æœ¬åœ°å­˜å‚¨çš„æ´»åŠ¨
ä»¥ä¾¿ æµè§ˆæ‰€æœ‰çš„æ´»åŠ¨è®°å½•å’Œæ–¹ä¾¿æ¯”è¾ƒ

éªŒæ”¶æ¡ä»¶:
- [x] å‰ç«¯è‡ªåŠ¨åŠ è½½ - é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è°ƒç”¨ /api/activities æ¥å£
- [x] æ— éœ€ç”¨æˆ·ç‚¹å‡»ä»»ä½•æŒ‰é’®å³å¯çœ‹åˆ°æ´»åŠ¨åˆ—è¡¨
- [x] æ‰€æœ‰æœ¬åœ°å­˜å‚¨çš„æ´»åŠ¨éƒ½æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
- [x] æ´»åŠ¨ä¿¡æ¯å®Œæ•´ï¼šæ—¥æœŸã€åç§°ã€è·ç¦»ã€æ—¶é•¿ã€é…é€Ÿã€å¿ƒç‡
- [x] æ˜¾ç¤ºé¡ºåºé»˜è®¤æŒ‰æ—¥æœŸé™åºæ’åˆ—
- [x] ç©ºçŠ¶æ€å¤„ç†ï¼šé¦–æ¬¡æ‰“å¼€ï¼ˆæ— æ´»åŠ¨ï¼‰æ—¶æ˜¾ç¤º"æš‚æ— æ´»åŠ¨æ•°æ®"
- [x] åŠ è½½çŠ¶æ€åé¦ˆï¼šæ•°æ®åŠ è½½ä¸­æ˜¾ç¤º"åŠ è½½ä¸­..."
- [x] æ”¯æŒåˆ†é¡µï¼Œé¦–å±åŠ è½½å‰20æ¡
- [x] åˆ†é¡µä¿¡æ¯æ˜¾ç¤ºï¼š"ç¬¬ X / Y é¡µ (å…± Z æ¡)"

å®ç°è¯´æ˜ï¼š
  1. DOMContentLoadedäº‹ä»¶ä¸­è°ƒç”¨showLoadingState()å’ŒloadActivities()
  2. showLoadingState()æ˜¾ç¤º"åŠ è½½ä¸­..."å ä½ç¬¦
  3. loadActivities()è‡ªåŠ¨è°ƒç”¨APIå¹¶æ¸²æŸ“è¡¨æ ¼
  4. ç©ºæ•°æ®æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
  5. æ”¯æŒæ’åºã€è¿‡æ»¤ã€åˆ†é¡µåŠŸèƒ½

æµ‹è¯•ç»“æœï¼š
  - âœ… é¡µé¢æ‰“å¼€è‡ªåŠ¨åŠ è½½7ä¸ªæ´»åŠ¨
  - âœ… æ‰€æœ‰ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
  - âœ… åˆ†é¡µä¿¡æ¯å‡†ç¡®

æŠ€æœ¯å®ç°æ£€æŸ¥ç‚¹ï¼š
- [x] åç«¯APIå°±ç»ªï¼š/api/activities æ¥å£å·²å­˜åœ¨ä¸”è¿”å›æ­£ç¡®æ ¼å¼
- [x] æ¥å£æ”¯æŒåˆ†é¡µå‚æ•°ï¼ˆpage, limitï¼‰
- [x] å‰ç«¯ä»£ç ç»“æ„ï¼šapp.js ä½¿ç”¨ DOMContentLoaded è§¦å‘è‡ªåŠ¨åŠ è½½
- [x] æ•°æ®æŒä¹…åŒ–ï¼šdata/index.json å’Œ activities/ ç›®å½•æ­£ç¡®ç»´æŠ¤

æµ‹è¯•åœºæ™¯éªŒè¯ï¼š
- âœ… åœºæ™¯1ï¼šå·²æœ‰7ä¸ªæ´»åŠ¨ï¼Œæ­£å¸¸åŠ è½½
- âœ… åœºæ™¯2ï¼šåˆ†é¡µæ˜¾ç¤ºæ­£ç¡®
- âœ… åœºæ™¯3ï¼šç©ºçŠ¶æ€æç¤ºæ­£å¸¸
- âœ… åœºæ™¯4ï¼šæ€§èƒ½ç¨³å®š
      åœºæ™¯2ï¼šå·²æœ‰10ä¸ªæ´»åŠ¨ï¼Œæ­£å¸¸åŠ è½½
      åœºæ™¯3ï¼šå·²æœ‰100ä¸ªæ´»åŠ¨ï¼Œåˆ†é¡µåŠ è½½
      åœºæ™¯4ï¼šindex.json æ–‡ä»¶æŸå
      åœºæ™¯5ï¼šåç«¯æœåŠ¡æœªå¯åŠ¨
      åœºæ™¯6ï¼šåˆ·æ–°é¡µé¢å¤šæ¬¡ï¼Œç¡®è®¤æ€§èƒ½ç¨³å®š
      å¤‡æ³¨ï¼šæµ‹è¯•å®Œæˆååˆ é™¤æµ‹è¯•æ•°æ®

#### US-006: ç¦»çº¿å¿ƒç‡CSVåˆå¹¶åˆ°æ´»åŠ¨ï¼ˆğŸš§è¿›è¡Œä¸­ï¼‰
ä½œä¸º è·‘æ­¥çˆ±å¥½è€…
æˆ‘å¸Œæœ› å°†ä¸€æ¬¡ç¦»çº¿å¿ƒç‡CSVæ•°æ®åˆå¹¶è¿›ä¸€ä¸ªå·²å¯¼å…¥çš„FITæ´»åŠ¨
ä»¥ä¾¿ åœ¨ä¸ç ´åç°æœ‰å¯¹æ¯”åŠŸèƒ½çš„å‰æä¸‹ï¼ŒæŠŠå¤–éƒ¨å¿ƒç‡è½¨è¿¹ä½œä¸ºâ€œæ‰©å±•å­—æ®µâ€å‚ä¸ï¼š
  1) å•æ´»åŠ¨å¤šå­—æ®µå¯¹æ¯”ï¼ˆåŒä¸€ä¸ªæ´»åŠ¨é‡Œå åŠ å¤šä¸ªå­—æ®µï¼‰
  2) å¤šæ´»åŠ¨å•å­—æ®µå¯¹æ¯”ï¼ˆå¤šä¸ªæ´»åŠ¨å¯¹æ¯”åŒä¸€ä¸ªå­—æ®µï¼‰

ä¸šåŠ¡è§„åˆ™ï¼ˆå½“å‰ç‰ˆæœ¬ä»…å¿ƒç‡ï¼‰ï¼š
- ä»…æ”¯æŒä¸€ç§CSVæ ¼å¼ï¼ˆä¸æ ·ä¾‹ä¸€è‡´ï¼‰ï¼Œåªè¯»å–æ•°æ®è¡Œçš„å‰ä¸‰åˆ—ï¼š
  - ç¬¬1åˆ—ï¼šç»å¯¹æ—¶é—´ï¼ˆå¯èƒ½åªæœ‰æ—¶åˆ†ç§’ï¼›è‹¥æ— æ—¥æœŸåˆ™ä½¿ç”¨æ–‡ä»¶å¤´éƒ¨çš„ Date æ‹¼æ¥ï¼‰
  - ç¬¬2åˆ—ï¼šSecondï¼ˆç”¨äºä¿®æ­£æ—¶é—´è½´ï¼‰
  - ç¬¬3åˆ—ï¼šHR (bpm)
- æ—¶é—´ä¿®æ­£è§„åˆ™ï¼šä»¥é¦–æ¡æ ·æœ¬ä¸ºé”šç‚¹ï¼Œåç»­æ—¶é—´æŒ‰ Second æ¨ç®—
  - è®¾é¦–æ¡æ ·æœ¬æ—¶é—´ä¸º T0ï¼Œç§’æ•°ä¸º s0
  - ç¬¬ i æ¡æ ·æœ¬çš„ä¿®æ­£æ—¶é—´ä¸ºï¼šTi = T0 + (si - s0)
- å¯¹é½è§„åˆ™ï¼šä»¥ç›®æ ‡æ´»åŠ¨ï¼ˆFITï¼‰çš„ record æ—¶é—´æˆ³ä¸ºåŸºå‡†ï¼Œä¸æ”¹å˜FITé‡‡æ ·é—´éš”
  - ä¼˜å…ˆå°è¯•â€œå…ƒæ•°æ®å¯¹é½â€ï¼ˆè®¤ä¸ºCSVä¸FITå¯é€šè¿‡å›ºå®šåç§»å¯¹é½ï¼Œå–CSVåŸå§‹BPMå€¼ï¼‰
  - è‹¥æ— æ³•å¯¹é½ï¼Œä½†æ—¶é—´å·®ä¸å¤§ï¼Œåˆ™ä½¿ç”¨â€œçº¿æ€§æ’å€¼â€ï¼ˆè®¡ç®—ä¸­é—´å€¼ï¼‰
  - è‹¥è¶…å‡ºCSVè¦†ç›–èŒƒå›´æˆ–é—´éš”è¿‡å¤§ï¼Œåˆ™è¯¥ç‚¹ä¸ºç¼ºå¤±å€¼ï¼ˆnullï¼‰

å­—æ®µå‘½åä¸åˆ†ç»„ï¼š
- åˆå¹¶åçš„å¿ƒç‡å†™å…¥ record.iq_fields
- å­—æ®µé”®æ ¼å¼ï¼šimported_<devicename>_hr
  - devicename ä»CSVçš„ device name å…ƒæ•°æ®è·å–
  - è‹¥CSVæ—  device nameï¼Œåˆ™å¿½ç•¥ device nameï¼šé™çº§ä¸º imported_hr

åˆå¹¶æ–¹å¼å¯è§†åŒ–ï¼š
- UI åœ¨æ´»åŠ¨è¯¦æƒ…æ±‡æ€»åŒºåŸŸæ˜¾ç¤ºæœ¬æ¬¡åˆå¹¶æ–¹å¼ï¼š
  - å…ƒæ•°æ®å¯¹é½ / çº¿æ€§æ’å€¼ / æœªåˆå¹¶

æ¥å£çº¦å®šï¼š
- POST /api/activity/{activity_id}/merge/hr_csv
  - multipart/form-data
  - file: UploadFile (CSV)
  - options (å¯é€‰)ï¼šè¦†ç›–é»˜è®¤é˜ˆå€¼é…ç½®

#### US-007: åˆå¹¶å¿ƒç‡CSVæ—¶åˆ›å»ºæ–°æ´»åŠ¨ï¼ˆâœ…å·²å®Œæˆ - FR024ï¼‰
ä½œä¸º è·‘æ­¥çˆ±å¥½è€…
æˆ‘å¸Œæœ› åˆå¹¶å¿ƒç‡CSVæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ´»åŠ¨å‰¯æœ¬
ä»¥ä¾¿ ä¿ç•™åŸå§‹æ´»åŠ¨æ•°æ®ï¼Œå¯ä»¥éšæ—¶å›é€€åˆ°æœªåˆå¹¶çŠ¶æ€

ä¸šåŠ¡ä»·å€¼ï¼š
- æ•°æ®å®‰å…¨æ€§ï¼šåŸæ´»åŠ¨ä¿æŒä¸å˜ï¼Œé¿å…è¯¯æ“ä½œå¯¼è‡´æ•°æ®ä¸¢å¤±
- å¯å¯¹æ¯”æ€§ï¼šå¯ä»¥åŒæ—¶å¯¹æ¯”åˆå¹¶å‰åçš„æ•°æ®å·®å¼‚
- å¯è¿½æº¯æ€§ï¼šæ¸…æ™°æ ‡è¯†å“ªäº›æ´»åŠ¨æ˜¯åˆå¹¶åçš„ç‰ˆæœ¬

éªŒæ”¶æ¡ä»¶ï¼š
- [x] ç‚¹å‡»"åˆå¹¶å¿ƒç‡CSV"å¹¶ä¸Šä¼ CSVåï¼ŒåŸæ´»åŠ¨ä¿æŒä¸å˜
- [x] åˆ›å»ºä¸€ä¸ªæ–°æ´»åŠ¨ï¼Œæ´»åŠ¨åä¸º"[HRåˆå¹¶]{åŸå}"
- [x] æ–°æ´»åŠ¨åŒ…å«æ‰€æœ‰åŸæ´»åŠ¨æ•°æ®+åˆå¹¶çš„å¿ƒç‡æ•°æ®
- [x] æ–°æ´»åŠ¨æ˜¾ç¤ºåˆå¹¶æ–¹å¼ï¼ˆå…ƒæ•°æ®å¯¹é½/çº¿æ€§æ’å€¼ï¼‰
- [x] åˆå¹¶æˆåŠŸåæ˜¾ç¤ºæç¤ºå¹¶æä¾›æ´»åŠ¨åˆ—è¡¨è·³è½¬é“¾æ¥
- [x] æ´»åŠ¨åˆ—è¡¨æ˜¾ç¤ºæ–°æ´»åŠ¨ï¼Œå¸¦[HRåˆå¹¶]å‰ç¼€æ˜“äºè¯†åˆ«
- [x] æ–°æ´»åŠ¨çš„IDä¸ºæ–°ç”Ÿæˆçš„UUID
- [x] Deviceåç§°è‡ªåŠ¨sanitizeï¼ˆå¦‚"Polar H10" â†’ "polar_h10"ï¼‰
- [x] CSVæ ¼å¼é”™è¯¯æ—¶æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯

å®ç°è¦ç‚¹ï¼š
1. âœ… åç«¯ä¿®æ”¹ï¼š
   - ä¿®æ”¹ `backend/main.py` çš„ `merge_hr_csv_into_activity` ç«¯ç‚¹
   - ä½¿ç”¨deepcopyåˆ›å»ºæ´»åŠ¨å‰¯æœ¬
   - ç”Ÿæˆæ–°UUIDä½œä¸ºactivity_id
   - æ´»åŠ¨åæ·»åŠ å‰ç¼€ï¼š`[HRåˆå¹¶]{åŸå}`
   - åœ¨å‰¯æœ¬ä¸Šæ‰§è¡ŒHR CSVåˆå¹¶æ“ä½œ
   - ä¿å­˜æ–°æ´»åŠ¨ï¼ŒåŸæ´»åŠ¨ä¿æŒä¸å˜
   - è¿”å›æ–°æ´»åŠ¨IDå’Œåç§°
   - æ·»åŠ sanitize_device_nameå‡½æ•°æ¸…ç†è®¾å¤‡å
   - å¢å¼ºCSVé”™è¯¯å¤„ç†å’Œè¯¦ç»†é”™è¯¯ä¿¡æ¯
2. âœ… å‰ç«¯ä¿®æ”¹ï¼š
   - ä¿®æ”¹ `frontend/js/app.js` çš„åˆå¹¶æˆåŠŸå¤„ç†é€»è¾‘
   - æ¥æ”¶è¿”å›çš„æ–°activityä¿¡æ¯
   - æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶æä¾›æ´»åŠ¨åˆ—è¡¨è·³è½¬é“¾æ¥
   - ä¿ç•™åœ¨å½“å‰æ´»åŠ¨é¡µé¢ï¼Œä¸è‡ªåŠ¨è·³è½¬
   - ä½¿ç”¨innerHTMLæ”¯æŒHTMLé“¾æ¥æ˜¾ç¤º
3. âœ… æµ‹è¯•ï¼š

#### US-008: IQé€Ÿåº¦å­—æ®µé…é€Ÿæ˜¾ç¤ºå¯¹é½ï¼ˆâœ…å·²éªŒè¯ - FR025ï¼‰
ä½œä¸º ä½¿ç”¨ConnectIQè®¾å¤‡ï¼ˆå¦‚é¾™è±†è·‘æ­¥ä¼ æ„Ÿå™¨ï¼‰çš„è·‘æ­¥çˆ±å¥½è€…
æˆ‘å¸Œæœ› IQå­—æ®µä¸­çš„é€Ÿåº¦æ•°æ®ä¸æ ‡å‡†é€Ÿåº¦å­—æ®µä¸€æ ·æ˜¾ç¤ºä¸ºé…é€Ÿå•ä½ï¼ˆmin/kmï¼‰
ä»¥ä¾¿ ç›´è§‚æ¯”è¾ƒä¸åŒæ•°æ®æºçš„é…é€Ÿè¡¨ç°ï¼Œä¸åœ¨m/så’Œmin/kmä¹‹é—´æ··æ·†

ä¸šåŠ¡ä»·å€¼ï¼š
- **æ•°æ®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰é€Ÿåº¦å­—æ®µç»Ÿä¸€æ˜¾ç¤ºä¸ºé…é€Ÿï¼Œç¬¦åˆè·‘æ­¥è€…ä¹ æƒ¯
- **å¯å¯¹æ¯”æ€§**ï¼šæ ‡å‡†é€Ÿåº¦å’ŒIQé€Ÿåº¦å¯åœ¨åŒä¸€Yè½´ä¸Šå åŠ å¯¹æ¯”
- **ç”¨æˆ·ä½“éªŒ**ï¼šæ— éœ€æ‰‹åŠ¨è½¬æ¢å•ä½ï¼Œé™ä½è®¤çŸ¥è´Ÿæ‹…
- **ä¸“ä¸šæ€§**ï¼šä½“ç°å¯¹ConnectIQæ‰©å±•è®¾å¤‡çš„å®Œæ•´æ”¯æŒ

éªŒæ”¶æ¡ä»¶ï¼š
- [x] IQé€Ÿåº¦å­—æ®µï¼ˆdr_speedç­‰ï¼‰çš„Yè½´æ ‡ç­¾æ˜¾ç¤ºä¸º"DR_é…é€Ÿ (min/km)"
- [x] IQé€Ÿåº¦å­—æ®µçš„Yè½´è‡ªåŠ¨ç¿»è½¬ï¼ˆé…é€Ÿè¶Šä½ï¼Œæ˜¾ç¤ºä½ç½®è¶Šé«˜ï¼‰
- [x] å›¾è¡¨æ•°å€¼æ­£ç¡®è½¬æ¢ä¸ºé…é€Ÿæ ¼å¼ï¼ˆå¦‚3.33 m/s â†’ 5:00 min/kmï¼‰
- [x] å åŠ æ ‡å‡†é€Ÿåº¦å’ŒIQé€Ÿåº¦æ—¶ï¼Œå…±äº«åŒä¸€ä¸ªYè½´ï¼ˆéƒ½æ˜¯paceç±»å‹ï¼‰
- [x] æ”¯æŒæ‰€æœ‰å¯èƒ½çš„IQé€Ÿåº¦å­—æ®µï¼šdr_speed, dr_avg_speed, dr_max_speed
- [x] å¤šæ´»åŠ¨å¯¹æ¯”æ—¶ï¼ŒIQé€Ÿåº¦å­—æ®µä¹Ÿæ­£ç¡®æ˜¾ç¤ºä¸ºé…é€Ÿ
- [x] CSVå¯¼å‡ºæ—¶ä¿æŒåŸå§‹m/så€¼ï¼ˆä¾¿äºæ•°æ®åˆ†æï¼‰

éªŒè¯ç»“æœï¼ˆ2025-12-22ï¼‰ï¼š
- **é—®é¢˜çŠ¶æ€**: âœ… æ— é—®é¢˜ - ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜æ— æ³•å¤ç°
- **æµ‹è¯•æ–¹æ³•**: MCP Playwrightæµè§ˆå™¨è‡ªåŠ¨åŒ–æµ‹è¯•
- **æµ‹è¯•åœºæ™¯1**: å•ç‹¬æ˜¾ç¤ºdr_speed
  - âœ… Yè½´æ ‡ç­¾: "DR_é…é€Ÿ (min/km)"
  - âœ… æ•°å€¼æ ¼å¼: 6'17" (6åˆ†17ç§’/å…¬é‡Œ)
  - âœ… Yè½´ç¿»è½¬: range=[21.4, -1.1]ï¼ˆå·²ç¿»è½¬ï¼‰
- **æµ‹è¯•åœºæ™¯2**: å åŠ speed + dr_speed
  - âœ… Yè½´å…±äº«: åªæœ‰1ä¸ªYè½´
  - âœ… Yè½´æ ‡é¢˜: "é…é€Ÿ (min/km) / DR_é…é€Ÿ (min/km)"
  - âœ… JavaScriptéªŒè¯: count=1, hasYaxis2=false
- **é¢„é˜²æ€§æ”¹è¿›**: æ‰©å±•æ”¯æŒæ›´å¤šIQé€Ÿåº¦å­—æ®µå˜ä½“
  - æ–°å¢: dr_avg_speed, dr_max_speed, dr_lap_avg_speed, dr_s_avg_speed
  - æ–‡ä»¶: frontend/js/charts.js (L111-117, L120-129)

æŠ€æœ¯å®ç°ï¼š
1. âœ… å‰ç«¯ä¿®æ”¹ `frontend/js/charts.js`:
   - [x] æ‰©å±•`PACE_FIELDS`æ•°ç»„ï¼šæ·»åŠ æ‰€æœ‰IQé€Ÿåº¦å­—æ®µ
     ```javascript
     const PACE_FIELDS = [
         'speed', 'enhanced_speed', 'avg_speed', 'max_speed',
         'dr_speed', 'dr_avg_speed', 'dr_max_speed',
         'dr_lap_avg_speed', 'dr_s_avg_speed'
     ];
     ```
   - [x] æ‰©å±•`FIELD_UNIT_TYPES`æ˜ å°„ï¼šé…ç½®æ‰€æœ‰IQé€Ÿåº¦å­—æ®µä¸º'pace'
     ```javascript
     const FIELD_UNIT_TYPES = {
         // ... ç°æœ‰é…ç½®
         dr_speed: 'pace',
         dr_avg_speed: 'pace',
         dr_max_speed: 'pace',
         dr_lap_avg_speed: 'pace',
         dr_s_avg_speed: 'pace',
     };
     ```
   - [x] éªŒè¯`getFieldUnitType`å‡½æ•°æ­£ç¡®å¤„ç†iq_å‰ç¼€
   - [x] ç¡®ä¿`isPaceField`åˆ¤æ–­é€»è¾‘è¦†ç›–æ‰€æœ‰åœºæ™¯

2. âœ… æµ‹è¯•éªŒè¯ï¼š
   - [x] ä½¿ç”¨MCP Playwrightè‡ªåŠ¨åŒ–æµ‹è¯•
   - [x] åŠ è½½åŒ…å«dr_speedçš„FITæ–‡ä»¶
   - [x] éªŒè¯Yè½´æ ‡ç­¾ä¸º"DR_é…é€Ÿ (min/km)"
   - [x] å åŠ speedå’Œdr_speedï¼ŒéªŒè¯åªæœ‰ä¸€ä¸ªYè½´
   - [x] éªŒè¯é…é€Ÿæ•°å€¼æ­£ç¡®ï¼ˆå¦‚6'17"è€Œé3.33ï¼‰

3. âœ… æ–‡æ¡£æ›´æ–°ï¼š
   - [x] æ›´æ–°BUGS.mdè®°å½•éªŒè¯ç»“æœï¼ˆIssue #25ï¼‰
   - [x] æ›´æ–°agent.mdæ ‡è®°FR025å’ŒUS-008ä¸ºå·²å®Œæˆ
   - [x] è®°å½•æµ‹è¯•æ–¹æ³•å’Œç»“æœ

å®æ–½ç»“æœï¼š
- âœ… æ‰€æœ‰éªŒæ”¶æ¡ä»¶é€šè¿‡
- âœ… æ— bugå‘ç°ï¼ŒåŠŸèƒ½æ­£å¸¸
- âœ… æ‰©å±•æ€§æ”¹è¿›å·²å®Œæˆ


   - å•å…ƒæµ‹è¯•ï¼šéªŒè¯sanitize_device_nameã€CSVé”™è¯¯å¤„ç†ã€å­—æ®µå‘½å
   - UIæµ‹è¯•ï¼šéªŒè¯åˆ›å»ºæ–°æ´»åŠ¨ã€å‰ç¼€æ­£ç¡®ã€å­—æ®µæ˜¾ç¤º
   - è§£è€¦æµ‹è¯•ï¼šæ³¨é‡ŠHR mergeåŠŸèƒ½åæ ¸å¿ƒFITåˆ†æä»æ­£å¸¸å·¥ä½œ

æŠ€æœ¯å®ç°ï¼š
- deepcopyç¡®ä¿records/laps/sessionså®Œæ•´å¤åˆ¶
- æ–°æ´»åŠ¨created_atä½¿ç”¨å½“å‰æ—¶é—´
- å­—æ®µå‘½åï¼š`imported_{sanitized_device}_hr`
- Deviceåç§°sanitizeï¼šç§»é™¤ç©ºæ ¼/ç‰¹æ®Šå­—ç¬¦è½¬ä¸‹åˆ’çº¿

ä¼˜å…ˆçº§ï¼šMedium â†’ âœ… Completed (2025-12-17)
  - è¿”å›ï¼šæ›´æ–°åçš„ Activity JSON

æŒä¹…åŒ–ä¸æº¯æºï¼š
- Activity å¢åŠ  merge_provenanceï¼ˆæ´»åŠ¨çº§åˆ«ï¼‰ï¼šè®°å½•
  - method: metadata_align | linear_interpolate | none
  - decision: auto
  - sources: (æ–‡ä»¶åã€device name)
  - criteria: (æœ¬æ¬¡åˆå¹¶å®é™…ä½¿ç”¨çš„é˜ˆå€¼)

  - stats: (offsetã€match_ratioã€interp_ratioã€dropped_ratio ç­‰)

é»˜è®¤é˜ˆå€¼ï¼ˆå¯åœ¨ config.py è°ƒæ•´ï¼‰ï¼š
- max_shift_sec = 8
- match_tolerance_sec = 1
- min_match_ratio = 0.85
- interpolate_max_gap_sec = 5
- é»˜è®¤ä¸åšå¤–æ¨ï¼ˆè¶…å‡ºèŒƒå›´ç½®ç©ºï¼‰

éªŒæ”¶æ¡ä»¶:
- [ ] å¯é€šè¿‡ API å°†ç¦»çº¿HR CSVåˆå¹¶è¿›å·²å­˜åœ¨æ´»åŠ¨
- [ ] åˆå¹¶åæ–°å¢IQå­—æ®µå‡ºç°åœ¨å­—æ®µé€‰æ‹©å™¨ä¸­ï¼Œä¸”å¯å‚ä¸ä¸¤ç±»å¯¹æ¯”
- [ ] åˆå¹¶æ–¹å¼åœ¨æ´»åŠ¨è¯¦æƒ…UIä¸Šå¯è§
- [ ] åˆå¹¶åå¯¼å‡ºCSVèƒ½åŒ…å«è¯¥imported_å­—æ®µåˆ—
- [ ] åˆå¹¶é€»è¾‘å¯¹é‡‡æ ·é—´éš”ä¸ä¸€è‡´æ—¶æŒ‰â€œä»¥FITä¸ºåŸºå‡†â€è¾“å‡º

#### US-007: å­—æ®µå•ä½è½¬æ¢ç³»ç»Ÿé‡æ„
ä½œä¸º å¼€å‘è€…
æˆ‘å¸Œæœ› ä½¿ç”¨é…ç½®åŒ–ã€å¯æ‰©å±•çš„å­—æ®µå•ä½è½¬æ¢ç³»ç»Ÿ
ä»¥ä¾¿ å‡†ç¡®å¤„ç†å„ç§FITå­—æ®µçš„å•ä½è½¬æ¢ï¼Œé¿å…ç¡¬ç¼–ç å’Œé­”æ•°

ä¸šåŠ¡ä»·å€¼:
- æé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§
- åŸºäºFIT SDKå®˜æ–¹è§„èŒƒï¼Œç¡®ä¿è½¬æ¢å‡†ç¡®æ€§
- æ”¯æŒæ ‡å‡†å­—æ®µå’ŒIQæ‰©å±•å­—æ®µçš„ç»Ÿä¸€å¤„ç†
- æä¾›æ™ºèƒ½æ£€æµ‹æœºåˆ¶ï¼Œå¤„ç†ä¸è§„èŒƒæ•°æ®

éªŒæ”¶æ¡ä»¶:
- [ ] åˆ›å»ºfield_units.pyæ¨¡å—ï¼ŒåŒ…å«å®Œæ•´çš„å­—æ®µå•ä½é…ç½®
- [ ] å®ç°3å±‚è½¬æ¢ç­–ç•¥ï¼šé…ç½®é©±åŠ¨ â†’ å…ƒæ•°æ®éªŒè¯ â†’ æ™ºèƒ½æ£€æµ‹
- [ ] é…ç½®35ä¸ªæ ‡å‡†å­—æ®µï¼ˆå‚ç›´æŒ¯å¹…ã€æ­¥å¹…ã€GPSåæ ‡ç­‰ï¼‰
- [ ] é…ç½®8ä¸ªIQæ‰©å±•å­—æ®µï¼ˆé¾™è±†è·‘æ­¥ã€StrydåŠŸç‡è®¡ï¼‰
- [ ] æ¯ä¸ªå­—æ®µé…ç½®åŒ…å«ï¼šFITå•ä½ã€æ˜¾ç¤ºå•ä½ã€ç¼©æ”¾å› å­ã€åˆç†èŒƒå›´ã€æè¿°
- [ ] æ™ºèƒ½æ£€æµ‹åŠŸèƒ½ï¼šåŸºäºç”Ÿç†å­¦åˆç†èŒƒå›´è‡ªåŠ¨æ¨æ–­å•ä½
- [ ] é‡æ„fit_parser.pyï¼Œæ›¿æ¢é­”æ•°å®ç°
- [ ] å‘åå…¼å®¹ï¼šä¿ç•™normalize_vertical_oscillationç­‰ä¾¿æ·å‡½æ•°
- [ ] æ·»åŠ è½¬æ¢æ—¥å¿—ï¼Œè®°å½•å¼‚å¸¸å€¼å’Œè½¬æ¢è¿‡ç¨‹
- [ ] æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡ï¼Œå‚ç›´æŒ¯å¹…å€¼åœ¨3-20cmåˆç†èŒƒå›´å†…
- [ ] ä»£ç æ³¨é‡Šå®Œæ•´ï¼ŒåŒ…å«å•ä½è½¬æ¢é€»è¾‘è¯´æ˜
- [ ] æ›´æ–°BUGS.mdï¼Œè®°å½•Bug #7çš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

æŠ€æœ¯è®¾è®¡:
```python
# 3å±‚è½¬æ¢ç­–ç•¥
1. é…ç½®é©±åŠ¨ï¼šåŸºäºFIT SDK Profile.xlsxå®šä¹‰
   - æŸ¥æ‰¾STANDARD_FIELD_UNITSæˆ–IQ_FIELD_UNITSé…ç½®
   - åº”ç”¨scale_factorè¿›è¡Œå•ä½è½¬æ¢
   - éªŒè¯è½¬æ¢ç»“æœæ˜¯å¦åœ¨reasonable_rangeå†…

2. å…ƒæ•°æ®éªŒè¯ï¼šä½¿ç”¨FITå­—æ®µçš„unitså±æ€§ï¼ˆå¦‚æœå¯ç”¨ï¼‰
   - fitdecodeåº“å½“å‰æ”¯æŒæœ‰é™ï¼Œé¢„ç•™æ‰©å±•æ¥å£
   - æœªæ¥å¯ä»field.unitsè·å–å•ä½ä¿¡æ¯

3. æ™ºèƒ½æ£€æµ‹ï¼šåŸºäºç”Ÿç†å­¦åˆç†èŒƒå›´
   - å°è¯•å¸¸è§ç¼©æ”¾å› å­ï¼š0.1, 0.01, 0.001, 10, 100, 1000
   - æ£€æŸ¥è½¬æ¢åå€¼æ˜¯å¦è½å…¥reasonable_range
   - è®°å½•æ£€æµ‹ç»“æœå’Œè­¦å‘Šä¿¡æ¯
```

ç¤ºä¾‹åœºæ™¯:
```python
# åœºæ™¯1: æ ‡å‡†å­—æ®µå‚ç›´æŒ¯å¹…ï¼ˆmm -> cmï¼‰
value = 79.1  # mm
result = normalize_field_value("vertical_oscillation", value)
# é…ç½®é©±åŠ¨: 79.1 * 0.1 = 7.91 cm âœ“ï¼ˆåœ¨3-20èŒƒå›´å†…ï¼‰

# åœºæ™¯2: IQå­—æ®µå¯èƒ½å·²æ˜¯cm
value = 6.8  # cm or mm?
result = normalize_field_value("v_osc", value, is_iq_field=True)
# é…ç½®é©±åŠ¨: 6.8 * 1.0 = 6.8 cm âœ“ï¼ˆåœ¨3-20èŒƒå›´å†…ï¼‰

# åœºæ™¯3: å¼‚å¸¸æ•°æ®éœ€è¦æ™ºèƒ½æ£€æµ‹
value = 791  # å•ä½æœªçŸ¥
result = normalize_field_value("vertical_oscillation", value)
# é…ç½®é©±åŠ¨: 791 * 0.1 = 79.1 cm âœ—ï¼ˆè¶…å‡ºèŒƒå›´ï¼‰
# æ™ºèƒ½æ£€æµ‹: 791 * 0.01 = 7.91 cm âœ“ï¼ˆåœ¨3-20èŒƒå›´å†…ï¼‰
```

#### US-007: æ‰©å±•é¾™è±†DRå­—æ®µæ”¯æŒï¼ˆ8â†’22ä¸ªå­—æ®µï¼‰âœ…å·²å®Œæˆ
ä½œä¸º å¼€å‘è€…
æˆ‘å¸Œæœ› æ‰©å±•æ”¯æŒæ‰€æœ‰22ä¸ªé¾™è±†DragonValueå­—æ®µ
ä»¥ä¾¿ ç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹å®Œæ•´çš„è·‘æ­¥åŠ¨æ€æ•°æ®å’Œæ­¥æ€åˆ†ææŒ‡æ ‡

#### US-008: å‰ç«¯å›¾è¡¨æ¸²æŸ“ä»£ç é‡æ„ - ç»Ÿä¸€å•æ´»åŠ¨å’Œå¤šæ´»åŠ¨æ˜¾ç¤º âœ…å·²å®Œæˆ
ä½œä¸º å¼€å‘è€…
æˆ‘å¸Œæœ› ç»Ÿä¸€å•æ´»åŠ¨å’Œå¤šæ´»åŠ¨çš„å›¾è¡¨æ¸²æŸ“ä»£ç 
ä»¥ä¾¿ å‡å°‘ä»£ç é‡å¤ï¼Œæé«˜å¯ç»´æŠ¤æ€§ï¼Œå¹¶ä¸ºä¸¤ç§æ¨¡å¼æä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ

ä¸šåŠ¡ä»·å€¼:
- å‡å°‘ä»£ç é‡å¤ï¼šå•æ´»åŠ¨å’Œå¤šæ´»åŠ¨çš„å­—æ®µé€‰æ‹©å™¨ã€å›¾è¡¨é…ç½®ä»£ç å­˜åœ¨çº¦200è¡Œé‡å¤
- æå‡ç”¨æˆ·ä½“éªŒï¼šå¤šæ´»åŠ¨å¯¹æ¯”é‡‡ç”¨å•æ´»åŠ¨çš„åˆ†ç»„æ˜¾ç¤ºï¼ˆæ ‡å‡†å­—æ®µ/IQæ‰©å±•å­—æ®µï¼‰ï¼ŒIQå­—æ®µå¸¦DR_å‰ç¼€
- æé«˜å¯ç»´æŠ¤æ€§ï¼šå…¬å…±é€»è¾‘æŠ½å–ä¸ºå¤ç”¨å‡½æ•°ï¼Œæœªæ¥ä¿®æ”¹åªéœ€æ”¹ä¸€å¤„
- ä»£ç è´¨é‡æ”¹è¿›ï¼šä»~200è¡Œé‡å¤ä»£ç å‡å°‘åˆ°~80è¡Œï¼Œæ–°å¢~150è¡Œå¯å¤ç”¨å·¥å…·å‡½æ•°

éªŒæ”¶æ¡ä»¶:
- [x] **Phase 1: æå–å…¬å…±å·¥å…·å‡½æ•°**
  - [x] åˆ›å»ºgetTraceColor(index)ç»Ÿä¸€é¢œè‰²åˆ†é…
  - [x] åˆ›å»ºcreatePlotlyConfig(filename)ç»Ÿä¸€Plotlyé…ç½®
  - [x] åˆ›å»ºcreateYAxisConfig()ç»Ÿä¸€Yè½´é…ç½®
  - [x] åˆ›å»ºseparateFieldTypes()å­—æ®µåˆ†ç±»ï¼ˆæ ‡å‡†/IQï¼‰
  - [x] åˆ›å»ºshouldSkipField()ç‰¹æ®Šå­—æ®µè¿‡æ»¤
- [x] **Phase 2: é‡æ„å­—æ®µé€‰æ‹©å™¨**
  - [x] åˆ›å»ºrenderUnifiedFieldSelector()ç»Ÿä¸€å­—æ®µé€‰æ‹©å™¨
  - [x] æ”¯æŒå•æ´»åŠ¨æ¨¡å¼ï¼ˆcheckboxå¤šé€‰ï¼‰
  - [x] æ”¯æŒå¤šæ´»åŠ¨æ¨¡å¼ï¼ˆradioå•é€‰ï¼‰
  - [x] å¤šæ´»åŠ¨å­—æ®µé€‰æ‹©å™¨æ˜¾ç¤ºåˆ†ç»„ï¼ˆæ ‡å‡†å­—æ®µ/IQæ‰©å±•å­—æ®µï¼‰
  - [x] é‡æ„renderFieldSelector()è°ƒç”¨ç»Ÿä¸€å‡½æ•°
  - [x] é‡æ„loadCompareFieldSelector()ä½¿ç”¨åˆ†ç»„æ˜¾ç¤º
  - [x] åœ¨å›¾è¡¨æ¸²æŸ“ä¸­åº”ç”¨createPlotlyConfig()
- [x] **Phase 3: æµ‹è¯•ä¸æ–‡æ¡£**
  - [x] æ›´æ–°agent.mdè®°å½•US-008
  - [x] æ‰‹åŠ¨æµ‹è¯•å•æ´»åŠ¨å­—æ®µé€‰æ‹©å™¨ âœ… PASS
  - [x] æ‰‹åŠ¨æµ‹è¯•å¤šæ´»åŠ¨å­—æ®µé€‰æ‹©å™¨ï¼ˆéªŒè¯åˆ†ç»„æ˜¾ç¤ºï¼‰âœ… PASSï¼ˆä¿®å¤Bug #11ï¼‰
  - [x] æ‰‹åŠ¨æµ‹è¯•å•æ´»åŠ¨å›¾è¡¨æ¸²æŸ“ âœ… PASS
  - [x] æ‰‹åŠ¨æµ‹è¯•å¤šæ´»åŠ¨å›¾è¡¨æ¸²æŸ“ âœ… PASS
  - [x] Bug #11ä¿®å¤ï¼šå¤šæ´»åŠ¨å¯¹æ¯”IQå­—æ®µæ˜¾ç¤ºé—®é¢˜

å®æ–½æ€»ç»“ï¼ˆ2025-12-11ï¼‰:
- âœ… **ä»£ç æ”¹è¿›æŒ‡æ ‡**:
  - åˆ é™¤é‡å¤ä»£ç : ~80è¡Œ
  - æ–°å¢å·¥å…·å‡½æ•°: ~150è¡Œ
  - å‡€å¢ä»£ç é‡: +70è¡Œï¼ˆä½†å¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡ï¼‰
  - å—å½±å“å‡½æ•°: 6ä¸ªï¼ˆrenderFieldSelector, loadCompareFieldSelector, updateTrendChart, renderCompareChartç­‰ï¼‰
- âœ… **æ–°å¢å…¬å…±å·¥å…·å‡½æ•°**:
  1. `getTraceColor(index)` - ç»Ÿä¸€é¢œè‰²åˆ†é…ï¼ˆåŸºäºCOLOR_PALETTEï¼‰
  2. `createPlotlyConfig(filename)` - Plotlyé…ç½®å·¥å‚ï¼ˆæ°´å°ã€ä¸‹è½½æ–‡ä»¶åï¼‰
  3. `createYAxisConfig(title, color, isPaceField, side)` - Yè½´é…ç½®å·¥å‚
  4. `separateFieldTypes(allFields)` - å­—æ®µåˆ†ç±»å™¨ï¼ˆæ ‡å‡†/IQï¼‰
  5. `shouldSkipField(field)` - ç‰¹æ®Šå­—æ®µè¿‡æ»¤ï¼ˆæ—¶é—´æˆ³ã€è·ç¦»ã€ä½ç½®ï¼‰
  6. `renderUnifiedFieldSelector(options)` - ç»Ÿä¸€å­—æ®µé€‰æ‹©å™¨ï¼ˆæ”¯æŒcheckbox/radioï¼‰
- âœ… **é‡æ„åçš„å‡½æ•°**:
  - `renderFieldSelector()` - ç°åœ¨è°ƒç”¨renderUnifiedFieldSelectorï¼ˆå•æ´»åŠ¨checkboxæ¨¡å¼ï¼‰
  - `loadCompareFieldSelector()` - ç°åœ¨ä½¿ç”¨renderUnifiedFieldSelectorï¼ˆå¤šæ´»åŠ¨radioæ¨¡å¼ï¼Œâœ¨æ–°å¢åˆ†ç»„æ˜¾ç¤ºï¼‰
  - `updateTrendChart()` - åº”ç”¨createPlotlyConfig()
  - `renderCompareChart()` - åº”ç”¨createPlotlyConfig()
- âœ… **å‘åå…¼å®¹æ€§**:
  - æ‰€æœ‰ç°æœ‰å‡½æ•°è°ƒç”¨ä¿æŒä¸å˜
  - å•æ´»åŠ¨å­—æ®µé€‰æ‹©å™¨è¡Œä¸ºæ— å˜åŒ–
  - å¤šæ´»åŠ¨å­—æ®µé€‰æ‹©å™¨æ–°å¢åˆ†ç»„æ˜¾ç¤ºï¼Œä½†é€‰æ‹©é€»è¾‘å‘åå…¼å®¹
- â³ **å¾…éªŒè¯é¡¹**:
  - æ‰‹åŠ¨UIæµ‹è¯•ï¼ˆå•æ´»åŠ¨/å¤šæ´»åŠ¨å­—æ®µé€‰æ‹©å’Œå›¾è¡¨æ¸²æŸ“ï¼‰
  - Playwrightè‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

æŠ€æœ¯è¯´æ˜:
- ç»Ÿä¸€å­—æ®µé€‰æ‹©å™¨æ¨¡å¼åˆ‡æ¢é€šè¿‡`mode: 'single' | 'compare'`å‚æ•°æ§åˆ¶
- é€‰æ‹©ç±»å‹é€šè¿‡`selectionType: 'checkbox' | 'radio'`å‚æ•°æ§åˆ¶
- åˆ†ç»„æ˜¾ç¤ºé€šè¿‡separateFieldTypes()å®ç°ï¼ˆæ ‡å‡†å­—æ®µ/IQæ‰©å±•å­—æ®µï¼‰
- IQå­—æ®µå‰ç¼€"DR_"åœ¨IQ_FIELD_LABELSé…ç½®ä¸­å®šä¹‰
- é¢œè‰²åˆ†é…ä½¿ç”¨å…¨å±€COLOR_PALETTEï¼Œé€šè¿‡getTraceColor()ç»Ÿä¸€ç®¡ç†
- Plotlyé…ç½®ç»Ÿä¸€åŒ…å«æ°´å°å’Œä¸‹è½½æ–‡ä»¶åï¼ˆé€šè¿‡createPlotlyConfig()ï¼‰

#### US-007: æ‰©å±•é¾™è±†DRå­—æ®µæ”¯æŒï¼ˆ8â†’22ä¸ªå­—æ®µï¼‰âœ…å·²å®Œæˆ
ä½œä¸º å¼€å‘è€…
æˆ‘å¸Œæœ› æ‰©å±•æ”¯æŒæ‰€æœ‰22ä¸ªé¾™è±†DragonValueå­—æ®µ
ä»¥ä¾¿ ç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹å®Œæ•´çš„è·‘æ­¥åŠ¨æ€æ•°æ®å’Œæ­¥æ€åˆ†ææŒ‡æ ‡

ä¸šåŠ¡ä»·å€¼:
- æ”¯æŒé¾™è±†DragonValueå®Œæ•´å­—æ®µé›†ï¼ˆæ—¶é—´æˆ³ã€åŠŸç‡ã€å†²å‡»åŠ›ã€ä¸‹è‚¢åˆšåº¦ç­‰ï¼‰
- ä¿ç•™dr_å‰ç¼€é¿å…ä¸æ ‡å‡†FITå­—æ®µå‘½åå†²çª
- ä½¿ç”¨è¡¨æ ¼åŸå§‹å•ä½ï¼Œæ— éœ€é¢å¤–è½¬æ¢ï¼ˆç™¾åˆ†æ¯”å­—æ®µç›´æ¥æ˜¾ç¤ºï¼‰
- ä¿æŒç©ºå€¼è¿‡æ»¤æœºåˆ¶ï¼Œå‰ç«¯åªæ˜¾ç¤ºæœ‰æ•°æ®çš„å­—æ®µ
- [x] ä½¿ç”¨PlaywrightéªŒè¯æ´»åŠ¨è¯¦æƒ…é¡µå’Œå¤šæ´»åŠ¨å¯¹æ¯”é¡µæ˜¾ç¤ºæ­£å¸¸
- [x] æ–‡æ¡£Bug #10è®°å½•Unitæšä¸¾å€¼ä¿®å¤è¿‡ç¨‹
- [x] æ›´æ–°agent.mdæ ‡è®°US-007ä¸ºå·²å®Œæˆ

22ä¸ªDRå­—æ®µæ˜ å°„è¡¨:
```python
DR_FIELD_MAPPING = {
    'dr_timestamp': 'dr_timestamp',           # 0. æ—¶é—´æˆ³ (ms)
    'dr_distance': 'dr_distance',             # 1. è·ç¦» (m)
    'dr_speed': 'dr_speed',                   # 2. é€Ÿåº¦ (m/s)
    'dr_cadence': 'dr_cadence',               # 3. æ­¥é¢‘ (spm)
    'dr_stride': 'dr_stride',                 # 4. æ­¥å¹… (cm)
    'dr_stance': 'dr_gct',                    # 5. è§¦åœ°æ—¶é—´ (ms) - GCT
    'dr_air': 'dr_air_time',                  # 6. è…¾ç©ºæ—¶é—´ (ms)
    'dr_vertical_osc': 'dr_v_osc',            # 7. å‚ç›´æŒ¯å¹… (cm)
    'dr_vertical_ratio': 'dr_vertical_ratio', # 8. å‚ç›´æ­¥å¹…æ¯” (%)
    'dr_ssl': 'dr_ssl',                       # 9. æ­¥é€ŸæŸå¤± (cm/s)
    'dr_ssl%': 'dr_ssl_percent',              # 10. æ­¥é€ŸæŸå¤±å æ¯” (%)
    'dr_vertical_power': 'dr_vertical_power', # 11. å‚ç›´åŠŸç‡ (W)
    'dr_propulsive_power': 'dr_propulsive_power', # 12. å‰è¿›åŠŸç‡ (W)
    'dr_slop_power': 'dr_slope_power',        # 13. å¡åº¦åŠŸç‡ (W)
    'dr_total_power': 'dr_total_power',       # 14. æ€»åŠŸç‡ (W)
    'dr_lss': 'dr_lss',                       # 15. ä¸‹è‚¢åˆšåº¦ (kN/m)
    'dr_v_ilr': 'dr_v_ilr',                   # 16. å‚ç›´å†²å‡»åŠ› (bw/s)
    'dr_h_ilr': 'dr_h_ilr',                   # 17. æ°´å¹³å†²å‡»åŠ› (bw/s)
    'dr_v_pif': 'dr_v_pif',                   # 18. å‚ç›´å†²å‡»å³°å€¼ (g)
    'dr_h_pif': 'dr_h_pif',                   # 19. æ°´å¹³å†²å‡»å³°å€¼ (g)
    'dr_body_x_pif': 'dr_body_x_pif',         # 20. ä¼ æ„Ÿå™¨Xè½´å†²å‡»å³°å€¼ (g)
    'dr_body_y_pif': 'dr_body_y_pif',         # 21. ä¼ æ„Ÿå™¨Yè½´å†²å‡»å³°å€¼ (g)
    'dr_body_z_pif': 'dr_body_z_pif',         # 22. ä¼ æ„Ÿå™¨Zè½´å†²å‡»å³°å€¼ (g)
}
```

æŠ€æœ¯è¯´æ˜:
- dr_timestampå•ä½ä¸ºmsï¼ˆæ¯«ç§’ï¼‰ï¼Œä¸elapsed_timeï¼ˆç§’ï¼‰åŒºåˆ†
- ç™¾åˆ†æ¯”å­—æ®µå€¼ç›´æ¥æ˜¾ç¤ºï¼Œå¦‚50.6è¡¨ç¤º50.6%
- åŠŸç‡ã€å†²å‡»åŠ›ã€åˆšåº¦ç­‰å­—æ®µè®¾ç½®åˆç†èŒƒå›´ç”¨äºå¼‚å¸¸å€¼æ£€æµ‹
- å­—æ®µåä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚dr_ssl%ï¼‰æ˜ å°„ä¸ºä¸‹åˆ’çº¿å½¢å¼ï¼ˆdr_ssl_percentï¼‰

å®æ–½æ€»ç»“ï¼ˆ2025-12-11ï¼‰:
- âœ… åç«¯å®ç°ï¼šfit_parser.pyæ‰©å±•DR_FIELD_MAPPINGï¼ˆ22å­—æ®µï¼‰
- âœ… åç«¯é…ç½®ï¼šfield_units.pyæ·»åŠ IQ_FIELD_UNITSé…ç½®
- âœ… å‰ç«¯æ˜¾ç¤ºï¼šcharts.jsæ·»åŠ IQ_FIELD_LABELSä¸­æ–‡æ ‡ç­¾
- âœ… Bugä¿®å¤ï¼šBug #10ä¿®æ­£Unit.SPMå’ŒUnit.DIMENSIONLESSæšä¸¾å€¼
- âœ… åŠŸèƒ½éªŒè¯ï¼šPlaywrightæµ‹è¯•æ´»åŠ¨è¯¦æƒ…é¡µå’Œå¤šæ´»åŠ¨å¯¹æ¯”é¡µ
- âš ï¸ æµ‹è¯•é™åˆ¶ï¼šç°æœ‰FITæ–‡ä»¶ä»…åŒ…å«8ä¸ªæ—§ç‰ˆDRå­—æ®µï¼Œæœªæµ‹è¯•å…¨éƒ¨22å­—æ®µ
- ğŸ“ å¾…å®Œå–„ï¼šéœ€è¦ä½¿ç”¨åŒ…å«å®Œæ•´22å­—æ®µçš„DragonValue FITæ–‡ä»¶è¿›è¡Œå…¨é¢æµ‹è¯•

#### US-009: ç»Ÿä¸€å­—æ®µé€‰æ‹©å™¨UIå¸ƒå±€ âœ…å·²å®Œæˆ
ä½œä¸º ç”¨æˆ·
æˆ‘å¸Œæœ› å¤šæ´»åŠ¨å¯¹æ¯”é¡µé¢çš„å­—æ®µé€‰æ‹©å™¨å¸ƒå±€ä¸å•æ´»åŠ¨è¯¦æƒ…é¡µé¢ä¿æŒä¸€è‡´
ä»¥ä¾¿ è·å¾—ç»Ÿä¸€çš„è§†è§‰ä½“éªŒå’Œäº¤äº’æ–¹å¼

ä¸šåŠ¡ä»·å€¼:
- æå‡UIä¸€è‡´æ€§ï¼šå¤šæ´»åŠ¨å’Œå•æ´»åŠ¨é¡µé¢ä½¿ç”¨ç›¸åŒçš„å­—æ®µå¸ƒå±€é£æ ¼
- æ”¹å–„ç”¨æˆ·ä½“éªŒï¼šæ¨ªå‘ç½‘æ ¼å¸ƒå±€ï¼Œå­—æ®µè‡ªåŠ¨æ¢è¡Œï¼Œè§†è§‰æ›´æ¸…æ™°
- é™ä½å­¦ä¹ æˆæœ¬ï¼šç”¨æˆ·æ— éœ€é€‚åº”ä¸åŒçš„ç•Œé¢å¸ƒå±€

éªŒæ”¶æ¡ä»¶:
- [x] å¤šæ´»åŠ¨å¯¹æ¯”é¡µé¢å­—æ®µé‡‡ç”¨æ¨ªå‘ç½‘æ ¼å¸ƒå±€ï¼ˆä¸å•æ´»åŠ¨é¡µé¢ä¸€è‡´ï¼‰
- [x] å­—æ®µåˆ†ç»„æ ‡é¢˜ç‹¬å ä¸€è¡Œï¼Œä¸å­—æ®µæœ‰æ˜æ˜¾åˆ†éš”
- [x] å­—æ®µé¡¹æ ·å¼ç»Ÿä¸€ï¼šè¾¹æ¡†ã€å†…è¾¹è·ã€æ‚¬åœæ•ˆæœä¸€è‡´
- [x] å“åº”å¼å¸ƒå±€ï¼šçª—å£ç¼©æ”¾æ—¶å­—æ®µè‡ªåŠ¨æ¢è¡Œ
- [x] åˆ†ç»„é—´è·é€‚å½“ï¼šæ ‡å‡†å­—æ®µå’ŒIQå­—æ®µä¹‹é—´æœ‰è§†è§‰é—´éš”

æŠ€æœ¯å®ç°:
1. **CSSæ ·å¼**ï¼ˆfrontend/css/styles.cssï¼‰:
   - æ–°å¢ `.field-group` ç±»ï¼šä½¿ç”¨ `display: grid` å’Œ `grid-template-columns: repeat(auto-fill, minmax(180px, 1fr))`
   - æ–°å¢ `.field-group-title` ç±»ï¼šä½¿ç”¨ `grid-column: 1 / -1` å æ®æ•´è¡Œ
   - ç»Ÿä¸€ `.field-group label` æ ·å¼ï¼šè¾¹æ¡†ã€å†…è¾¹è·ã€æ‚¬åœæ•ˆæœ

2. **JavaScriptä¿®æ”¹**ï¼ˆfrontend/js/charts.jsï¼‰:
   - é‡æ„ `renderUnifiedFieldSelector()` å‡½æ•°
   - ç§»é™¤ `<strong>` å’Œ `<br>` æ ‡ç­¾
   - æ”¹ç”¨ `<div class="field-group-title">` ä½œä¸ºåˆ†ç»„æ ‡é¢˜
   - ä¸ºæ‰€æœ‰å­—æ®µæ ‡ç­¾æ·»åŠ  `<span>` åŒ…è£¹ï¼Œç¡®ä¿æ ·å¼ä¸€è‡´

3. **å…³é”®æ”¹è¿›ç‚¹**:
   - åˆ†ç»„æ ‡é¢˜ä»è¡Œå†…å…ƒç´ æ”¹ä¸ºç‹¬ç«‹å—å…ƒç´ ï¼Œå æ®ç½‘æ ¼æ•´è¡Œ
   - å­—æ®µé¡¹ä½¿ç”¨ç»Ÿä¸€çš„ `<label>` ç»“æ„ï¼Œæ— è®ºcheckboxè¿˜æ˜¯radio
   - ç½‘æ ¼åˆ—å®½ä»200pxè°ƒæ•´ä¸º180pxï¼Œä¸å•æ´»åŠ¨é¡µé¢ä¿æŒä¸€è‡´
   - åˆ†ç»„ä¹‹é—´çš„é—´è·ä¸º1.5remï¼Œè§†è§‰å±‚æ¬¡æ¸…æ™°

å®æ–½æ€»ç»“ï¼ˆ2025-12-11ï¼‰:
- âœ… CSSæ–°å¢40è¡Œä»£ç ï¼š.field-groupã€.field-group-titleã€labelæ ·å¼
- âœ… JavaScriptä¿®æ”¹2å¤„ï¼šæ ‡å‡†å­—æ®µå’ŒIQå­—æ®µçš„HTMLç”Ÿæˆé€»è¾‘
- âœ… åˆ é™¤ `<br>` æ ‡ç­¾ï¼Œæ”¹ç”¨CSS Gridå¸ƒå±€æ§åˆ¶æ¢è¡Œ
- âœ… å•æ´»åŠ¨å’Œå¤šæ´»åŠ¨å­—æ®µé€‰æ‹©å™¨UIå®Œå…¨ä¸€è‡´
- âœ… PlaywrightéªŒè¯é€šè¿‡ï¼šä¸¤ä¸ªé¡µé¢å¸ƒå±€ã€é—´è·ã€äº¤äº’æ•ˆæœç»Ÿä¸€

## 3. ç³»ç»Ÿæ¶æ„

### 3.1 æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æµè§ˆå™¨ (Frontend)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ´»åŠ¨åˆ—è¡¨é¡µ   â”‚  â”‚  æ´»åŠ¨è¯¦æƒ…é¡µ   â”‚  â”‚    å¤šæ´»åŠ¨å¯¹æ¯”é¡µ       â”‚   â”‚
â”‚  â”‚  - æ’åºè¿‡æ»¤   â”‚  â”‚  - è¶‹åŠ¿å›¾     â”‚  â”‚    - å¯¹é½é€‰é¡¹        â”‚   â”‚
â”‚  â”‚  - å¤šé€‰      â”‚  â”‚  - æ¯åœˆè¡¨æ ¼   â”‚  â”‚    - å¤šæ›²çº¿å åŠ       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - å­—æ®µé€‰æ‹©   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚  - åŒå­—æ®µå åŠ   â”‚                            â”‚
â”‚                    â”‚  - æ‚¬åœç»†èŠ‚   â”‚                            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                           â”‚ Plotly.js                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FastAPI Backend                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  fit_parser  â”‚  â”‚  data_store  â”‚  â”‚    csv_exporter      â”‚   â”‚
â”‚  â”‚  - åŠ¨æ€è§£æ   â”‚  â”‚  - CRUD      â”‚  â”‚    - mergedæ¨¡å¼      â”‚   â”‚
â”‚  â”‚  - IQå­—æ®µ    â”‚  â”‚  - ç´¢å¼•ç®¡ç†   â”‚  â”‚    - categorizedæ¨¡å¼ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - æ’åºè¿‡æ»¤   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ File I/O
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Local Storage                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  data/                                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ index.json          # æ´»åŠ¨ç´¢å¼•                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€ activities/         # æ´»åŠ¨æ•°æ®JSON                   â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ {id1}.json                                       â”‚   â”‚
â”‚  â”‚      â””â”€â”€ {id2}.json                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒç»„ä»¶

#### 3.2.1 FITè§£æå™¨ (fit_parser.py)
- **èŒè´£**: è§£æFITäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæå–æ‰€æœ‰æ•°æ®
- **ä¸»è¦åŠŸèƒ½**: 
  - éå†FITæ¶ˆæ¯ï¼ˆrecord, lap, session, device_infoç­‰ï¼‰
  - åŠ¨æ€æå–æ‰€æœ‰å­—æ®µï¼ˆä¸ç¡¬ç¼–ç ï¼‰
  - è¯†åˆ«IQæ‰©å±•å­—æ®µï¼š
    - é¾™è±†è·‘æ­¥ `dr_` å‰ç¼€å­—æ®µï¼ˆdr_gct, dr_at, dr_vert_osc, dr_v_PIF, dr_strideç­‰ï¼‰
    - æ ‡å‡†å¼€å‘è€…å­—æ®µï¼ˆis_dev_field=Trueï¼‰
    - Connect IQå…³é”®è¯åŒ¹é…
  - å­—æ®µæ˜ å°„ï¼šdr_gctâ†’gct, dr_atâ†’air_time, dr_vert_oscâ†’v_osc, dr_v_PIFâ†’v_pif, dr_strideâ†’stride_length
  - elapsed_timeè‡ªåŠ¨è®¡ç®—ï¼ˆä»ç¬¬ä¸€æ¡è®°å½•çš„timestampæ¨ç®—ï¼‰
  - å•ä½è½¬æ¢ï¼ˆsemicirclesâ†’åº¦ï¼Œenhanced_speedä¼˜å…ˆä½¿ç”¨ï¼‰

#### 3.2.2 æ•°æ®å­˜å‚¨ç®¡ç†å™¨ (data_store.py)
- **èŒè´£**: ç®¡ç†æ´»åŠ¨æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨
- **ä¸»è¦åŠŸèƒ½**: 
  - ä¿å­˜æ´»åŠ¨åˆ°JSONæ–‡ä»¶
  - ç»´æŠ¤index.jsonç´¢å¼•
  - æ”¯æŒæ’åºã€è¿‡æ»¤ã€åˆ†é¡µæŸ¥è¯¢
  - åˆ é™¤æ´»åŠ¨

#### 3.2.3 CSVå¯¼å‡ºå™¨ (csv_exporter.py)
- **èŒè´£**: å°†æ´»åŠ¨æ•°æ®å¯¼å‡ºä¸ºCSV
- **ä¸»è¦åŠŸèƒ½**: 
  - mergedæ¨¡å¼ï¼šå•ä¸ªCSVåŒ…å«æ‰€æœ‰å­—æ®µ
  - categorizedæ¨¡å¼ï¼šæŒ‰ç±»åˆ«åˆ†å¤šä¸ªCSVï¼ˆrecords/laps/sessionï¼‰
  - æ”¯æŒå­—æ®µé€‰æ‹©

#### 3.2.4 å‰ç«¯å›¾è¡¨æ¨¡å— (charts.js)
- **èŒè´£**: ä½¿ç”¨Plotly.jsæ¸²æŸ“äº¤äº’å¼å›¾è¡¨
- **ä¸»è¦åŠŸèƒ½**: 
  - ç§’çº§è¶‹åŠ¿å›¾ï¼ˆæ—¶é—´/è·ç¦»Xè½´å¯åˆ‡æ¢ï¼Œå¯é€‰Yå­—æ®µï¼‰
  - Xè½´åˆ‡æ¢æŒ‰é’®ï¼ˆæ—¶é—´ â‡” è·ç¦»ï¼‰
  - é…é€Ÿå­—æ®µè‡ªåŠ¨è½¬æ¢ï¼ˆm/s â†’ min/kmï¼ŒYè½´åå‘æ˜¾ç¤ºï¼‰
  - åŒå­—æ®µå åŠ ï¼ˆå¤štraceä¸åŒé¢œè‰²ï¼Œç‹¬ç«‹Yè½´ï¼‰
  - å¤šæ´»åŠ¨å¯¹æ¯”ï¼ˆæŒ‰æ—¶é—´/è·ç¦»å¯¹é½ï¼‰
  - æ‚¬åœtooltipæ˜¾ç¤ºå½“å‰Xå€¼å’Œæ‰€æœ‰é€‰ä¸­å­—æ®µå€¼

## 4. æŠ€æœ¯æ ˆ

### 4.1 å¼€å‘è¯­è¨€å’Œæ¡†æ¶
- **åç«¯**: Python 3.11+
- **Webæ¡†æ¶**: FastAPI
- **FITè§£æ**: fitdecode
- **æ•°æ®å¤„ç†**: pandas
- **å‰ç«¯**: HTML5 + CSS3 + JavaScript (ES6+)
- **å›¾è¡¨åº“**: Plotly.js

### 4.2 æ•°æ®å­˜å‚¨
- **æ´»åŠ¨æ•°æ®**: æœ¬åœ°JSONæ–‡ä»¶ (`data/activities/*.json`)
- **æ´»åŠ¨ç´¢å¼•**: `data/index.json`
- **æ— éœ€æ•°æ®åº“**: è½»é‡çº§æœ¬åœ°å­˜å‚¨

### 4.3 éƒ¨ç½²å’Œè¿ç»´
- **æœ¬åœ°è¿è¡Œ**: uvicorn ASGIæœåŠ¡å™¨
- **å¯åŠ¨è„šæœ¬**: run.bat (Windows)
- **ç«¯å£**: 8080 (å¯é…ç½®)

## 5. æ•°æ®æ¨¡å‹

### 5.1 æ ¸å¿ƒæ•°æ®ç»“æ„

```python
from dataclasses import dataclass
from typing import Dict, List, Any, Optional
from datetime import datetime

@dataclass
class Record:
    """ç§’çº§è®°å½•æ•°æ®"""
    timestamp: datetime           # æ—¶é—´æˆ³
    elapsed_time: float          # ç´¯è®¡æ—¶é—´(ç§’)
    distance: float              # ç´¯è®¡è·ç¦»(ç±³)
    heart_rate: Optional[int]    # å¿ƒç‡(bpm)
    speed: Optional[float]       # é€Ÿåº¦(m/s)
    cadence: Optional[int]       # æ­¥é¢‘(spm)
    power: Optional[int]         # åŠŸç‡(W)
    altitude: Optional[float]    # æµ·æ‹”(ç±³)
    position_lat: Optional[float] # çº¬åº¦
    position_long: Optional[float] # ç»åº¦
    # åŠ¨æ€IQå­—æ®µ
    iq_fields: Dict[str, Any]    # å¦‚: {"stride_length": 0.96, "gct": 257, ...}

@dataclass
class Lap:
    """æ¯åœˆæ±‡æ€»æ•°æ®"""
    lap_number: int              # åœˆå·
    start_time: datetime         # å¼€å§‹æ—¶é—´
    total_elapsed_time: float    # åœˆç”¨æ—¶(ç§’)
    total_distance: float        # åœˆè·ç¦»(ç±³)
    avg_heart_rate: Optional[int]
    max_heart_rate: Optional[int]
    avg_speed: Optional[float]
    avg_cadence: Optional[int]
    avg_power: Optional[int]
    total_ascent: Optional[float]
    total_descent: Optional[float]
    # åŠ¨æ€IQå­—æ®µæ±‡æ€»
    iq_fields: Dict[str, Any]

@dataclass
class Session:
    """æ•´ä½“ä¼šè¯æ±‡æ€»"""
    sport: str                   # è¿åŠ¨ç±»å‹
    start_time: datetime
    total_elapsed_time: float
    total_distance: float
    avg_heart_rate: Optional[int]
    max_heart_rate: Optional[int]
    avg_speed: Optional[float]
    avg_cadence: Optional[int]
    avg_power: Optional[int]
    total_ascent: Optional[float]
    total_descent: Optional[float]
    total_calories: Optional[int]

@dataclass
class Activity:
    """å®Œæ•´æ´»åŠ¨æ•°æ®"""
    id: str                      # UUID
    name: str                    # æ´»åŠ¨åç§°
    file_name: str               # åŸå§‹æ–‡ä»¶å
    created_at: datetime         # å¯¼å…¥æ—¶é—´
    session: Session             # ä¼šè¯æ±‡æ€»
    laps: List[Lap]              # æ¯åœˆæ•°æ®
    records: List[Record]        # ç§’çº§æ•°æ®
    available_fields: List[str]  # å¯ç”¨å­—æ®µåˆ—è¡¨ï¼ˆå«IQå­—æ®µï¼‰

@dataclass
class ActivityMeta:
    """æ´»åŠ¨ç´¢å¼•å…ƒæ•°æ®ï¼ˆç”¨äºåˆ—è¡¨å±•ç¤ºï¼‰"""
    id: str
    name: str
    date: datetime
    sport: str
    distance_km: float
    duration_sec: float
    avg_pace: str                # æ ¼å¼: "5:30"
    avg_heart_rate: Optional[int]
    available_fields: List[str]
```

### 5.2 æ•°æ®å­˜å‚¨æ ¼å¼

#### index.json
```json
{
  "activities": [
    {
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "æ™¨è·‘",
      "date": "2024-12-08T06:30:00",
      "sport": "running",
      "distance_km": 6.76,
      "duration_sec": 2409,
      "avg_pace": "5:56",
      "avg_heart_rate": 148,
      "available_fields": ["heart_rate", "cadence", "power", "iq_stride_length", "iq_gct", "iq_air_time", "iq_v_osc", "iq_v_pif"]
    }
  ],
  "updated_at": "2024-12-08T10:00:00"
}
```

#### activities/{id}.json
```json
{
  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "name": "æ™¨è·‘",
  "file_name": "activity_546218476.fit",
  "created_at": "2024-12-08T10:00:00",
  "session": {
    "sport": "running",
    "start_time": "2024-12-08T06:30:00",
    "total_elapsed_time": 2409,
    "total_distance": 6760,
    "avg_heart_rate": 148,
    "max_heart_rate": 168,
    "avg_speed": 2.81,
    "avg_cadence": 179,
    "avg_power": 224,
    "total_ascent": 0,
    "total_descent": 4,
    "total_calories": 397
  },
  "laps": [
    {
      "lap_number": 1,
      "start_time": "2024-12-08T06:30:00",
      "total_elapsed_time": 345.2,
      "total_distance": 1000,
      "avg_heart_rate": 119,
      "max_heart_rate": 131,
      "avg_speed": 2.90,
      "avg_cadence": 175,
      "avg_power": 235,
      "iq_fields": {
        "distance": 972.97,
        "speed": 2.826,
        "cadence": 178.62,
        "stride_length": 88.75,
        "gct": 271,
        "air_time": 401,
        "v_osc": 6.6,
        "v_pif": 5.6
      }
    }
  ],
  "records": [
    {
      "timestamp": "2024-12-08T06:30:01",
      "elapsed_time": 1,
      "distance": 2.8,
      "heart_rate": 95,
      "speed": 2.8,
      "cadence": 170,
      "power": 220,
      "altitude": 50.5,
      "position_lat": 31.2304,
      "position_long": 121.4737,
      "iq_fields": {
        "stride_length": 0.95,
        "gct": 260,
        "air_time": 395,
        "v_osc": 6.5,
        "v_pif": 5.5
      }
    }
  ],
  "available_fields": [
    "elapsed_time", "distance", "heart_rate", "speed", "cadence", "power", "altitude",
    "iq_stride_length", "iq_gct", "iq_air_time", "iq_v_osc", "iq_v_pif"
  ]
}
```

## 6. å‰ç«¯ç»„ä»¶è®¾è®¡

### 6.1 å…¨å±€çŠ¶æ€ç®¡ç†

å‰ç«¯ä½¿ç”¨vanilla JavaScriptï¼ŒçŠ¶æ€å­˜å‚¨åœ¨å…¨å±€`state`å¯¹è±¡ä¸­ï¼š

```javascript
const state = {
    currentView: 'list',
    currentActivityId: null,
    currentActivity: null,
    selectedActivityIds: new Set(),
    currentPage: 1,
    totalPages: 1,
    filters: { ... }
};
```

### 6.2 å­—æ®µé€‰æ‹©å™¨ç»„ä»¶ (Field Selector)

#### 6.2.1 åŠŸèƒ½æ¦‚è¿°

å­—æ®µé€‰æ‹©å™¨æ˜¯ä¸€ä¸ªå¯å¤ç”¨çš„UIç»„ä»¶ï¼Œç”¨äºè®©ç”¨æˆ·é€‰æ‹©è¦æ˜¾ç¤ºçš„æ•°æ®å­—æ®µã€‚æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
- **è¶‹åŠ¿å›¾å­—æ®µé€‰æ‹©å™¨**: å¤šé€‰æ¨¡å¼(checkbox)ï¼Œç”¨äºé€‰æ‹©è¦åœ¨è¶‹åŠ¿å›¾ä¸­å åŠ æ˜¾ç¤ºçš„å­—æ®µ
- **å•åœˆæ•°æ®å­—æ®µé€‰æ‹©å™¨**: å¤šé€‰æ¨¡å¼(checkbox)ï¼Œç”¨äºé€‰æ‹©è¦åœ¨å•åœˆè¡¨æ ¼ä¸­æ˜¾ç¤ºçš„åˆ—

#### 6.2.2 å­—æ®µåˆ†ç»„é…ç½® (FIELD_GROUPS)

æ‰€æœ‰å­—æ®µæŒ‰ç…§è¯­ä¹‰è¿›è¡Œåˆ†ç»„ï¼Œæé«˜ç”¨æˆ·æŸ¥æ‰¾æ•ˆç‡ã€‚åˆ†ç»„é…ç½®åœ¨`charts.js`ä¸­å®šä¹‰ï¼š

```javascript
// ç»Ÿä¸€å­—æ®µåˆ†ç»„é…ç½®ï¼ˆè¶‹åŠ¿å›¾å’Œå•åœˆè¡¨æ ¼å…±ç”¨ï¼‰
const FIELD_GROUPS = {
    // æ ‡å‡†å­—æ®µåˆ†ç»„
    standard: {
        basic: {
            title: 'åŸºç¡€æ•°æ®',
            fields: ['elapsed_time', 'distance']
        },
        pace: {
            title: 'é…é€Ÿ',
            fields: ['speed', 'avg_speed', 'max_speed']
        },
        heartRate: {
            title: 'å¿ƒç‡',
            fields: ['heart_rate', 'avg_heart_rate', 'max_heart_rate']
        },
        cadence: {
            title: 'æ­¥é¢‘',
            fields: ['cadence', 'avg_cadence', 'max_cadence']
        },
        power: {
            title: 'åŠŸç‡',
            fields: ['power', 'avg_power', 'max_power']
        },
        elevation: {
            title: 'æµ·æ‹”/çˆ¬å‡',
            fields: ['altitude', 'total_ascent', 'total_descent']
        },
        environment: {
            title: 'ç¯å¢ƒ',
            fields: ['temperature', 'grade']
        },
        dynamics: {
            title: 'è·‘æ­¥åŠ¨æ€',
            fields: ['vertical_oscillation', 'avg_vertical_oscillation', 
                     'stance_time', 'avg_stance_time', 
                     'step_length', 'avg_step_length',
                     'stance_time_balance', 'vertical_ratio']
        }
    },
    // IQå­—æ®µåˆ†ç»„
    iq: {
        dragonPower: {
            title: 'é¾™è±†-åŠŸç‡',
            fields: ['dr_vertical_power', 'dr_propulsive_power', 
                     'dr_slope_power', 'dr_total_power']
        },
        dragonImpact: {
            title: 'é¾™è±†-å†²å‡»åŠ›',
            fields: ['dr_v_pif', 'dr_h_pif', 'dr_v_ilr', 'dr_h_ilr',
                     'dr_body_x_pif', 'dr_body_y_pif', 'dr_body_z_pif']
        },
        dragonDynamics: {
            title: 'é¾™è±†-è·‘æ­¥åŠ¨æ€',
            fields: ['dr_gct', 'dr_air_time', 'dr_v_osc', 'dr_vertical_ratio',
                     'dr_stride', 'dr_cadence', 'dr_lss']
        },
        dragonOther: {
            title: 'é¾™è±†-å…¶ä»–',
            fields: ['dr_timestamp', 'dr_distance', 'dr_speed', 'dr_ssl', 
                     'dr_ssl_percent']
        },
        imported: {
            title: 'å¯¼å…¥æ•°æ®',
            fieldPattern: /^imported_/  // åŠ¨æ€åŒ¹é…imported_*å­—æ®µ
        },
        uncategorized: {
            title: 'æœªåˆ†ç±»IQå­—æ®µ',
            fields: []  // è¿è¡Œæ—¶åŠ¨æ€å¡«å……æœªåœ¨é¢„å®šä¹‰åˆ†ç»„ä¸­çš„IQå­—æ®µ
        }
    }
};

// å•åœˆä¸“ç”¨å­—æ®µåˆ†ç»„ï¼ˆæ‰©å±•æ ‡å‡†åˆ†ç»„ï¼‰
const LAP_FIELD_GROUPS = {
    standard: {
        ...FIELD_GROUPS.standard,
        basic: {
            title: 'åŸºç¡€ä¿¡æ¯',
            fields: ['lap_number', 'start_time', 'total_elapsed_time', 'total_distance']
        },
        calories: {
            title: 'çƒ­é‡',
            fields: ['total_calories']
        }
    },
    iq: FIELD_GROUPS.iq  // å¤ç”¨IQåˆ†ç»„é…ç½®
};
```

**åˆ†ç»„ç­–ç•¥:**
1. **æ ‡å‡†å­—æ®µ**: æŒ‰ç…§è¿åŠ¨æ•°æ®ç±»å‹åˆ†ç»„ï¼ˆå¿ƒç‡ã€æ­¥é¢‘ã€åŠŸç‡ç­‰ï¼‰
2. **IQå­—æ®µ**: æŒ‰ç…§è®¾å¤‡å“ç‰Œå’Œæ•°æ®ç±»å‹åˆ†ç»„ï¼ˆé¾™è±†åŠŸç‡ã€é¾™è±†å†²å‡»åŠ›ç­‰ï¼‰
3. **æœªåˆ†ç±»å­—æ®µ**: è¿è¡Œæ—¶æ£€æµ‹åˆ°çš„æœªé¢„å®šä¹‰å­—æ®µè‡ªåŠ¨å½’å…¥"æœªåˆ†ç±»"ç»„
4. **ç›¸å…³å­—æ®µèšåˆ**: avg/maxå­—æ®µæ”¾åœ¨åŒä¸€ç»„å†…ç›¸é‚»æ˜¾ç¤º

#### 6.2.3 UIç»“æ„

```html
<div id="fieldCheckboxes" class="checkbox-group">
    <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
    <div class="field-selector-controls">
        <button class="select-all-btn">å…¨é€‰</button>
        <button class="deselect-all-btn">å…¨ä¸é€‰</button>
        <button class="toggle-groups-btn">å±•å¼€/æŠ˜å å…¨éƒ¨</button>
    </div>
    
    <!-- å­—æ®µåˆ†ç»„ï¼ˆå¯æŠ˜å ï¼‰ -->
    <div class="field-group collapsible expanded">
        <div class="field-group-header" data-group="heartRate">
            <span class="toggle-icon">â–¼</span>
            <span class="group-title">å¿ƒç‡</span>
        </div>
        <div class="field-group-content">
            <label>
                <input type="checkbox" class="field-checkbox" value="avg_heart_rate">
                <span>å¹³å‡å¿ƒç‡ (bpm)</span>
            </label>
            <label>
                <input type="checkbox" class="field-checkbox" value="max_heart_rate">
                <span>æœ€å¤§å¿ƒç‡ (bpm)</span>
            </label>
        </div>
    </div>
    
    <!-- æ›´å¤šåˆ†ç»„... -->
</div>
```

#### 6.2.4 äº¤äº’è¡Œä¸º

**å±•å¼€/æŠ˜å :**
- ç‚¹å‡»åˆ†ç»„æ ‡é¢˜åˆ‡æ¢è¯¥ç»„çš„å±•å¼€/æŠ˜å çŠ¶æ€
- ç‚¹å‡»"å±•å¼€/æŠ˜å å…¨éƒ¨"æŒ‰é’®åˆ‡æ¢æ‰€æœ‰åˆ†ç»„
- é»˜è®¤çŠ¶æ€: æ‰€æœ‰åˆ†ç»„å±•å¼€
- CSSç±»æ§åˆ¶: `.expanded` / `.collapsed`

**å…¨é€‰/å…¨ä¸é€‰:**
- "å…¨é€‰"æŒ‰é’®: å‹¾é€‰æ‰€æœ‰å¯è§å­—æ®µçš„checkbox
- "å…¨ä¸é€‰"æŒ‰é’®: å–æ¶ˆæ‰€æœ‰checkboxçš„å‹¾é€‰
- æ“ä½œèŒƒå›´: ä»…å½±å“å½“å‰å¯ç”¨å­—æ®µï¼ˆå·²è¿‡æ»¤ç©ºå€¼å­—æ®µä¸æ˜¾ç¤ºï¼‰

**å­—æ®µè¿‡æ»¤:**
- è‡ªåŠ¨éšè—100%ä¸ºç©ºçš„å­—æ®µï¼ˆæ‰€æœ‰æ•°æ®ç‚¹éƒ½ä¸ºnull/undefinedï¼‰
- æ£€æµ‹é€»è¾‘åœ¨`extractAvailableLapFields()`ä¸­å®ç°
- è¿‡æ»¤åçš„å­—æ®µä¸åœ¨é€‰æ‹©å™¨ä¸­æ˜¾ç¤º

#### 6.2.5 localStorageæŒä¹…åŒ–

ç”¨æˆ·çš„å­—æ®µé€‰æ‹©ä¼šè‡ªåŠ¨ä¿å­˜åˆ°localStorageï¼Œä¸‹æ¬¡æ‰“å¼€æ—¶æ¢å¤ï¼š

```javascript
// ä¿å­˜é€‰æ‹©
function saveFieldSelection(key, fields) {
    localStorage.setItem(key, JSON.stringify(fields));
}

// åŠ è½½é€‰æ‹©ï¼ˆå¸¦é»˜è®¤å€¼å›é€€ï¼‰
function loadFieldSelection(key, defaultFields) {
    try {
        const saved = localStorage.getItem(key);
        return saved ? JSON.parse(saved) : defaultFields;
    } catch (e) {
        return defaultFields;
    }
}

// æŒä¹…åŒ–é”®å
// 'trend_selected_fields' - è¶‹åŠ¿å›¾å­—æ®µé€‰æ‹©
// 'lap_selected_fields' - å•åœˆè¡¨æ ¼å­—æ®µé€‰æ‹©
```

**é»˜è®¤é€‰æ‹©:**
- è¶‹åŠ¿å›¾: `['heart_rate', 'cadence']`
- å•åœˆè¡¨æ ¼: `['lap_number', 'total_elapsed_time', 'total_distance', 'avg_speed', 'avg_heart_rate']`

#### 6.2.6 æ¸²æŸ“å‡½æ•°

```javascript
function renderUnifiedFieldSelector(options) {
    const {
        mode,              // 'single' | 'compare'
        standardFields,    // æ ‡å‡†å­—æ®µæ•°ç»„
        iqFields,          // IQå­—æ®µæ•°ç»„
        fieldGroups,       // å­—æ®µåˆ†ç»„é…ç½®å¯¹è±¡
        selectionType,     // 'checkbox' | 'radio'
        defaultSelected,   // é»˜è®¤é€‰ä¸­å­—æ®µæ•°ç»„
        onChange,          // é€‰æ‹©å˜åŒ–å›è°ƒå‡½æ•°
        containerId        // å®¹å™¨DOM ID
    } = options;
    
    // 1. æ ¹æ®fieldGroupsé…ç½®å¯¹å­—æ®µè¿›è¡Œåˆ†ç»„
    // 2. æ¸²æŸ“æ§åˆ¶æŒ‰é’®åŒºåŸŸ
    // 3. éå†åˆ†ç»„æ¸²æŸ“å¯æŠ˜å åŒºåŸŸ
    // 4. ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ï¼ˆå±•å¼€/æŠ˜å ã€å…¨é€‰/å…¨ä¸é€‰ã€checkbox changeï¼‰
}
```

#### 6.2.7 å•åœˆè¡¨æ ¼ä¸“ç”¨é€»è¾‘

**å­—æ®µæå–ä¸è¿‡æ»¤:**

```javascript
function extractAvailableLapFields(laps) {
    const standardFields = [
        'lap_number', 'start_time', 'total_elapsed_time', 'total_distance',
        'avg_speed', 'max_speed', 'avg_heart_rate', 'max_heart_rate',
        'avg_cadence', 'max_cadence', 'avg_power', 'max_power',
        'total_ascent', 'total_descent', 'avg_vertical_oscillation',
        'avg_stance_time', 'avg_step_length', 'total_calories'
    ];
    
    // è¿‡æ»¤100%ä¸ºç©ºçš„æ ‡å‡†å­—æ®µ
    const availableStandardFields = standardFields.filter(field => 
        !laps.every(lap => lap[field] == null)
    );
    
    // æå–IQå­—æ®µå¹¶åŠ iq_å‰ç¼€
    const iqFieldSet = new Set();
    laps.forEach(lap => {
        if (lap.iq_fields) {
            Object.keys(lap.iq_fields).forEach(key => {
                iqFieldSet.add('iq_' + key);
            });
        }
    });
    
    // è¿‡æ»¤100%ä¸ºç©ºçš„IQå­—æ®µ
    const availableIqFields = Array.from(iqFieldSet).filter(field => {
        const rawKey = field.replace('iq_', '');
        return !laps.every(lap => 
            !lap.iq_fields || lap.iq_fields[rawKey] == null
        );
    });
    
    return {
        standardFields: availableStandardFields,
        iqFields: availableIqFields
    };
}
```

**ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–:**

å•åœˆçš„`start_time`å­—æ®µæ˜¾ç¤ºä¸ºç›¸å¯¹äºç¬¬ä¸€åœˆå¼€å§‹çš„æ—¶é—´ï¼š

```javascript
function formatRelativeTime(currentTime, baseTime) {
    if (!currentTime || !baseTime) return '--';
    
    const diffMs = new Date(currentTime) - new Date(baseTime);
    const diffSec = Math.floor(diffMs / 1000);
    
    const minutes = Math.floor(diffSec / 60);
    const seconds = diffSec % 60;
    
    return `+${minutes}:${seconds.toString().padStart(2, '0')}`;
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šç¬¬ä¸€åœˆæ˜¾ç¤º +0:00ï¼Œç¬¬äºŒåœˆæ˜¾ç¤º +5:45
```

**åŠ¨æ€è¡¨æ ¼æ¸²æŸ“:**

```javascript
function renderLapsTable(laps, selectedFields) {
    if (!laps || laps.length === 0) {
        // æ˜¾ç¤ºæ— æ•°æ®æç¤º
        return;
    }
    
    // åŠ¨æ€ç”Ÿæˆè¡¨å¤´
    const thead = laps.map(field => {
        const isIqField = field.startsWith('iq_');
        const label = isIqField ? 
            getFieldLabel(field.replace('iq_', ''), true) :
            FIELD_LABELS[field] || field;
        return `<th>${label}</th>`;
    }).join('');
    
    // åŠ¨æ€ç”Ÿæˆè¡¨ä½“
    const tbody = laps.map((lap, index) => {
        const cells = selectedFields.map(field => {
            let value;
            
            if (field.startsWith('iq_')) {
                // IQå­—æ®µä»iq_fieldsä¸­æå–
                const rawKey = field.replace('iq_', '');
                value = lap.iq_fields?.[rawKey];
            } else {
                // æ ‡å‡†å­—æ®µç›´æ¥è®¿é—®
                value = lap[field];
            }
            
            // æ ¼å¼åŒ–å€¼
            let formatted = '--';
            if (value != null) {
                if (field === 'start_time') {
                    formatted = formatRelativeTime(value, laps[0].start_time);
                } else if (field === 'total_elapsed_time') {
                    formatted = formatDuration(value);
                } else if (field === 'total_distance') {
                    formatted = (value / 1000).toFixed(2) + ' km';
                } else if (field === 'avg_speed' || field === 'max_speed') {
                    formatted = speedToPace(value);
                } else {
                    formatted = value;
                }
            }
            
            return `<td>${formatted}</td>`;
        }).join('');
        
        return `<tr>${cells}</tr>`;
    }).join('');
    
    // æ›´æ–°DOM
    document.getElementById('lapsTableHead').innerHTML = `<tr>${thead}</tr>`;
    document.getElementById('lapsTableBody').innerHTML = tbody;
}
```

#### 6.2.8 æ ·å¼è®¾è®¡

```css
/* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
.field-selector-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

.select-all-btn,
.deselect-all-btn,
.toggle-groups-btn {
    padding: 5px 10px;
    font-size: 12px;
    border: 1px solid #ccc;
    border-radius: 3px;
    background: #f8f9fa;
    cursor: pointer;
}

.select-all-btn:hover,
.deselect-all-btn:hover,
.toggle-groups-btn:hover {
    background: #e9ecef;
}

/* å¯æŠ˜å åˆ†ç»„ */
.field-group.collapsible {
    margin-bottom: 10px;
}

.field-group-header {
    cursor: pointer;
    padding: 5px;
    background: #f0f0f0;
    border-radius: 3px;
    user-select: none;
}

.field-group-header:hover {
    background: #e0e0e0;
}

.toggle-icon {
    display: inline-block;
    transition: transform 0.2s;
    margin-right: 5px;
}

.field-group.expanded .toggle-icon {
    transform: rotate(90deg);
}

.field-group-content {
    padding-left: 15px;
    padding-top: 5px;
}

.field-group-content.collapsed {
    display: none;
}
```

#### 6.2.9 æ•°æ®æµ

```
ç”¨æˆ·äº¤äº’
    â†“
é€‰æ‹©å­—æ®µcheckbox
    â†“
è§¦å‘onChangeå›è°ƒ
    â†“
saveFieldSelection() â†’ localStorage
    â†“
è·å–å½“å‰é€‰ä¸­å­—æ®µ
    â†“
è°ƒç”¨æ¸²æŸ“å‡½æ•°
    â†“
æ›´æ–°è¶‹åŠ¿å›¾ / å•åœˆè¡¨æ ¼
```

## 7. API è®¾è®¡

### 7.1 RESTful API

#### ä¸Šä¼ FITæ–‡ä»¶
```
POST /api/upload
Content-Type: multipart/form-data

Request:
  file: <fit_file>
  name: "æ™¨è·‘" (å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨æ–‡ä»¶å)

Response 200:
{
  "success": true,
  "activity_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "message": "æ´»åŠ¨å¯¼å…¥æˆåŠŸ",
  "summary": {
    "sport": "running",
    "distance_km": 6.76,
    "duration": "40:09",
    "records_count": 2409,
    "laps_count": 8,
    "available_fields": ["heart_rate", "cadence", "power", ...]
  }
}

Response 400:
{
  "success": false,
  "error": "æ— æ³•è§£æFITæ–‡ä»¶"
}
```

#### è·å–æ´»åŠ¨åˆ—è¡¨
```
GET /api/activities?sort=date&order=desc&filter_sport=running&filter_date_from=2024-01-01&page=1&limit=20

Response 200:
{
  "activities": [
    {
      "id": "...",
      "name": "æ™¨è·‘",
      "date": "2024-12-08T06:30:00",
      "sport": "running",
      "distance_km": 6.76,
      "duration_sec": 2409,
      "avg_pace": "5:56",
      "avg_heart_rate": 148,
      "available_fields": [...]
    }
  ],
  "total": 100,
  "page": 1,
  "limit": 20
}
```

#### è·å–æ´»åŠ¨è¯¦æƒ…
```
GET /api/activity/{id}

Response 200:
{
  "id": "...",
  "name": "æ™¨è·‘",
  "session": {...},
  "laps": [...],
  "records": [...],
  "available_fields": [...]
}
```

#### åˆ é™¤æ´»åŠ¨
```
DELETE /api/activity/{id}

Response 200:
{
  "success": true,
  "message": "æ´»åŠ¨å·²åˆ é™¤"
}
```

#### å¤šæ´»åŠ¨å¯¹æ¯”
```
POST /api/compare
Content-Type: application/json

Request:
{
  "activity_ids": ["id1", "id2", "id3"],
  "fields": ["heart_rate", "cadence"],
  "align_by": "time" | "distance"
}

Response 200:
{
  "activities": [
    {
      "id": "id1",
      "name": "æ™¨è·‘1",
      "data": [
        {"x": 0, "heart_rate": 120, "cadence": 170},
        {"x": 1, "heart_rate": 122, "cadence": 172},
        ...
      ]
    },
    {
      "id": "id2",
      "name": "æ™¨è·‘2",
      "data": [...]
    }
  ],
  "align_by": "time",
  "x_label": "æ—¶é—´ (ç§’)" | "è·ç¦» (ç±³)"
}
```

#### å¯¼å‡ºCSV
```
GET /api/export/{id}?mode=merged&fields=heart_rate,cadence,power

Response 200:
Content-Type: text/csv
Content-Disposition: attachment; filename="activity_æ™¨è·‘_records.csv"

timestamp,elapsed_time,distance,heart_rate,cadence,power
2024-12-08T06:30:01,1,2.8,95,170,220
...
```

```
GET /api/export/{id}?mode=categorized

Response 200:
Content-Type: application/zip
Content-Disposition: attachment; filename="activity_æ™¨è·‘.zip"

(åŒ…å« records.csv, laps.csv, session.csv)
```

## 7. å‰ç«¯è®¾è®¡

### 7.1 é¡µé¢ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FITè·‘æ­¥æ•°æ®åˆ†æå™¨                              [ä¸Šä¼ FITæ–‡ä»¶]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æ´»åŠ¨åˆ—è¡¨] [å¯¹æ¯”åˆ†æ]                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€ æ´»åŠ¨åˆ—è¡¨é¡µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ’åº: [æ—¥æœŸâ–¼] [è·ç¦»] [æ—¶é•¿] [é…é€Ÿ]   è¿‡æ»¤: [æ—¥æœŸèŒƒå›´] [è·ç¦»]â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚ â”‚ â˜ â”‚ æ—¥æœŸ       â”‚ åç§°   â”‚ è·ç¦»   â”‚ æ—¶é•¿  â”‚ é…é€Ÿ  â”‚ å¿ƒç‡ â”‚â”‚   â”‚
â”‚  â”‚ â”‚ â˜ â”‚ 2024-12-08 â”‚ æ™¨è·‘   â”‚ 6.76km â”‚ 40:09 â”‚ 5:56 â”‚ 148  â”‚â”‚   â”‚
â”‚  â”‚ â”‚ â˜ â”‚ 2024-12-07 â”‚ é—´æ­‡è·‘ â”‚ 8.00km â”‚ 45:00 â”‚ 5:37 â”‚ 155  â”‚â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚ [å¯¹æ¯”é€‰ä¸­] [åˆ é™¤é€‰ä¸­]                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€ æ´»åŠ¨è¯¦æƒ…é¡µï¼ˆç‚¹å‡»æ´»åŠ¨è¿›å…¥ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â† è¿”å›åˆ—è¡¨    æ™¨è·‘ - 2024-12-08          [å¯¼å‡ºCSVâ–¼]      â”‚   â”‚
â”‚  â”‚ â”Œâ”€ æ±‡æ€»ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚ â”‚ è·ç¦»: 6.76km  æ—¶é•¿: 40:09  é…é€Ÿ: 5:56  å¿ƒç‡: 148bpm    â”‚â”‚   â”‚
â”‚  â”‚ â”‚ åŠŸç‡: 224W    æ­¥é¢‘: 179spm  æ­¥å¹…: 0.90m               â”‚â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚ â”Œâ”€ å­—æ®µé€‰æ‹© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚ â”‚ â˜‘å¿ƒç‡ â˜‘æ­¥é¢‘ â˜åŠŸç‡ â˜é…é€Ÿ â˜æ­¥å¹… â˜è§¦åœ°æ—¶é—´ â˜è…¾ç©ºæ—¶é—´...   â”‚â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚ â”Œâ”€ è¶‹åŠ¿å›¾ï¼ˆæ‚¬åœæ˜¾ç¤ºç»†èŠ‚ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚ â”‚                  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                   â”‚â”‚   â”‚
â”‚  â”‚ â”‚  â™¥ å¿ƒç‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ æ—¶é—´: 10:30     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚â”‚   â”‚
â”‚  â”‚ â”‚  âš¡æ­¥é¢‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ å¿ƒç‡: 152 bpm   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚â”‚   â”‚
â”‚  â”‚ â”‚                  â”‚ æ­¥é¢‘: 178 spm   â”‚                   â”‚â”‚   â”‚
â”‚  â”‚ â”‚                  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                   â”‚â”‚   â”‚
â”‚  â”‚ â”‚  [â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â—‹â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]             â”‚â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚ â”Œâ”€ æ¯åœˆæ•°æ® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚ â”‚ åœˆ â”‚ æ—¶é—´  â”‚ è·ç¦» â”‚ é…é€Ÿ â”‚ å¿ƒç‡ â”‚ æ­¥é¢‘ â”‚ IQæ­¥å¹… â”‚ ...  â”‚â”‚   â”‚
â”‚  â”‚ â”‚ 1  â”‚ 5:45  â”‚ 1km  â”‚ 5:45 â”‚ 119  â”‚ 175  â”‚ 88.75  â”‚      â”‚â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€ å¤šæ´»åŠ¨å¯¹æ¯”é¡µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¯¹æ¯”å­—æ®µ: [å¿ƒç‡â–¼]  å¯¹é½æ–¹å¼: â—‹æ—¶é—´ â—‹è·ç¦»                  â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚ â”‚  â”€â”€ æ™¨è·‘ (12-08)                                       â”‚â”‚   â”‚
â”‚  â”‚ â”‚  â”€â”€ é—´æ­‡è·‘ (12-07)                                     â”‚â”‚   â”‚
â”‚  â”‚ â”‚  â”€â”€ é•¿è·ç¦» (12-05)                                     â”‚â”‚   â”‚
â”‚  â”‚ â”‚                                                        â”‚â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å›¾è¡¨é…ç½® (Plotly.js)

#### è¶‹åŠ¿å›¾ + æ‚¬åœç»†èŠ‚
```javascript
const layout = {
  title: 'è¿åŠ¨æ•°æ®è¶‹åŠ¿',
  xaxis: { title: 'æ—¶é—´ (ç§’)' },
  yaxis: { title: 'å¿ƒç‡ (bpm)' },
  yaxis2: { title: 'æ­¥é¢‘ (spm)', overlaying: 'y', side: 'right' },
  hovermode: 'x unified',  // æ‚¬åœæ˜¾ç¤ºæ‰€æœ‰å­—æ®µ
  legend: { orientation: 'h', y: -0.2 }
};

const trace1 = {
  x: timestamps,
  y: heartRates,
  name: 'å¿ƒç‡',
  type: 'scatter',
  mode: 'lines',
  line: { color: '#e74c3c' },
  hovertemplate: 'å¿ƒç‡: %{y} bpm<extra></extra>'
};

const trace2 = {
  x: timestamps,
  y: cadences,
  name: 'æ­¥é¢‘',
  type: 'scatter',
  mode: 'lines',
  yaxis: 'y2',
  line: { color: '#3498db' },
  hovertemplate: 'æ­¥é¢‘: %{y} spm<extra></extra>'
};
```

## 8. å®‰å…¨è€ƒè™‘

### 8.1 è¾“å…¥éªŒè¯
- **æ–‡ä»¶ç±»å‹æ£€æŸ¥**: ä»…æ¥å—.fitæ‰©å±•åæ–‡ä»¶
- **æ–‡ä»¶å¤§å°é™åˆ¶**: æœ€å¤§50MB
- **æ–‡ä»¶å†…å®¹éªŒè¯**: æ£€æŸ¥FITæ–‡ä»¶å¤´é­”æ•°

### 8.2 æ•°æ®å®‰å…¨
- **æœ¬åœ°å­˜å‚¨**: æ•°æ®ä»…å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨
- **è·¯å¾„éå†é˜²æŠ¤**: æ´»åŠ¨IDä½¿ç”¨UUIDï¼Œé˜²æ­¢ç›®å½•éå†æ”»å‡»

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 å¤§æ–‡ä»¶å¤„ç†
- **æµå¼è§£æ**: ä½¿ç”¨fitdecodeè¿­ä»£å™¨æ¨¡å¼ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶
- **åˆ†é¡µåŠ è½½**: æ´»åŠ¨åˆ—è¡¨æ”¯æŒåˆ†é¡µï¼Œæ¯é¡µ20æ¡
- **æ‡’åŠ è½½**: æ´»åŠ¨è¯¦æƒ…ä»…åœ¨ç‚¹å‡»æ—¶åŠ è½½

### 9.2 å›¾è¡¨æ€§èƒ½
- **æ•°æ®é‡‡æ ·**: è¶…è¿‡10000ä¸ªæ•°æ®ç‚¹æ—¶è‡ªåŠ¨é™é‡‡æ ·
- **WebGLæ¸²æŸ“**: Plotlyä½¿ç”¨WebGLåŠ é€Ÿå¤§æ•°æ®é›†æ¸²æŸ“

## 10. æµ‹è¯•ç­–ç•¥

### 10.0 æµ‹è¯•è¦æ±‚ï¼ˆå¿…è¯»ï¼‰

> **âš ï¸ é‡è¦ï¼šæ¯æ¬¡åŠŸèƒ½å®æ–½å®Œæˆåå¿…é¡»è¿›è¡Œæµ‹è¯•ï¼**

| æµ‹è¯•ç±»å‹ | è¦æ±‚çº§åˆ« | è¯´æ˜ |
|----------|----------|------|
| **å•å…ƒæµ‹è¯•** | **å¿…é¡»** | æ¯æ¬¡å®æ–½å®Œæˆåå¿…é¡»ç¼–å†™å¹¶è¿è¡Œå•å…ƒæµ‹è¯• |
| é›†æˆæµ‹è¯• | å¯é€‰ | APIç«¯ç‚¹æµ‹è¯•ï¼Œå¯æ ¹æ®å˜æ›´èŒƒå›´é€‰æ‹©æ€§æ‰§è¡Œ |
| ç³»ç»Ÿæµ‹è¯• | å¯é€‰ | ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå¯ä½¿ç”¨Playwright MCPè¿›è¡ŒUIæµ‹è¯• |

**æµ‹è¯•æ‰§è¡Œæµç¨‹ï¼š**
1. åŠŸèƒ½å®æ–½å®Œæˆåï¼Œç«‹å³ç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•
2. è¿è¡Œå•å…ƒæµ‹è¯•ç¡®ä¿é€šè¿‡
3. æ ¹æ®éœ€è¦æ‰§è¡Œé›†æˆæµ‹è¯•ï¼ˆAPIè°ƒç”¨éªŒè¯ï¼‰
4. å¤§å‹åŠŸèƒ½å˜æ›´æ—¶æ‰§è¡Œç³»ç»Ÿæµ‹è¯•ï¼ˆPlaywright UIæµ‹è¯•ï¼‰
5. æ›´æ–°ç›¸å…³æ–‡æ¡£

**æµ‹è¯•å·¥å…·ï¼š**
- åç«¯å•å…ƒæµ‹è¯•: pytest
- å‰ç«¯å•å…ƒæµ‹è¯•: Jest æˆ–å†…è”æµ‹è¯•å‡½æ•°
- APIæµ‹è¯•: ç›´æ¥è°ƒç”¨APIç«¯ç‚¹
- UIæµ‹è¯•: Playwright MCP

### 10.1 å•å…ƒæµ‹è¯•
- FITè§£æå™¨ï¼šæµ‹è¯•å„ç§FITæ–‡ä»¶æ ¼å¼
- æ•°æ®å­˜å‚¨ï¼šæµ‹è¯•CRUDæ“ä½œ
- CSVå¯¼å‡ºï¼šæµ‹è¯•å„ç§å¯¼å‡ºæ¨¡å¼
- å‰ç«¯charts.jsï¼šæµ‹è¯•å­—æ®µæ ‡ç­¾æ˜ å°„ã€æ•°æ®è½¬æ¢å‡½æ•°

### 10.2 é›†æˆæµ‹è¯•
- APIç«¯ç‚¹æµ‹è¯•
- å‰åç«¯è”è°ƒæµ‹è¯•

### 10.3 ç³»ç»Ÿæµ‹è¯•
- ä½¿ç”¨Playwrightè¿›è¡Œç«¯åˆ°ç«¯UIæµ‹è¯•
- æµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹ï¼ˆä¸Šä¼ ã€æŸ¥çœ‹ã€å¯¹æ¯”ã€å¯¼å‡ºï¼‰

### 10.4 æµ‹è¯•æ•°æ®
- Garminå®˜æ–¹ç¤ºä¾‹FITæ–‡ä»¶
- ç”¨æˆ·æä¾›çš„çœŸå®FITæ–‡ä»¶
- `data/546218476_ACTIVITY.fit` ä½œä¸ºæ ‡å‡†æµ‹è¯•æ–‡ä»¶

## 11. éƒ¨ç½²æ–¹æ¡ˆ

### 11.1 å¼€å‘ç¯å¢ƒ
```powershell
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd c:\MyScripts\test\fitanalysis
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# å®‰è£…ä¾èµ–
pip install -r backend\requirements.txt

# å¯åŠ¨æœåŠ¡
cd backend
uvicorn main:app --reload --port 8080

# è®¿é—®åº”ç”¨
# http://localhost:8080
```

### 11.2 ç”Ÿäº§ç¯å¢ƒ (æœ¬åœ°ä½¿ç”¨)
```powershell
# ä½¿ç”¨ run.bat ä¸€é”®å¯åŠ¨
.\run.bat
```

## 12. è¿­ä»£è®¡åˆ’

### 12.1 ç‰ˆæœ¬è§„åˆ’
- **v0.1**: åŸºç¡€åŠŸèƒ½ - ä¸Šä¼ è§£æã€æ´»åŠ¨åˆ—è¡¨ã€è¶‹åŠ¿å›¾
- **v0.2**: å¢å¼ºåŠŸèƒ½ - åŒå­—æ®µå åŠ ã€æ‚¬åœç»†èŠ‚ã€æ¯åœˆè¡¨æ ¼
- **v0.3**: é«˜çº§åŠŸèƒ½ - å¤šæ´»åŠ¨å¯¹æ¯”ã€CSVå¯¼å‡º
- **v1.0**: æ­£å¼å‘å¸ƒ - ä¼˜åŒ–æ€§èƒ½ã€å®Œå–„UI

### 12.2 é‡Œç¨‹ç¢‘
| ç‰ˆæœ¬ | å‘å¸ƒæ—¥æœŸ | ä¸»è¦åŠŸèƒ½ | çŠ¶æ€ |
|------|----------|----------|------|
| v0.1 | 2024-12-10 | MVPå®ç° | TODO |
| v0.2 | 2024-12-15 | å¢å¼ºåŠŸèƒ½ | TODO |
| v0.3 | 2024-12-20 | é«˜çº§åŠŸèƒ½ | TODO |
| v1.0 | 2024-12-31 | æ­£å¼å‘å¸ƒ | TODO |

## 13. é™„å½•

### 13.1 æœ¯è¯­è¡¨
- **FIT**: Flexible and Interoperable Data Transferï¼ŒGarminå¼€å‘çš„è¿åŠ¨æ•°æ®æ ¼å¼
- **Record**: ç§’çº§æ•°æ®è®°å½•
- **Lap**: æ¯åœˆ/åˆ†æ®µæ±‡æ€»æ•°æ®
- **Session**: æ•´ä½“æ´»åŠ¨æ±‡æ€»
- **IQ**: Garmin Connect IQï¼Œç¬¬ä¸‰æ–¹åº”ç”¨æ‰©å±•å¹³å°
- **é¾™è±†è·‘æ­¥**: ä¸€æ¬¾Connect IQè·‘æ­¥åŠ¨æ€åˆ†æPodåº”ç”¨

### 13.2 å‚è€ƒèµ„æ–™
- [FIT SDK](https://developer.garmin.com/fit/protocol/)
- [fitdecodeæ–‡æ¡£](https://github.com/polyvertex/fitdecode)
- [Plotly.jsæ–‡æ¡£](https://plotly.com/javascript/)
- [FastAPIæ–‡æ¡£](https://fastapi.tiangolo.com/)

### 13.3 è®¾å¤‡æ˜ å°„ç³»ç»Ÿ (Device Mapping System) - v1.8.0

#### 13.3.1 è®¾è®¡ç›®æ ‡

**æ ¸å¿ƒé—®é¢˜è§£å†³ï¼š**
- âŒ **ç¡¬ç¼–ç é—®é¢˜**: å‰ç«¯JavaScriptç¡¬ç¼–ç 23ä¸ªé¾™è±†å­—æ®µæ ‡ç­¾ï¼Œéš¾ä»¥ç»´æŠ¤
- âŒ **é‡å¤å‰ç¼€é—®é¢˜**: åˆ«åè§„èŒƒåŒ–å¯¼è‡´DR_DR_é‡å¤å‰ç¼€ï¼ˆdr_dr_gct â†’ DR_DR_è§¦åœ°æ—¶é—´ï¼‰
- âŒ **å¤§å°å†™ä¸ä¸€è‡´**: dr_ssl/dr_SSLã€dr_v_ilr/dr_v_ILRç­‰å¤§å°å†™æ··ä¹±
- âŒ **æ‰©å±•æ€§å·®**: æ–°å¢è®¾å¤‡ï¼ˆGarminã€Strydï¼‰éœ€è¦å‰åç«¯åŒæ­¥ä¿®æ”¹

**è§£å†³æ–¹æ¡ˆï¼š**
- âœ… **é…ç½®é©±åŠ¨**: Backendé›†ä¸­ç®¡ç†æ‰€æœ‰è®¾å¤‡å­—æ®µé…ç½®ï¼Œå‰ç«¯åŠ¨æ€åŠ è½½
- âœ… **å®˜æ–¹å¤§å°å†™**: 23ä¸ªDragonRunå­—æ®µä½¿ç”¨å®˜æ–¹è§„èŒƒï¼ˆdr_SSLã€dr_LSSã€dr_v_ILRç­‰ï¼‰
- âœ… **åˆ«åç³»ç»Ÿ**: 16ä¸ªåˆ«åæ˜ å°„ï¼ˆdr_sslâ†’dr_SSLã€dr_stanceâ†’dr_gctï¼‰
- âœ… **å•ä½è½¬æ¢**: storage_unit/display_unitæ”¯æŒé€Ÿåº¦â†’é…é€Ÿè½¬æ¢
- âœ… **å¤šè®¾å¤‡æ¶æ„**: DeviceRegistryå•ä¾‹æ”¯æŒæ‰©å±•åˆ°Garminã€Strydç­‰è®¾å¤‡

#### 13.3.2 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (device_mappings.py)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FieldMapping (Dataclass)                                       â”‚
â”‚    - field_name: str (dr_SSL, dr_gct)                          â”‚
â”‚    - display_label: str (æ­¥é€ŸæŸå¤±, è§¦åœ°æ—¶é—´)                   â”‚
â”‚    - unit: str (Deprecated, use display_unit)                  â”‚
â”‚    - storage_unit: str (m/s for speed)                         â”‚
â”‚    - display_unit: str (min/km for pace)                       â”‚
â”‚    - requires_conversion: bool                                  â”‚
â”‚    - precision: int (0-3)                                      â”‚
â”‚    - description: str                                           â”‚
â”‚    - field_category: str                                        â”‚
â”‚                                                                  â”‚
â”‚  DeviceConfig (Dataclass)                                       â”‚
â”‚    - device_id: str (dragonrun)                                â”‚
â”‚    - device_name: str (é¾™è±†è·‘æ­¥)                               â”‚
â”‚    - field_prefix: str (dr_)                                   â”‚
â”‚    - display_prefix: str (DR_)                                 â”‚
â”‚    - fields: Dict[str, FieldMapping]                           â”‚
â”‚    - field_aliases: Dict[str, str]                             â”‚
â”‚                                                                  â”‚
â”‚  DeviceRegistry (Singleton)                                     â”‚
â”‚    + register(DeviceConfig)                                     â”‚
â”‚    + normalize_field_name(field: str) -> str                   â”‚
â”‚    + get_display_label(field: str) -> str                      â”‚
â”‚    + get_device_by_prefix(field: str) -> DeviceConfig          â”‚
â”‚    + get_all_devices_config() -> Dict[str, Any]  (API Export) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTP GET
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API Endpoint: /api/device-mappings                  â”‚
â”‚  Response (JSON):                                                â”‚
â”‚  {                                                               â”‚
â”‚    "dragonrun": {                                               â”‚
â”‚      "device_name": "é¾™è±†è·‘æ­¥",                                 â”‚
â”‚      "field_prefix": "dr_",                                     â”‚
â”‚      "display_prefix": "DR_",                                   â”‚
â”‚      "fields": [                                                â”‚
â”‚        {                                                         â”‚
â”‚          "field_name": "dr_SSL",                                â”‚
â”‚          "display_label": "æ­¥é€ŸæŸå¤±",                           â”‚
â”‚          "unit": "cm/s",                                        â”‚
â”‚          "storage_unit": "cm/s",                                â”‚
â”‚          "display_unit": "cm/s",                                â”‚
â”‚          "requires_conversion": false,                          â”‚
â”‚          "precision": 2,                                        â”‚
â”‚          "full_label": "DR_æ­¥é€ŸæŸå¤± (cm/s)",                   â”‚
â”‚          "description": "æ¯æ¬¡ç€åœ°æ—¶é€Ÿåº¦æŸå¤±é‡",                 â”‚
â”‚          "category": "dynamics"                                 â”‚
â”‚        },                                                        â”‚
â”‚        ...                                                       â”‚
â”‚      ]                                                           â”‚
â”‚    }                                                             â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ Fetch on DOMContentLoaded
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (charts.js)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Global State:                                                   â”‚
â”‚    window.deviceConfigs = null                                  â”‚
â”‚    window.deviceFieldsMap = new Map()  // O(1) lookup          â”‚
â”‚                                                                  â”‚
â”‚  loadDeviceFieldConfigs() - Async                               â”‚
â”‚    â†’ fetch('/api/device-mappings')                              â”‚
â”‚    â†’ populate deviceConfigs + deviceFieldsMap                   â”‚
â”‚                                                                  â”‚
â”‚  speed_to_pace(speedMs) -> "M:SS"                               â”‚
â”‚    â†’ 1000 / speedMs â†’ MM:SS format                             â”‚
â”‚                                                                  â”‚
â”‚  formatFieldValue(fieldName, value, precision) -> string        â”‚
â”‚    â†’ check requires_conversion                                  â”‚
â”‚    â†’ call speed_to_pace() if needed                            â”‚
â”‚    â†’ apply precision                                            â”‚
â”‚                                                                  â”‚
â”‚  getFieldLabel(field, isIqField) -> string                      â”‚
â”‚    â†’ lookup deviceFieldsMap.get(field)                         â”‚
â”‚    â†’ return full_label (DR_æ­¥é€ŸæŸå¤± (cm/s))                    â”‚
â”‚    â†’ handle Lap fields (åœˆå¹³å‡xxx)                             â”‚
â”‚    â†’ fallback to FIELD_LABELS for standard fields              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æµ:**
1. æœåŠ¡å™¨å¯åŠ¨ â†’ DeviceRegistryåˆå§‹åŒ– â†’ æ³¨å†ŒDragonRunè®¾å¤‡
2. å‰ç«¯åŠ è½½ â†’ DOMContentLoaded â†’ loadDeviceFieldConfigs()
3. APIè°ƒç”¨ â†’ /api/device-mappings â†’ è¿”å›JSONé…ç½®
4. é…ç½®åŠ è½½ â†’ window.deviceFieldsMapå¡«å…… â†’ O(1)å­—æ®µæŸ¥æ‰¾
5. å›¾è¡¨æ¸²æŸ“ â†’ getFieldLabel()æŸ¥è¯¢æ ‡ç­¾ â†’ formatFieldValue()è½¬æ¢æ•°å€¼
6. è¡¨æ ¼æ¸²æŸ“ â†’ speed_to_pace()é…é€Ÿè½¬æ¢ â†’ æ˜¾ç¤º"5:23"æ ¼å¼

#### 13.3.3 DragonRunå­—æ®µæ˜ å°„è¡¨

| å­—æ®µå | æ˜¾ç¤ºæ ‡ç­¾ | å•ä½ | å­˜å‚¨å•ä½ | æ˜¾ç¤ºå•ä½ | è½¬æ¢ | ç²¾åº¦ | åˆ†ç±» | åˆ«å |
|--------|----------|------|----------|----------|------|------|------|------|
| dr_timestamp | æ—¶é—´æˆ³ | ms | ms | ms | âŒ | 2 | basic | - |
| dr_distance | è·ç¦» | m | m | m | âŒ | 2 | basic | - |
| dr_speed | é…é€Ÿ | min/km | m/s | min/km | âœ… | 2 | pace | - |
| dr_cadence | æ­¥é¢‘ | spm | spm | spm | âŒ | 2 | dynamics | - |
| dr_stride | æ­¥å¹… | cm | cm | cm | âŒ | 2 | dynamics | - |
| dr_gct | è§¦åœ°æ—¶é—´ | ms | ms | ms | âŒ | 2 | dynamics | dr_stance |
| dr_air_time | è…¾ç©ºæ—¶é—´ | ms | ms | ms | âŒ | 2 | dynamics | dr_air, dr_at |
| dr_v_osc | å‚ç›´æŒ¯å¹… | cm | cm | cm | âŒ | 2 | dynamics | dr_vertical_osc, dr_vert_osc |
| dr_vertical_ratio | å‚ç›´æ­¥å¹…æ¯” | % | % | % | âŒ | 2 | dynamics | - |
| **dr_SSL** | æ­¥é€ŸæŸå¤± | cm/s | cm/s | cm/s | âŒ | 2 | dynamics | dr_ssl |
| **dr_SSL_percent** | æ­¥é€ŸæŸå¤±å æ¯” | % | % | % | âŒ | 2 | dynamics | dr_ssl%, dr_SSL% |
| dr_vertical_power | å‚ç›´åŠŸç‡ | W | W | W | âŒ | 2 | power | - |
| dr_propulsive_power | å‰è¿›åŠŸç‡ | W | W | W | âŒ | 2 | power | dr_prop_power |
| dr_slope_power | å¡åº¦åŠŸç‡ | W | W | W | âŒ | 2 | power | dr_slop_power |
| dr_total_power | æ€»åŠŸç‡ | W | W | W | âŒ | 2 | power | - |
| **dr_LSS** | ä¸‹è‚¢åˆšåº¦ | kN/m | kN/m | kN/m | âŒ | 2 | biomechanics | dr_lss |
| **dr_v_ILR** | å‚ç›´å†²å‡»åŠ› | bw/s | bw/s | bw/s | âŒ | 2 | impact | dr_v_ilr |
| **dr_h_ILR** | æ°´å¹³å†²å‡»åŠ› | bw/s | bw/s | bw/s | âŒ | 2 | impact | dr_h_ilr |
| **dr_v_PIF** | å‚ç›´å†²å‡»å³°å€¼ | g | g | g | âŒ | 2 | impact | dr_v_pif |
| **dr_h_PIF** | æ°´å¹³å†²å‡»å³°å€¼ | g | g | g | âŒ | 2 | impact | dr_h_pif |
| **dr_body_X_PIF** | ä¼ æ„Ÿå™¨Xè½´å†²å‡» | g | g | g | âŒ | 2 | impact | dr_body_x_pif |
| **dr_body_Y_PIF** | ä¼ æ„Ÿå™¨Yè½´å†²å‡» | g | g | g | âŒ | 2 | impact | dr_body_y_pif |
| **dr_body_Z_PIF** | ä¼ æ„Ÿå™¨Zè½´å†²å‡» | g | g | g | âŒ | 2 | impact | dr_body_z_pif |

**è¯´æ˜:**
- **ç²—ä½“å­—æ®µ**: å®˜æ–¹å¤§å°å†™ï¼ˆSSLã€LSSã€ILRã€PIFã€X/Y/Zå¤§å†™ï¼‰
- **è½¬æ¢å­—æ®µ**: dr_speedéœ€è¦m/sâ†’min/kmè½¬æ¢
- **åˆ«åæ•°é‡**: 16ä¸ªåˆ«åæ˜ å°„ï¼ˆ6ä¸ªå®˜æ–¹ç¼©å†™ + 10ä¸ªå¤§å°å†™å˜ä½“ï¼‰

#### 13.3.4 APIå¥‘çº¦

**Endpoint:** `GET /api/device-mappings`

**Response Schema:**
```json
{
  "<device_id>": {
    "device_name": string,
    "field_prefix": string,
    "display_prefix": string,
    "fields": [
      {
        "field_name": string,
        "display_label": string,
        "unit": string (Deprecated),
        "storage_unit": string,
        "display_unit": string,
        "requires_conversion": boolean,
        "precision": integer (0-3),
        "full_label": string,
        "description": string,
        "category": string
      }
    ]
  }
}
```

**æ€§èƒ½è¦æ±‚:**
- å“åº”æ—¶é—´: < 3s (é¦–æ¬¡è¯·æ±‚ï¼Œå«HTTPå¼€é”€)
- ç¼“å­˜ç­–ç•¥: å‰ç«¯å…¨å±€ç¼“å­˜ï¼ˆwindow.deviceConfigsï¼‰
- æ•°æ®å¤§å°: ~15KB (DragonRun 23å­—æ®µ)

**é”™è¯¯å¤„ç†:**
- 400: æ— æ•ˆè¯·æ±‚
- 404: è®¾å¤‡ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 13.3.5 å‰ç«¯é›†æˆ

**åˆå§‹åŒ–æµç¨‹:**
```javascript
// app.js - DOMContentLoaded
document.addEventListener('DOMContentLoaded', async () => {
    await loadDeviceFieldConfigs();  // ä¼˜å…ˆåŠ è½½é…ç½®
    loadActivities();
    loadVersion();
});
```

**å­—æ®µæ ‡ç­¾æŸ¥è¯¢:**
```javascript
// charts.js - åŠ¨æ€æ ‡ç­¾ç”Ÿæˆ
function getFieldLabel(field, isIqField = false) {
    const fieldKey = field.replace('iq_', '');
    
    // ä¼˜å…ˆä»è®¾å¤‡é…ç½®æŸ¥è¯¢
    if (window.deviceFieldsMap && window.deviceFieldsMap.has(fieldKey)) {
        const config = window.deviceFieldsMap.get(fieldKey);
        return config.full_label;  // "DR_æ­¥é€ŸæŸå¤± (cm/s)"
    }
    
    // Lapå­—æ®µåŠ¨æ€ç”Ÿæˆ
    if (fieldKey.startsWith('dr_lap_avg_')) {
        const baseField = fieldKey.replace('dr_lap_avg_', 'dr_');
        if (window.deviceFieldsMap.has(baseField)) {
            const baseConfig = window.deviceFieldsMap.get(baseField);
            return `åœˆå¹³å‡${baseConfig.display_label} (${baseConfig.unit})`;
        }
    }
    
    // å›é€€åˆ°ç¡¬ç¼–ç æ ‡å‡†å­—æ®µ
    return FIELD_LABELS[field] || field;
}
```

**æ•°å€¼è½¬æ¢:**
```javascript
// charts.js - é…é€Ÿè½¬æ¢
function speed_to_pace(speedMs) {
    if (!speedMs || speedMs <= 0) return '--';
    const paceSecPerKm = 1000 / speedMs;
    const minutes = Math.floor(paceSecPerKm / 60);
    const seconds = Math.round(paceSecPerKm % 60);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

// è¡¨æ ¼æ¸²æŸ“ç¤ºä¾‹
if (field === 'iq_dr_speed' || field === 'avg_speed') {
    formatted = speed_to_pace(value);  // "5:23"
} else if (window.deviceFieldsMap.has(fieldKey)) {
    formatted = formatFieldValue(fieldKey, value);
}
```

#### 13.3.6 å¤šè®¾å¤‡æ‰©å±•æŒ‡å—

**æ·»åŠ æ–°è®¾å¤‡ï¼ˆGarmin HRM-Proç¤ºä¾‹ï¼‰:**

1. **Backendé…ç½®** (`backend/device_mappings.py`):
```python
GARMIN_FIELDS = {
    'garmin_gct': FieldMapping(
        field_name='garmin_gct',
        display_label='Ground Contact Time',
        unit='ms',
        storage_unit='ms',
        display_unit='ms',
        requires_conversion=False,
        precision=2,
        description='Garmin running dynamics GCT',
        field_category='dynamics'
    ),
    'garmin_vo': FieldMapping(
        field_name='garmin_vo',
        display_label='Vertical Oscillation',
        unit='cm',
        storage_unit='cm',
        display_unit='cm',
        requires_conversion=False,
        precision=2,
        description='Garmin vertical oscillation',
        field_category='dynamics'
    ),
}

GARMIN_FIELD_ALIASES = {
    'garmin_stance_time': 'garmin_gct',
    'garmin_vert_osc': 'garmin_vo'
}

DeviceRegistry.register(DeviceConfig(
    device_id='garmin',
    device_name='Garmin',
    field_prefix='garmin_',
    display_prefix='Garmin_',
    fields=GARMIN_FIELDS,
    field_aliases=GARMIN_FIELD_ALIASES
))
```

2. **FITè§£æå™¨é›†æˆ** (`backend/fit_parser.py`):
```python
def extract_developer_fields(record):
    # ç°æœ‰DragonRuné€»è¾‘...
    
    # æ–°å¢Garminæ£€æµ‹
    if field_name.startswith('garmin_'):
        normalized = DeviceRegistry.normalize_field_name(field_name)
        iq_data[normalized] = record.get_value(dev_field.name)
```

3. **Frontendè‡ªåŠ¨æ”¯æŒ** - æ— éœ€ä¿®æ”¹ï¼
   - APIä¼šè‡ªåŠ¨å¯¼å‡ºGarminé…ç½®
   - `loadDeviceFieldConfigs()`è‡ªåŠ¨åŠ è½½
   - `getFieldLabel()`è‡ªåŠ¨è¯†åˆ«garmin_å‰ç¼€
   - UIå­—æ®µé€‰æ‹©å™¨è‡ªåŠ¨åˆ†ç»„æ˜¾ç¤º

#### 13.3.7 æ€§èƒ½è€ƒè™‘

**Backendä¼˜åŒ–:**
- DeviceRegistryå•ä¾‹æ¨¡å¼ï¼Œé¿å…é‡å¤æ³¨å†Œ
- FieldMappingä½¿ç”¨dataclassï¼Œå†…å­˜æ•ˆç‡é«˜
- normalize_field_name()ä½¿ç”¨dictæŸ¥æ‰¾ï¼ŒO(1)æ—¶é—´å¤æ‚åº¦

**Frontendä¼˜åŒ–:**
- deviceFieldsMapä½¿ç”¨Mapæ•°æ®ç»“æ„ï¼ŒO(1)æŸ¥æ‰¾
- å…¨å±€ç¼“å­˜ï¼Œé¿å…é‡å¤APIè¯·æ±‚
- ä»…åœ¨DOMContentLoadedæ—¶åŠ è½½ä¸€æ¬¡

**APIä¼˜åŒ–:**
- æ— æ•°æ®åº“æŸ¥è¯¢ï¼Œçº¯å†…å­˜æ“ä½œ
- å“åº”ç¼“å­˜å‹å¥½ï¼ˆé…ç½®å¾ˆå°‘å˜åŒ–ï¼‰
- gzipå‹ç¼©ï¼ˆ~15KB â†’ ~3KBï¼‰

**æµ‹è¯•è¦†ç›–:**
- å•å…ƒæµ‹è¯•: 18ä¸ªæµ‹è¯•ï¼ˆåˆ«åè§„èŒƒåŒ–ã€æ ‡ç­¾ç”Ÿæˆã€è®¾å¤‡æ³¨å†Œã€å­—æ®µåˆ†ç±»ã€å•ä½è½¬æ¢ï¼‰
- é›†æˆæµ‹è¯•: 9ä¸ªæµ‹è¯•ï¼ˆAPIå“åº”ã€JSONç»“æ„ã€23å­—æ®µå®Œæ•´æ€§ã€æ— é‡å¤å‰ç¼€ã€æ€§èƒ½ï¼‰
- æµ‹è¯•é€šè¿‡ç‡: 100% (27/27)

#### 13.3.8 UIè®¾è®¡ - å¡ç‰‡å¼å­—æ®µé€‰æ‹©å™¨

**ä¸‰å±‚ç»“æ„:**
```
.field-selector-container
â”œâ”€â”€ .field-selector-toolbar (Stickyé¡¶éƒ¨)
â”‚   â”œâ”€â”€ Search Input (æœç´¢æ¡† + SVGå›¾æ ‡)
â”‚   â””â”€â”€ Control Buttons (å…¨é€‰/å…¨ä¸é€‰/å±•å¼€/æŠ˜å )
â”œâ”€â”€ .field-selector-body
â”‚   â””â”€â”€ .field-groups-grid (4åˆ—å“åº”å¼ç½‘æ ¼)
â”‚       â”œâ”€â”€ .field-group-card (å¿ƒç‡)
â”‚       â”‚   â”œâ”€â”€ .field-group-header (ğŸ“Š + æ ‡é¢˜ + å±•å¼€å›¾æ ‡)
â”‚       â”‚   â””â”€â”€ .field-group-content
â”‚       â”‚       â”œâ”€â”€ checkbox: å¿ƒç‡
â”‚       â”‚       â”œâ”€â”€ checkbox: å¹³å‡å¿ƒç‡
â”‚       â”‚       â””â”€â”€ checkbox: æœ€å¤§å¿ƒç‡
â”‚       â”œâ”€â”€ .field-group-card (é¾™è±†åŠŸç‡)
â”‚       â””â”€â”€ ...
```

**å“åº”å¼å¸ƒå±€:**
- 1400px+: 4åˆ—ç½‘æ ¼
- 1000-1400px: 3åˆ—ç½‘æ ¼
- 1000px-: 2åˆ—ç½‘æ ¼

**äº¤äº’ç‰¹æ€§:**
- âœ¨ Stickyå·¥å…·æ ï¼šæ»šåŠ¨æ—¶ä¿æŒå¯è§
- ğŸ” å®æ—¶æœç´¢ï¼šè¾“å…¥æ—¶å³æ—¶è¿‡æ»¤ï¼Œé«˜äº®åŒ¹é…æ–‡æœ¬
- ğŸ¨ Hoveræ•ˆæœï¼šå¡ç‰‡é˜´å½±åŠ æ·±ï¼Œè¾¹æ¡†å˜è‰²
- ğŸ“ å¹³æ»‘åŠ¨ç”»ï¼šå±•å¼€/æŠ˜å ä½¿ç”¨max-heightè¿‡æ¸¡ï¼ˆ0.3s easeï¼‰
- ğŸ’¾ çŠ¶æ€æŒä¹…åŒ–ï¼šlocalStorageä¿å­˜é€‰æ‹©å’Œå±•å¼€çŠ¶æ€

**æ ·å¼è§„èŒƒ:**
- å¡ç‰‡åœ†è§’: 8px
- å¡ç‰‡è¾¹æ¡†: #e0e0e0 (hover: #3498db)
- æ ‡é¢˜å­—å·: 14px, font-weight: 600
- å›¾æ ‡: Emoji (ğŸ“Šâ¤ï¸âš¡ğŸƒğŸ’ªğŸ¯)
- é—´è·: 12px (å¡ç‰‡é—´è·)

---

## 14. ç‰ˆæœ¬å‘å¸ƒè®°å½•

### v1.8.0 (2026-01-20)
**ä¸»è¦æ›´æ–°ï¼šè®¾å¤‡æ˜ å°„ç³»ç»Ÿé‡æ„å’Œå­—æ®µé€‰æ‹©å™¨UIä¼˜åŒ–**

**æ ¸å¿ƒé—®é¢˜è§£å†³ï¼š**
- ğŸ› **ä¿®å¤DR_DR_é‡å¤å‰ç¼€**: åˆ«åè§„èŒƒåŒ–å¯¼è‡´çš„æ˜¾ç¤ºbugï¼ˆdr_ssl â†’ dr_SSLï¼Œè€Œédr_dr_sslï¼‰
- ğŸ”§ **å®˜æ–¹å¤§å°å†™è§„èŒƒ**: 23ä¸ªDragonRunå­—æ®µä½¿ç”¨å®˜æ–¹è§„èŒƒï¼ˆdr_SSLã€dr_LSSã€dr_v_ILRã€dr_v_PIFç­‰ï¼‰
- ğŸŒ **åŠ¨æ€é…ç½®åŠ è½½**: å‰ç«¯ä¸å†ç¡¬ç¼–ç å­—æ®µæ ‡ç­¾ï¼Œä»APIåŠ è½½é…ç½®
- ğŸ¨ **å¡ç‰‡å¼UI**: å­—æ®µé€‰æ‹©å™¨æ”¹ä¸º4åˆ—å“åº”å¼å¡ç‰‡å¸ƒå±€ï¼Œæ”¯æŒæœç´¢/æŠ˜å 
- ğŸ—‘ï¸ **Reset AllåŠŸèƒ½**: ä¸€é”®æ¸…ç©ºæ‰€æœ‰æ´»åŠ¨æ•°æ®

**æ–°å¢åŠŸèƒ½ï¼š**
- ğŸ“‹ **Backendè®¾å¤‡æ˜ å°„ç³»ç»Ÿ**:
  - `backend/device_mappings.py`: 650è¡Œæ–°æ¨¡å—ï¼Œé›†ä¸­ç®¡ç†è®¾å¤‡å­—æ®µé…ç½®
  - `FieldMapping` dataclass: storage_unit/display_unit/requires_conversion/precision
  - `DeviceConfig` dataclass: device_id/device_name/field_prefix/display_prefix/fields/field_aliases
  - `DeviceRegistry` å•ä¾‹: normalize_field_name()/get_display_label()/get_all_devices_config()
  - 23ä¸ªDragonRunå­—æ®µé…ç½®ï¼ˆå®˜æ–¹å¤§å°å†™ï¼‰
  - 16ä¸ªåˆ«åæ˜ å°„ï¼ˆ6ä¸ªå®˜æ–¹ç¼©å†™ + 10ä¸ªå¤§å°å†™å˜ä½“ï¼‰
  
- ğŸŒ **APIç«¯ç‚¹**:
  - `GET /api/device-mappings`: å¯¼å‡ºæ‰€æœ‰è®¾å¤‡é…ç½®ï¼ˆJSONæ ¼å¼ï¼‰
  - æ€§èƒ½ä¼˜åŒ–: å†…å­˜æ“ä½œï¼Œæ— æ•°æ®åº“æŸ¥è¯¢ï¼Œ<3så“åº”ï¼ˆé¦–æ¬¡è¯·æ±‚ï¼‰
  
- ğŸ’» **FrontendåŠ¨æ€é…ç½®**:
  - `loadDeviceFieldConfigs()`: DOMContentLoadedæ—¶åŠ è½½é…ç½®åˆ°å…¨å±€Map
  - `speed_to_pace(speedMs)`: m/s â†’ min/kmè½¬æ¢ï¼ˆ"5:23"æ ¼å¼ï¼‰
  - `formatFieldValue(fieldName, value, precision)`: å•ä½è½¬æ¢ + ç²¾åº¦æ§åˆ¶
  - `getFieldLabel(field)`: ä»deviceFieldsMapæŸ¥è¯¢æ ‡ç­¾ï¼ˆO(1)ï¼‰
  - åˆ é™¤ç¡¬ç¼–ç çš„`IQ_FIELD_LABELS`å­—å…¸ï¼ˆ25è¡Œä»£ç ç§»é™¤ï¼‰
  - Lapå­—æ®µåŠ¨æ€ç”Ÿæˆï¼ˆåœˆå¹³å‡xxxï¼‰
  
- ğŸ¨ **å¡ç‰‡å¼å­—æ®µé€‰æ‹©å™¨UI**:
  - ä¸‰å±‚ç»“æ„: toolbar + body + cards
  - Stickyå·¥å…·æ : æœç´¢æ¡† + å…¨é€‰/å…¨ä¸é€‰ + å±•å¼€/æŠ˜å å…¨éƒ¨
  - 4åˆ—å“åº”å¼ç½‘æ ¼ï¼ˆ1400pxâ†’3åˆ—, 1000pxâ†’2åˆ—ï¼‰
  - å®æ—¶æœç´¢: è¾“å…¥æ—¶å³æ—¶è¿‡æ»¤ï¼Œé«˜äº®åŒ¹é…
  - å¹³æ»‘åŠ¨ç”»: max-heightè¿‡æ¸¡ï¼ˆ0.3s easeï¼‰
  - Hoveræ•ˆæœ: å¡ç‰‡é˜´å½± + è¾¹æ¡†å˜è‰²
  - Emojiå›¾æ ‡: ğŸ“Šâ¤ï¸âš¡ğŸƒğŸ’ªğŸ¯
  
- ğŸ—‘ï¸ **Reset AllæŒ‰é’®**:
  - æ´»åŠ¨åˆ—è¡¨é¡¶éƒ¨å·¥å…·æ æ·»åŠ "Reset All"æŒ‰é’®
  - åŒé‡ç¡®è®¤æœºåˆ¶ï¼ˆä¸¤æ¬¡å¼¹çª—ï¼‰
  - è°ƒç”¨`DELETE /api/activities/all`æ¸…ç©ºæ‰€æœ‰æ•°æ®
  - è‡ªåŠ¨åˆ·æ–°æ´»åŠ¨åˆ—è¡¨

**æŠ€æœ¯å®ç°ï¼š**
- **Backendæ”¹è¿›**:
  - `backend/device_mappings.py`: æ–°å¢650è¡Œè®¾å¤‡é…ç½®æ¨¡å—
  - `backend/main.py`: æ·»åŠ `/api/device-mappings`ç«¯ç‚¹
  - `FieldMapping.__post_init__()`: è‡ªåŠ¨å¡«å……storage_unit/display_unitï¼ˆé»˜è®¤ç­‰äºunitï¼‰
  
- **Frontendé‡æ„**:
  - `frontend/index.html`: é‡æ„å­—æ®µé€‰æ‹©å™¨HTMLç»“æ„ï¼ˆä¸‰å±‚åµŒå¥—ï¼‰
  - `frontend/css/styles.css`: æ–°å¢200+è¡Œå¡ç‰‡æ ·å¼ï¼ˆstickyã€gridã€hoverã€transitionï¼‰
  - `frontend/js/charts.js`: 
    - æ–°å¢å…¨å±€å˜é‡`window.deviceConfigs`å’Œ`window.deviceFieldsMap`
    - æ–°å¢3ä¸ªæ ¸å¿ƒå‡½æ•°ï¼ˆloadDeviceFieldConfigsã€speed_to_paceã€formatFieldValueï¼‰
    - é‡å†™`renderUnifiedFieldSelector()`æ”¯æŒå¡ç‰‡å¸ƒå±€
    - ä¿®æ”¹`getFieldLabel()`ä½¿ç”¨åŠ¨æ€é…ç½®
    - åˆ é™¤`IQ_FIELD_LABELS`ç¡¬ç¼–ç å­—å…¸
  - `frontend/js/app.js`: 
    - DOMContentLoadedä¸­è°ƒç”¨`loadDeviceFieldConfigs()`
    - æ·»åŠ `handleResetAll()`åŒé‡ç¡®è®¤é€»è¾‘
    - ç»‘å®šå·¥å…·æ äº‹ä»¶ï¼ˆæœç´¢ã€å…¨é€‰ã€å±•å¼€/æŠ˜å ï¼‰
    
- **æµ‹è¯•è¦†ç›–**:
  - `test/config/expected_fields.json`: 23å­—æ®µå®Œæ•´é…ç½®
  - `test/config/test_constants.py`: æ€§èƒ½é˜ˆå€¼æ›´æ–°ï¼ˆAPI<3sï¼‰
  - `test/backend/test_device_mappings.py`: 18ä¸ªå•å…ƒæµ‹è¯•ï¼ˆåˆ«åã€æ ‡ç­¾ã€å•ä½è½¬æ¢ã€ç²¾åº¦ï¼‰
  - `test/integration/test_api_device_mappings.py`: 9ä¸ªé›†æˆæµ‹è¯•ï¼ˆAPIå“åº”ã€å­—æ®µå®Œæ•´æ€§ã€æ€§èƒ½ï¼‰
  - **æµ‹è¯•é€šè¿‡ç‡**: 100% (27/27)

**æ•°æ®æ¨¡å‹å˜æ›´ï¼š**
```python
# FieldMappingæ–°å¢å±æ€§
storage_unit: str = None      # å­˜å‚¨å•ä½ï¼ˆm/sï¼‰
display_unit: str = None      # æ˜¾ç¤ºå•ä½ï¼ˆmin/kmï¼‰
requires_conversion: bool = False  # æ˜¯å¦éœ€è¦è½¬æ¢
precision: int = 2            # å°æ•°ä½æ•°
```

**DragonRunå­—æ®µå®˜æ–¹å¤§å°å†™è§„èŒƒï¼š**
| åŸåï¼ˆæ—§ï¼‰ | å®˜æ–¹åï¼ˆæ–°ï¼‰ | è¯´æ˜ |
|-----------|-------------|------|
| dr_ssl | **dr_SSL** | Speed Stride Lossï¼ˆå…¨å¤§å†™ï¼‰ |
| dr_ssl_percent | **dr_SSL_percent** | SSL%ï¼ˆSSLå¤§å†™ï¼‰ |
| dr_lss | **dr_LSS** | Leg Spring Stiffnessï¼ˆå…¨å¤§å†™ï¼‰ |
| dr_v_ilr | **dr_v_ILR** | Vertical Impact Loading Rateï¼ˆILRå¤§å†™ï¼‰ |
| dr_h_ilr | **dr_h_ILR** | Horizontal Impact Loading Rateï¼ˆILRå¤§å†™ï¼‰ |
| dr_v_pif | **dr_v_PIF** | Vertical Peak Impact Forceï¼ˆPIFå¤§å†™ï¼‰ |
| dr_h_pif | **dr_h_PIF** | Horizontal Peak Impact Forceï¼ˆPIFå¤§å†™ï¼‰ |
| dr_body_x_pif | **dr_body_X_PIF** | Body X-axis Peak Impactï¼ˆXå’ŒPIFå¤§å†™ï¼‰ |
| dr_body_y_pif | **dr_body_Y_PIF** | Body Y-axis Peak Impactï¼ˆYå’ŒPIFå¤§å†™ï¼‰ |
| dr_body_z_pif | **dr_body_Z_PIF** | Body Z-axis Peak Impactï¼ˆZå’ŒPIFå¤§å†™ï¼‰ |

**åˆ«åæ˜ å°„ï¼ˆ16ä¸ªï¼‰ï¼š**
```python
# å®˜æ–¹ç¼©å†™åˆ«åï¼ˆ6ä¸ªï¼‰
'dr_stance': 'dr_gct'                    # stance â†’ gct
'dr_air': 'dr_air_time'                  # air â†’ air_time
'dr_at': 'dr_air_time'                   # at â†’ air_time
'dr_vertical_osc': 'dr_v_osc'            # vertical_osc â†’ v_osc
'dr_vert_osc': 'dr_v_osc'                # vert_osc â†’ v_osc
'dr_prop_power': 'dr_propulsive_power'   # prop_power â†’ propulsive_power

# å¤§å°å†™å˜ä½“åˆ«åï¼ˆ10ä¸ªï¼‰
'dr_ssl': 'dr_SSL'
'dr_ssl%': 'dr_SSL_percent'
'dr_SSL%': 'dr_SSL_percent'
'dr_lss': 'dr_LSS'
'dr_v_ilr': 'dr_v_ILR'
'dr_h_ilr': 'dr_h_ILR'
'dr_v_pif': 'dr_v_PIF'
'dr_h_pif': 'dr_h_PIF'
'dr_body_x_pif': 'dr_body_X_PIF'
'dr_body_y_pif': 'dr_body_Y_PIF'
```

**Breaking Changes:**
- âš ï¸ **å‰ç«¯ä¾èµ–API**: é¦–æ¬¡åŠ è½½éœ€è°ƒç”¨`/api/device-mappings`ï¼Œå¦åˆ™IQå­—æ®µæ ‡ç­¾æ˜¾ç¤ºé”™è¯¯
- âš ï¸ **å­—æ®µåå¤§å°å†™**: dr_ssl/dr_lssç­‰å­—æ®µåæ”¹ä¸ºdr_SSL/dr_LSSï¼ˆå½±å“APIå“åº”å’Œå­˜å‚¨ï¼‰
- âš ï¸ **IQ_FIELD_LABELSåˆ é™¤**: ç¡¬ç¼–ç å­—å…¸å·²ç§»é™¤ï¼Œä¾èµ–åŠ¨æ€é…ç½®

**è¿ç§»æŒ‡å—ï¼š**
1. ç¡®ä¿Backendè¿è¡Œæ­£å¸¸ï¼ˆ`/api/device-mappings`å¯è®¿é—®ï¼‰
2. Frontendæ¸…ç©ºæµè§ˆå™¨ç¼“å­˜ï¼ˆé¿å…åŠ è½½æ—§JavaScriptï¼‰
3. æ£€æŸ¥localStorageå­—æ®µé€‰æ‹©æ˜¯å¦æ­£å¸¸æ¢å¤
4. éªŒè¯IQå­—æ®µæ ‡ç­¾æ˜¾ç¤ºæ­£ç¡®ï¼ˆDR_æ­¥é€ŸæŸå¤± è€ŒéDR_DR_æ­¥é€ŸæŸå¤±ï¼‰

**UIæˆªå›¾å¯¹æ¯”:**
- **Before**: ç¡¬ç¼–ç æ ‡ç­¾ï¼ŒDR_DR_é‡å¤å‰ç¼€ï¼Œå¤é€‰æ¡†åˆ—è¡¨
- **After**: åŠ¨æ€æ ‡ç­¾ï¼Œæ­£ç¡®å‰ç¼€ï¼Œå¡ç‰‡å¼ç½‘æ ¼ + æœç´¢ + æŠ˜å 

**æ€§èƒ½æŒ‡æ ‡:**
- APIå“åº”æ—¶é—´: <3sï¼ˆé¦–æ¬¡è¯·æ±‚ï¼ŒåŒ…å«HTTPå¼€é”€ï¼‰
- å­—æ®µæŸ¥æ‰¾: O(1)ï¼ˆMapæ•°æ®ç»“æ„ï¼‰
- å•å…ƒæµ‹è¯•: 18ä¸ªï¼Œ100%é€šè¿‡
- é›†æˆæµ‹è¯•: 9ä¸ªï¼Œ100%é€šè¿‡

**æ–‡ä»¶å˜æ›´ï¼š**
- `backend/device_mappings.py` - æ–°å¢650è¡Œè®¾å¤‡é…ç½®æ¨¡å—
- `backend/main.py` - æ·»åŠ /api/device-mappingsç«¯ç‚¹
- `frontend/index.html` - é‡æ„å­—æ®µé€‰æ‹©å™¨HTMLç»“æ„
- `frontend/css/styles.css` - æ–°å¢200+è¡Œå¡ç‰‡æ ·å¼
- `frontend/js/charts.js` - é‡å†™å­—æ®µé€‰æ‹©å™¨æ¸²æŸ“é€»è¾‘ï¼Œåˆ é™¤ç¡¬ç¼–ç 
- `frontend/js/app.js` - æ·»åŠ åŠ¨æ€é…ç½®åŠ è½½å’ŒReset All
- `config.py` - ç‰ˆæœ¬å·æ›´æ–°ä¸º1.8.0
- `test/config/expected_fields.json` - 23å­—æ®µå®Œæ•´é…ç½®
- `test/config/test_constants.py` - æ€§èƒ½é˜ˆå€¼æ›´æ–°
- `test/backend/test_device_mappings.py` - 18ä¸ªå•å…ƒæµ‹è¯•
- `test/integration/test_api_device_mappings.py` - 9ä¸ªé›†æˆæµ‹è¯•
- `RELEASE_v1.8.0.md` - è¯¦ç»†å‘å¸ƒè¯´æ˜
- `agent.md` - æ–°å¢Section 13.3è®¾å¤‡æ˜ å°„ç³»ç»Ÿæ–‡æ¡£

**æ‰©å±•æ€§:**
- âœ… æ”¯æŒå¤šè®¾å¤‡æ¶æ„ï¼ˆGarminã€Strydåªéœ€æ³¨å†Œé…ç½®ï¼‰
- âœ… Frontendæ— éœ€ä¿®æ”¹å³å¯æ”¯æŒæ–°è®¾å¤‡
- âœ… é…ç½®é©±åŠ¨ï¼Œæ˜“äºç»´æŠ¤

**å·²çŸ¥é—®é¢˜:**
- æ— 

---

### v1.7.0 (2026-01-19) - è®¡åˆ’ä¸­
**ä¸»è¦æ›´æ–°ï¼šå­—æ®µé€‰æ‹©å™¨åˆ†ç»„å’Œå•åœˆæ•°æ®å­—æ®µé€‰æ‹©**

**æ–°å¢åŠŸèƒ½ï¼š**
- ğŸ“Š **å•åœˆæ•°æ®å­—æ®µé€‰æ‹©å™¨**: ç”¨æˆ·å¯è‡ªå®šä¹‰å•åœˆè¡¨æ ¼æ˜¾ç¤ºçš„åˆ—ï¼Œä¸å†å›ºå®š9åˆ—
- ğŸ—‚ï¸ **å­—æ®µåˆ†ç»„æ˜¾ç¤º**: æ‰€æœ‰å­—æ®µæŒ‰è¯­ä¹‰åˆ†ç»„ï¼ˆå¿ƒç‡ã€æ­¥é¢‘ã€åŠŸç‡ã€é¾™è±†åŠŸç‡ã€é¾™è±†å†²å‡»åŠ›ç­‰ï¼‰
- ğŸ”½ **åˆ†ç»„å±•å¼€/æŠ˜å **: æ”¯æŒåˆ†ç»„å±•å¼€/æŠ˜å ï¼Œé»˜è®¤å…¨éƒ¨å±•å¼€
- âœ… **å…¨é€‰/å…¨ä¸é€‰**: å¿«æ·æŒ‰é’®æ‰¹é‡é€‰æ‹©å­—æ®µ
- ğŸ’¾ **å­—æ®µé€‰æ‹©æŒä¹…åŒ–**: è¶‹åŠ¿å›¾å’Œå•åœˆè¡¨æ ¼çš„å­—æ®µé€‰æ‹©è‡ªåŠ¨ä¿å­˜åˆ°localStorage
- ğŸ” **è‡ªåŠ¨ç©ºå€¼è¿‡æ»¤**: 100%ä¸ºç©ºçš„å­—æ®µè‡ªåŠ¨éšè—ï¼Œä¸åœ¨é€‰æ‹©å™¨ä¸­æ˜¾ç¤º
- ğŸ“Œ **IQå­—æ®µåˆ†ç»„æ”¯æŒ**: é¾™è±†ã€å¯¼å…¥æ•°æ®ã€æœªåˆ†ç±»IQå­—æ®µè‡ªåŠ¨åˆ†ç»„
- â±ï¸ **ç›¸å¯¹æ—¶é—´æ˜¾ç¤º**: å•åœˆstart_timeæ˜¾ç¤ºä¸ºç›¸å¯¹ç¬¬ä¸€åœˆçš„æ—¶é—´ï¼ˆ+MM:SSæ ¼å¼ï¼‰
- ğŸ¯ **è¶‹åŠ¿å›¾å­—æ®µåˆ†ç»„é‡æ„**: è¶‹åŠ¿å›¾å­—æ®µé€‰æ‹©å™¨ä¹Ÿé‡‡ç”¨åˆ†ç»„æ˜¾ç¤ºï¼Œä¸å•åœˆé€‰æ‹©å™¨ä¿æŒä¸€è‡´

**åŠŸèƒ½è§„æ ¼ï¼š**
- **å­—æ®µåˆ†ç»„é…ç½®**:
  - æ ‡å‡†å­—æ®µ: åŸºç¡€æ•°æ®ã€é…é€Ÿã€å¿ƒç‡ã€æ­¥é¢‘ã€åŠŸç‡ã€æµ·æ‹”/çˆ¬å‡ã€ç¯å¢ƒã€è·‘æ­¥åŠ¨æ€ã€çƒ­é‡
  - IQå­—æ®µ: é¾™è±†åŠŸç‡ã€é¾™è±†å†²å‡»åŠ›ã€é¾™è±†åŠ¨æ€ã€é¾™è±†å…¶ä»–ã€å¯¼å…¥æ•°æ®ã€æœªåˆ†ç±»
  - ç›¸å…³å­—æ®µèšåˆ: avg/maxå­—æ®µåœ¨åŒä¸€ç»„å†…ç›¸é‚»æ˜¾ç¤º
  
- **äº¤äº’è®¾è®¡**:
  - å±•å¼€/æŠ˜å : ç‚¹å‡»åˆ†ç»„æ ‡é¢˜åˆ‡æ¢çŠ¶æ€ï¼Œæ”¯æŒå…¨éƒ¨å±•å¼€/æŠ˜å 
  - å…¨é€‰/å…¨ä¸é€‰: å¿«æ·æŒ‰é’®æ“ä½œæ‰€æœ‰å¯è§å­—æ®µ
  - é»˜è®¤é€‰æ‹©: è¶‹åŠ¿å›¾é»˜è®¤heart_rate+cadenceï¼Œå•åœˆé»˜è®¤5ä¸ªæ ¸å¿ƒå­—æ®µ
  
- **æŒä¹…åŒ–ç­–ç•¥**:
  - localStorageé”®å: `trend_selected_fields`, `lap_selected_fields`
  - è‡ªåŠ¨ä¿å­˜: æ¯æ¬¡é€‰æ‹©å˜åŒ–è‡ªåŠ¨ä¿å­˜
  - é»˜è®¤å›é€€: æ— ä¿å­˜æ•°æ®æ—¶ä½¿ç”¨é¢„å®šä¹‰é»˜è®¤å€¼

**æŠ€æœ¯å®ç°ï¼š**
- `frontend/js/charts.js`: 
  - æ·»åŠ localStorageå·¥å…·å‡½æ•°ï¼ˆsaveFieldSelection, loadFieldSelectionï¼‰
  - å®šä¹‰FIELD_GROUPSå’ŒLAP_FIELD_GROUPSé…ç½®
  - é‡æ„renderUnifiedFieldSelector()æ”¯æŒåˆ†ç»„å’Œæ§åˆ¶æŒ‰é’®
  - æ›´æ–°renderFieldSelector()æ”¯æŒåˆ†ç»„å’ŒæŒä¹…åŒ–
  
- `frontend/js/app.js`:
  - æ·»åŠ extractAvailableLapFields()å­—æ®µæå–å’Œè¿‡æ»¤å‡½æ•°
  - æ·»åŠ renderLapFieldSelector()å•åœˆé€‰æ‹©å™¨æ¸²æŸ“å‡½æ•°
  - é‡æ„renderLapsTable()ä¸ºåŠ¨æ€åˆ—æ¸²æŸ“
  - æ·»åŠ formatRelativeTime()ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
  
- `frontend/index.html`:
  - å•åœˆè¡¨æ ¼ä¸Šæ–¹æ·»åŠ å­—æ®µé€‰æ‹©å™¨å®¹å™¨
  
- `frontend/css/styles.css`:
  - æ·»åŠ å­—æ®µé€‰æ‹©å™¨æ ·å¼ï¼ˆæ§åˆ¶æŒ‰é’®ã€åˆ†ç»„ã€æŠ˜å åŠ¨ç”»ï¼‰
  
- `config.py`: ç‰ˆæœ¬å·æ›´æ–°ä¸º1.7.0
- `fitanalysis.spec`: åŒæ­¥æ›´æ–°ç‰ˆæœ¬å·

**ä»£ç æ”¹è¿›ï¼š**
- ğŸ”§ ç»Ÿä¸€å­—æ®µåˆ†ç»„é…ç½®ï¼Œè¶‹åŠ¿å›¾å’Œå•åœˆè¡¨æ ¼å¤ç”¨ç›¸åŒé€»è¾‘
- ğŸ“ å®Œæ•´çš„å­—æ®µåˆ†ç»„å’Œäº¤äº’æ–‡æ¡£
- ğŸ¨ ä¸€è‡´çš„UIè®¾è®¡è¯­è¨€å’Œäº¤äº’æ¨¡å¼
- â™»ï¸ ä»£ç å¤ç”¨æ€§æå‡ï¼Œå‡å°‘é‡å¤å®ç°

**ç”¨æˆ·ä½“éªŒæå‡ï¼š**
- âœ… å•åœˆè¡¨æ ¼åˆ—æ•°å¯æ§ï¼Œé¿å…åˆ—è¿‡å¤šæˆ–è¿‡å°‘
- âœ… å­—æ®µåˆ†ç»„æé«˜æŸ¥æ‰¾æ•ˆç‡
- âœ… å±•å¼€/æŠ˜å å‡å°‘è§†è§‰å¹²æ‰°
- âœ… é€‰æ‹©æŒä¹…åŒ–é¿å…é‡å¤æ“ä½œ
- âœ… ç©ºå€¼è¿‡æ»¤é¿å…æ— æ„ä¹‰å­—æ®µå¹²æ‰°
- âœ… ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºæ›´ç›´è§‚

**æ–‡ä»¶å˜æ›´ï¼š**
- `agent.md` - æ–°å¢Section 6.2å­—æ®µé€‰æ‹©å™¨ç»„ä»¶è®¾è®¡
- `frontend/js/charts.js` - å­—æ®µåˆ†ç»„é…ç½®å’Œé€‰æ‹©å™¨é‡æ„
- `frontend/js/app.js` - å•åœˆå­—æ®µé€‰æ‹©å™¨å’Œè¡¨æ ¼åŠ¨æ€æ¸²æŸ“
- `frontend/index.html` - å•åœˆé€‰æ‹©å™¨å®¹å™¨
- `frontend/css/styles.css` - å­—æ®µé€‰æ‹©å™¨æ ·å¼
- `config.py` - ç‰ˆæœ¬å·æ›´æ–°
- `fitanalysis.spec` - ç‰ˆæœ¬å·æ›´æ–°
- `RELEASE_CHECKLIST_v1.7.0.md` - å‘å¸ƒæ£€æŸ¥æ¸…å•
- `RELEASE_v1.7.0.md` - ç‰ˆæœ¬å‘å¸ƒè¯´æ˜

**æµ‹è¯•è¦†ç›–ï¼š**
- [ ] æ ‡å‡†å­—æ®µåˆ†ç»„æ˜¾ç¤ºæ­£ç¡®
- [ ] IQå­—æ®µåˆ†ç»„æ˜¾ç¤ºæ­£ç¡®
- [ ] æœªåˆ†ç±»IQå­—æ®µè‡ªåŠ¨å½’ç±»
- [ ] åˆ†ç»„é»˜è®¤å…¨éƒ¨å±•å¼€
- [ ] åˆ†ç»„å±•å¼€/æŠ˜å äº¤äº’æ­£å¸¸
- [ ] å…¨é€‰/å…¨ä¸é€‰æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- [ ] localStorageä¿å­˜å’ŒåŠ è½½æ­£å¸¸
- [ ] é»˜è®¤å€¼å›é€€æ­£å¸¸
- [ ] 100%ç©ºå€¼å­—æ®µè‡ªåŠ¨éšè—
- [ ] è¶‹åŠ¿å›¾å’Œå•åœˆå­—æ®µé€‰æ‹©å™¨ä¸€è‡´æ€§
- [ ] start_timeç›¸å¯¹æ—¶é—´æ ¼å¼æ­£ç¡®
- [ ] å¯¼å‡ºåŠŸèƒ½æ— å½±å“
- [ ] å¤šæ´»åŠ¨åˆ‡æ¢å­—æ®µé€‰æ‹©æ­£ç¡®æ¢å¤

---

### v1.2.0 (2024-12-09)
**æ¶æ„ä¼˜åŒ–ï¼š**
- âœ¨ FR021/US-006: å­—æ®µå•ä½è½¬æ¢ç³»ç»Ÿé‡æ„
  - åˆ›å»ºfield_units.pyæ¨¡å—ï¼ˆ650è¡Œï¼‰
  - é…ç½®åŒ–ç®¡ç†43ä¸ªå­—æ®µçš„å•ä½è½¬æ¢è§„åˆ™
  - åŸºäºFIT SDK Profile.xlsxå®˜æ–¹è§„èŒƒ
  - å®ç°3å±‚è½¬æ¢ç­–ç•¥ï¼šé…ç½®é©±åŠ¨ â†’ å…ƒæ•°æ®éªŒè¯ â†’ æ™ºèƒ½æ£€æµ‹
  
- ğŸ“Š æ”¯æŒå­—æ®µç±»å‹ï¼š
  - 35ä¸ªæ ‡å‡†å­—æ®µï¼šå‚ç›´æŒ¯å¹…ã€æ­¥å¹…ã€è§¦åœ°æ—¶é—´ã€GPSåæ ‡ã€é€Ÿåº¦ã€å¿ƒç‡ã€æ­¥é¢‘ã€åŠŸç‡ã€æµ·æ‹”ã€è·ç¦»ã€å¡è·¯é‡Œç­‰
  - 8ä¸ªIQæ‰©å±•å­—æ®µï¼šé¾™è±†è·‘æ­¥(v_osc, gct, air_timeç­‰)ã€StrydåŠŸç‡è®¡(form_power, leg_spring_stiffness)
  
- ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ï¼š
  - `normalize_field_value()`: ä¸»è½¬æ¢å‡½æ•°ï¼Œæ”¯æŒæ ‡å‡†/IQå­—æ®µ
  - `smart_unit_detection()`: æ™ºèƒ½å•ä½æ£€æµ‹ï¼ŒåŸºäºç”Ÿç†å­¦åˆç†èŒƒå›´
  - `FieldUnitConfig`: æ¯å­—æ®µé…ç½®FITå•ä½ã€æ˜¾ç¤ºå•ä½ã€ç¼©æ”¾å› å­ã€åˆç†èŒƒå›´
  
- ğŸ”§ è½¬æ¢ç¤ºä¾‹ï¼š
  - å‚ç›´æŒ¯å¹…: 79.1mm â†’ 7.91cm (scale=0.1, range=3-20cm)
  - æ­¥å¹…: 1200mm â†’ 1.2m (scale=0.001, range=0.4-2.5m)
  - GPSåæ ‡: semicircles â†’ degrees (scale=180/2^31)
  - æ­¥é¢‘: RPM â†’ SPM (scale=2.0, åŒè„šè®¡æ•°)

**ä»£ç è´¨é‡æå‡ï¼š**
- ğŸ”¨ é‡æ„fit_parser.pyï¼Œç§»é™¤é­”æ•°å®ç°ï¼ˆif value > 30ï¼‰
- ğŸ“ å®Œæ•´çš„å­—æ®µå•ä½é…ç½®å’Œæ³¨é‡Š
- ğŸ§ª å‘åå…¼å®¹ï¼šä¿ç•™normalize_vertical_oscillation()ç­‰ä¾¿æ·å‡½æ•°
- ğŸ“Š æ·»åŠ è½¬æ¢æ—¥å¿—ï¼Œè®°å½•å¼‚å¸¸å€¼å’Œæ™ºèƒ½æ£€æµ‹è¿‡ç¨‹
- âœ… è§£å†³Bug #7ï¼ˆå‚ç›´æŒ¯å¹…å•ä½è½¬æ¢ï¼‰çš„æœ€ç»ˆæ–¹æ¡ˆ

**æŠ€æœ¯å€ºåŠ¡æ¸…ç†ï¼š**
- æ›¿æ¢ç²—ç³™çš„é˜ˆå€¼åˆ¤æ–­ï¼ˆvalue > 30ï¼‰ä¸ºé…ç½®é©±åŠ¨æ–¹æ¡ˆ
- æä¾›å¯æ‰©å±•æ¶æ„ï¼Œæ”¯æŒæœªæ¥æ–°å­—æ®µæ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
- åŸºäºè¿åŠ¨ç”Ÿç†å­¦çš„åˆç†èŒƒå›´éªŒè¯ï¼ˆå‚ç›´æŒ¯å¹…6-12cmæ­£å¸¸ï¼Œ3-20cmèŒƒå›´ï¼‰

**æ–‡ä»¶å˜æ›´ï¼š**
- `backend/field_units.py` - æ–°å¢å­—æ®µå•ä½è½¬æ¢æ¨¡å—
- `backend/fit_parser.py` - é‡æ„å•ä½è½¬æ¢é€»è¾‘
- `agent.md` - æ›´æ–°FR021å’ŒUS-006

**æµ‹è¯•è¦†ç›–ï¼š**
- âœ… field_units.pyè‡ªæµ‹è¯•é€šè¿‡ï¼ˆ3ä¸ªæµ‹è¯•åœºæ™¯ï¼‰
- âœ… verify_vosc_fix.pyéªŒè¯é€šè¿‡ï¼ˆæ ‡å‡†å­—æ®µ7.91cmã€IQå­—æ®µ6.84cmï¼‰
- âœ… backend/test_api.pyå…¨éƒ¨æµ‹è¯•é€šè¿‡ï¼ˆ13/13ï¼‰

---

### v1.2.1 (2024-12-11)
**UIä¼˜åŒ–ï¼š**
- âœ¨ US-009: ç»Ÿä¸€å­—æ®µé€‰æ‹©å™¨UIå¸ƒå±€
  - å¤šæ´»åŠ¨å¯¹æ¯”é¡µé¢å­—æ®µé€‰æ‹©å™¨é‡‡ç”¨æ¨ªå‘ç½‘æ ¼å¸ƒå±€
  - ä¸å•æ´»åŠ¨è¯¦æƒ…é¡µé¢ä¿æŒå®Œå…¨ä¸€è‡´çš„è§†è§‰æ•ˆæœ
  - åˆ†ç»„æ ‡é¢˜ç‹¬å ä¸€è¡Œï¼Œè§†è§‰å±‚æ¬¡æ¸…æ™°

**æŠ€æœ¯å®ç°ï¼š**
- ğŸ“ CSSæ–°å¢40è¡Œä»£ç ï¼š`.field-group`ã€`.field-group-title`ã€ç»Ÿä¸€labelæ ·å¼
- ğŸ”§ JavaScriptä¿®æ”¹2å¤„ï¼šé‡æ„`renderUnifiedFieldSelector()`å‡½æ•°
- ğŸ¨ ç½‘æ ¼å¸ƒå±€ï¼š`grid-template-columns: repeat(auto-fill, minmax(180px, 1fr))`
- ğŸ“ åˆ†ç»„é—´è·ï¼šæ ‡å‡†å­—æ®µå’ŒIQå­—æ®µä¹‹é—´1.5remè§†è§‰é—´éš”

**ç”¨æˆ·ä½“éªŒæ”¹è¿›ï¼š**
- âœ… UIä¸€è‡´æ€§ï¼šå•æ´»åŠ¨å’Œå¤šæ´»åŠ¨é¡µé¢ä½¿ç”¨ç›¸åŒçš„å­—æ®µå¸ƒå±€é£æ ¼
- âœ… å“åº”å¼å¸ƒå±€ï¼šçª—å£ç¼©æ”¾æ—¶å­—æ®µè‡ªåŠ¨æ¢è¡Œ
- âœ… è§†è§‰æ¸…æ™°ï¼šå­—æ®µæ¨ªå‘æ’åˆ—ï¼Œåˆ†ç»„æ ‡é¢˜å æ®æ•´è¡Œ

**æ–‡ä»¶å˜æ›´ï¼š**
- `frontend/css/styles.css` - æ–°å¢å­—æ®µåˆ†ç»„å®¹å™¨æ ·å¼
- `frontend/js/charts.js` - é‡æ„renderUnifiedFieldSelectorå‡½æ•°
- `agent.md` - æ–°å¢US-009ç”¨æˆ·æ•…äº‹

**æµ‹è¯•éªŒè¯ï¼š**
- âœ… PlaywrightéªŒè¯å•æ´»åŠ¨è¯¦æƒ…é¡µå­—æ®µå¸ƒå±€æ­£å¸¸
- âœ… PlaywrightéªŒè¯å¤šæ´»åŠ¨å¯¹æ¯”é¡µå­—æ®µå¸ƒå±€æ­£å¸¸
- âœ… ä¸¤ä¸ªé¡µé¢å­—æ®µé€‰æ‹©å™¨UIå®Œå…¨ä¸€è‡´
- âœ… æ— Bugå‘ç°ï¼ŒåŠŸèƒ½è¿è¡Œç¨³å®š

---

### v1.2.0 (2024-12-09)
**æ¶æ„ä¼˜åŒ–ï¼š**
- âœ¨ FR021/US-006: å­—æ®µå•ä½è½¬æ¢ç³»ç»Ÿé‡æ„
  - åˆ›å»ºfield_units.pyæ¨¡å—ï¼ˆ650è¡Œï¼‰
  - é…ç½®åŒ–ç®¡ç†43ä¸ªå­—æ®µçš„å•ä½è½¬æ¢è§„åˆ™
  - åŸºäºFIT SDK Profile.xlsxå®˜æ–¹è§„èŒƒ
  - å®ç°3å±‚è½¬æ¢ç­–ç•¥ï¼šé…ç½®é©±åŠ¨ â†’ å…ƒæ•°æ®éªŒè¯ â†’ æ™ºèƒ½æ£€æµ‹
  
- ğŸ“Š æ”¯æŒå­—æ®µç±»å‹ï¼š
  - 35ä¸ªæ ‡å‡†å­—æ®µï¼šå‚ç›´æŒ¯å¹…ã€æ­¥å¹…ã€è§¦åœ°æ—¶é—´ã€GPSåæ ‡ã€é€Ÿåº¦ã€å¿ƒç‡ã€æ­¥é¢‘ã€åŠŸç‡ã€æµ·æ‹”ã€è·ç¦»ã€å¡è·¯é‡Œç­‰
  - 8ä¸ªIQæ‰©å±•å­—æ®µï¼šé¾™è±†è·‘æ­¥(v_osc, gct, air_timeç­‰)ã€StrydåŠŸç‡è®¡(form_power, leg_spring_stiffness)
  
- ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ï¼š
  - `normalize_field_value()`: ä¸»è½¬æ¢å‡½æ•°ï¼Œæ”¯æŒæ ‡å‡†/IQå­—æ®µ
  - `smart_unit_detection()`: æ™ºèƒ½å•ä½æ£€æµ‹ï¼ŒåŸºäºç”Ÿç†å­¦åˆç†èŒƒå›´
  - `FieldUnitConfig`: æ¯å­—æ®µé…ç½®FITå•ä½ã€æ˜¾ç¤ºå•ä½ã€ç¼©æ”¾å› å­ã€åˆç†èŒƒå›´
  
- ğŸ”§ è½¬æ¢ç¤ºä¾‹ï¼š
  - å‚ç›´æŒ¯å¹…: 79.1mm â†’ 7.91cm (scale=0.1, range=3-20cm)
  - æ­¥å¹…: 1200mm â†’ 1.2m (scale=0.001, range=0.4-2.5m)
  - GPSåæ ‡: semicircles â†’ degrees (scale=180/2^31)
  - æ­¥é¢‘: RPM â†’ SPM (scale=2.0, åŒè„šè®¡æ•°)

**ä»£ç è´¨é‡æå‡ï¼š**
- ğŸ”¨ é‡æ„fit_parser.pyï¼Œç§»é™¤é­”æ•°å®ç°ï¼ˆif value > 30ï¼‰
- ğŸ“ å®Œæ•´çš„å­—æ®µå•ä½é…ç½®å’Œæ³¨é‡Š
- ğŸ§ª å‘åå…¼å®¹ï¼šä¿ç•™normalize_vertical_oscillation()ç­‰ä¾¿æ·å‡½æ•°
- ğŸ“Š æ·»åŠ è½¬æ¢æ—¥å¿—ï¼Œè®°å½•å¼‚å¸¸å€¼å’Œæ™ºèƒ½æ£€æµ‹è¿‡ç¨‹
- âœ… è§£å†³Bug #7ï¼ˆå‚ç›´æŒ¯å¹…å•ä½è½¬æ¢ï¼‰çš„æœ€ç»ˆæ–¹æ¡ˆ

**æŠ€æœ¯å€ºåŠ¡æ¸…ç†ï¼š**
- æ›¿æ¢ç²—ç³™çš„é˜ˆå€¼åˆ¤æ–­ï¼ˆvalue > 30ï¼‰ä¸ºé…ç½®é©±åŠ¨æ–¹æ¡ˆ
- æä¾›å¯æ‰©å±•æ¶æ„ï¼Œæ”¯æŒæœªæ¥æ–°å­—æ®µæ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
- åŸºäºè¿åŠ¨ç”Ÿç†å­¦çš„åˆç†èŒƒå›´éªŒè¯ï¼ˆå‚ç›´æŒ¯å¹…6-12cmæ­£å¸¸ï¼Œ3-20cmèŒƒå›´ï¼‰

**æ–‡ä»¶å˜æ›´ï¼š**
- `backend/field_units.py` - æ–°å¢å­—æ®µå•ä½è½¬æ¢æ¨¡å—
- `backend/fit_parser.py` - é‡æ„å•ä½è½¬æ¢é€»è¾‘
- `agent.md` - æ›´æ–°FR021å’ŒUS-006

**æµ‹è¯•è¦†ç›–ï¼š**
- âœ… field_units.pyè‡ªæµ‹è¯•é€šè¿‡ï¼ˆ3ä¸ªæµ‹è¯•åœºæ™¯ï¼‰
- âœ… verify_vosc_fix.pyéªŒè¯é€šè¿‡ï¼ˆæ ‡å‡†å­—æ®µ7.91cmã€IQå­—æ®µ6.84cmï¼‰
- âœ… backend/test_api.pyå…¨éƒ¨æµ‹è¯•é€šè¿‡ï¼ˆ13/13ï¼‰

---

### v1.6.0 (2026-01-19)
**ä¸»è¦æ›´æ–°ï¼šmacOSè·¨å¹³å°æ”¯æŒ**

**æ–°å¢åŠŸèƒ½ï¼š**
- ğŸ **macOSå¹³å°æ”¯æŒ**: å®Œæ•´æ”¯æŒmacOSç³»ç»Ÿï¼Œç”Ÿæˆ.app bundleåº”ç”¨ç¨‹åº
- ğŸŒ **è·¨å¹³å°æ„å»ºç³»ç»Ÿ**: è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿï¼Œé€‚é…Windowså’ŒmacOSä¸åŒè·¯å¾„å’Œæ‰“åŒ…é…ç½®
- ğŸš€ **è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨**: åº”ç”¨å¯åŠ¨åè‡ªåŠ¨æ‰“å¼€é»˜è®¤æµè§ˆå™¨è®¿é—®æœåŠ¡ï¼ˆä»…æ‰“åŒ…ç‰ˆæœ¬ï¼‰
- ğŸ“Œ **UIç‰ˆæœ¬å·æ˜¾ç¤º**: é¡µé¢å³ä¸‹è§’æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬å·ï¼Œæ ·å¼ç»Ÿä¸€ï¼ˆé»‘è‰²å°å­—ï¼‰
- ğŸ”§ **ç«¯å£å˜æ›´**: æœåŠ¡ç«¯å£ä»8080æ›´æ”¹ä¸º8082ï¼Œé¿å…å¸¸è§ç«¯å£å†²çª
- ğŸ¨ **åº”ç”¨å›¾æ ‡**: ä½¿ç”¨è·‘æ­¥ä¸»é¢˜å›¾æ ‡ï¼ˆapp_icon.ico/icnsï¼‰ï¼Œå¤šåˆ†è¾¨ç‡æ”¯æŒ
- ğŸŒ **å…¨è‹±æ–‡ç•Œé¢**: å¯åŠ¨çª—å£ã€è„šæœ¬æ–‡ä»¶åã€æ„å»ºæ—¥å¿—å…¨éƒ¨ä½¿ç”¨è‹±æ–‡ï¼Œç¡®ä¿è·¨å¹³å°ä¸€è‡´æ€§

**æŠ€æœ¯å®ç°ï¼š**
- `config.py`: ç‰ˆæœ¬å·æ›´æ–°ä¸º1.6.0
- `backend/main.py`: 
  - æ·»åŠ `/api/version`æ¥å£è¿”å›ç‰ˆæœ¬ä¿¡æ¯
  - ç«¯å£ä»8080æ”¹ä¸º8082
  - æ·»åŠ è‹±æ–‡å¯åŠ¨ä¿¡æ¯è¾“å‡ºï¼ˆWindows/macOSä¸€è‡´ï¼‰
  - æ·»åŠ è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨åŠŸèƒ½ï¼ˆwebbrowser + threadingï¼‰
- `frontend/index.html`: åº•éƒ¨æ·»åŠ ç‰ˆæœ¬å·æ˜¾ç¤ºåŒºåŸŸ
- `frontend/js/app.js`: åˆå§‹åŒ–æ—¶è°ƒç”¨APIæ˜¾ç¤ºç‰ˆæœ¬å·
- `frontend/css/styles.css`: ç‰ˆæœ¬å·æ ·å¼ï¼ˆå³ä¸‹è§’å®šä½ã€é»‘è‰²ã€å°å­—ä½“ï¼‰
- `build.py`: 
  - ä»config.pyè‡ªåŠ¨è¯»å–ç‰ˆæœ¬å·
  - å¹³å°æ£€æµ‹ï¼ˆplatform.system()ï¼‰
  - Windowsç”Ÿæˆstart_server.batï¼ˆè‹±æ–‡ï¼‰å’Œ.exeï¼ˆå¸¦å›¾æ ‡ï¼‰
  - macOSç”Ÿæˆ.app bundleï¼ˆå¸¦å›¾æ ‡ã€ä¿ç•™ç»ˆç«¯çª—å£ï¼‰
  - æ„å»ºæ—¥å¿—å…¨è‹±æ–‡
- `fitanalysis.spec`: 
  - å¹³å°æ£€æµ‹é€»è¾‘
  - Windowsé…ç½®icon='app_icon.ico'
  - macOSæ·»åŠ BUNDLEé…ç½®ï¼ˆconsole=True, icon='app_icon.icns', è‹±æ–‡å…ƒæ•°æ®ï¼‰
- `run.sh`: macOSå¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬ï¼ˆUTF-8ç¼–ç ï¼Œè‹±æ–‡æç¤ºï¼Œ8082ç«¯å£ï¼‰
- `README.md`: æ·»åŠ macOSå®‰è£…è¯´æ˜å’ŒGatekeeperå¤„ç†æ–¹æ³•

**è·¨å¹³å°ä¸€è‡´æ€§ä¿è¯ï¼š**
- âœ… Windowså’ŒmacOSåŠŸèƒ½å®Œå…¨ä¸€è‡´
- âœ… UIç•Œé¢å’Œç‰ˆæœ¬å·æ˜¾ç¤ºå®Œå…¨ä¸€è‡´
- âœ… å¯åŠ¨çª—å£æ–‡æœ¬å®Œå…¨ä¸€è‡´ï¼ˆè‹±æ–‡ï¼‰
- âœ… ä½¿ç”¨ç›¸åŒæµ‹è¯•æ•°æ®éªŒè¯

**åˆ†å‘åŒ…ï¼š**
- `fitanalysis-v1.6.0-windows.zip`: Windowså¯æ‰§è¡Œç¨‹åºåŒ…
- `fitanalysis-v1.6.0-macos.zip`: macOSåº”ç”¨ç¨‹åºåŒ…

**æµ‹è¯•è¦†ç›–ï¼š**
- âœ… Windowsæ„å»ºå’ŒåŠŸèƒ½æµ‹è¯•
- âœ… macOSæ„å»ºå’ŒåŠŸèƒ½æµ‹è¯•
- âœ… è·¨å¹³å°ä¸€è‡´æ€§å¯¹æ¯”æµ‹è¯•
- âœ… ç«¯å£8082æ­£å¸¸è®¿é—®
- âœ… è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨åŠŸèƒ½
- âœ… UIç‰ˆæœ¬å·æ˜¾ç¤ºæ­£ç¡®
- âœ… åº”ç”¨å›¾æ ‡æ˜¾ç¤ºæ­£å¸¸

---

### v1.1.0 (2024-12-09)
**æ–°å¢åŠŸèƒ½ï¼š**
- âœ¨ FR020/US-005: é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ´»åŠ¨åˆ—è¡¨
  - æ‰“å¼€ç½‘é¡µå³è‡ªåŠ¨å±•ç¤ºæ‰€æœ‰æœ¬åœ°æ´»åŠ¨
  - æ— éœ€æ‰‹åŠ¨æ“ä½œå³å¯æµè§ˆæ´»åŠ¨è®°å½•
  - æ”¯æŒç©ºçŠ¶æ€å‹å¥½æç¤º
  
- âœ¨ FR019/US-004: å¤šæ´»åŠ¨å•å­—æ®µå¯¹æ¯”åŠŸèƒ½
  - å­—æ®µé€‰æ‹©æ”¹ä¸ºå•é€‰æ¨¡å¼ï¼ˆradioï¼‰
  - æ¯ä¸ªæ´»åŠ¨ä½¿ç”¨ç‹¬ç«‹é¢œè‰²æ›²çº¿
  - å›¾è¡¨æ ‡é¢˜åŠ¨æ€æ˜¾ç¤ºå½“å‰å­—æ®µ
  - Legendè‡ªåŠ¨æ·»åŠ æ—¥æœŸ_æ–‡ä»¶IDå‰ç¼€
  - ç®€åŒ–Yè½´é…ç½®ï¼Œæå‡æ€§èƒ½

**ä»£ç ä¼˜åŒ–ï¼š**
- ğŸ”§ ä¿®å¤app.jsä¸­çš„äº‹ä»¶ç›‘å¬å™¨é”™è¯¯
- ğŸ”§ ç§»é™¤updateCompareæŒ‰é’®å¼•ç”¨ï¼ˆå·²ä¸å­˜åœ¨çš„å…ƒç´ ï¼‰
- ğŸ”§ ç®€åŒ–å­—æ®µé€‰æ‹©é€»è¾‘ï¼Œç§»é™¤å¤æ‚çš„å¤šYè½´é…ç½®
- ğŸ”§ ä¼˜åŒ–å›¾è¡¨æ¸²æŸ“æ€§èƒ½

**æ–‡ä»¶å˜æ›´ï¼š**
- `frontend/index.html` - æ›´æ–°å¯¹æ¯”é¡µé¢UIç»“æ„
- `frontend/js/app.js` - ä¿®å¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé»˜è®¤åŠ è½½æ´»åŠ¨
- `frontend/js/charts.js` - å®ç°å•å­—æ®µå¯¹æ¯”é€»è¾‘

**æµ‹è¯•è¦†ç›–ï¼š**
- âœ… é¡µé¢è‡ªåŠ¨åŠ è½½æ´»åŠ¨åˆ—è¡¨
- âœ… å¤šæ´»åŠ¨å•å­—æ®µå¯¹æ¯”ï¼ˆé…é€Ÿã€å¿ƒç‡ç­‰ï¼‰
- âœ… å­—æ®µåˆ‡æ¢åŠŸèƒ½
- âœ… æ—¶é—´/è·ç¦»å¯¹é½
- âœ… æ—¥æœŸå‰ç¼€æ˜¾ç¤º

---

### v1.0.0 (2024-12-08)
**åˆå§‹ç‰ˆæœ¬åŠŸèƒ½ï¼š**
- âœ… FR001-FR017: åŸºç¡€åŠŸèƒ½å®Œæ•´å®ç°
- âœ… FITæ–‡ä»¶ä¸Šä¼ è§£æ
- âœ… æ´»åŠ¨åˆ—è¡¨ç®¡ç†ï¼ˆæ’åºã€è¿‡æ»¤ã€åˆ†é¡µï¼‰
- âœ… å•æ´»åŠ¨è¯¦æƒ…æŸ¥çœ‹
- âœ… ç§’çº§è¶‹åŠ¿å›¾ï¼ˆå¤šå­—æ®µå åŠ ï¼‰
- âœ… æ¯åœˆæ±‡æ€»è¡¨æ ¼
- âœ… å¤šæ´»åŠ¨å¤šå­—æ®µçŸ©é˜µå¯¹æ¯”
- âœ… CSVå¯¼å‡ºï¼ˆmerged/categorizedï¼‰
- âœ… Xè½´æ—¶é—´/è·ç¦»åˆ‡æ¢
- âœ… é…é€Ÿå­—æ®µè‡ªåŠ¨è½¬æ¢
- âœ… IQæ‰©å±•å­—æ®µæ”¯æŒï¼ˆé¾™è±†è·‘æ­¥dr_å­—æ®µï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1.0  
**æœ€åæ›´æ–°**: 2024-12-09  
**è´Ÿè´£äºº**: AI Assistant  

**æ›´æ–°æ—¥å¿—**:
- 2024-12-09: å®ç° FR019/US-004 å¤šæ´»åŠ¨å•å­—æ®µå¯¹æ¯”åŠŸèƒ½
- 2024-12-09: å®ç° FR020/US-005 é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ´»åŠ¨åˆ—è¡¨
- 2024-12-09: å®ç° FR018 å¤šæ´»åŠ¨æ—¥æœŸæ—¶é—´æˆ³åŠŸèƒ½
- 2024-12-08: åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæˆ FR001-FR017 æ‰€æœ‰åŠŸèƒ½

---

## 14. ç³»ç»Ÿæ¶æ„ä¸æ•°æ®æµ (System Architecture & Data Flow)

æœ¬èŠ‚é€šè¿‡Mermaidå›¾è¡¨å±•ç¤ºç³»ç»Ÿçš„å®Œæ•´å·¥ä½œæµç¨‹ï¼Œå¸®åŠ©ç†è§£æ•°æ®å¦‚ä½•ä»FITæ–‡ä»¶æµè½¬åˆ°å‰ç«¯æ˜¾ç¤ºã€‚

### 14.1 æ•´ä½“ç³»ç»Ÿæ•°æ®æµ

```mermaid
graph TB
    subgraph "1. æ–‡ä»¶ä¸Šä¼ ä¸è§£æ"
        A[ç”¨æˆ·ä¸Šä¼ FITæ–‡ä»¶] --> B[FastAPIæ¥æ”¶æ–‡ä»¶]
        B --> C{æ–‡ä»¶ç±»å‹æ£€æŸ¥}
        C -->|å•FIT| D[fit_parser.parse_fit_bytes]
        C -->|FIT+CSV| E[hr_csv_merge.merge_hr_data]
        E --> D
    end
    
    subgraph "2. FITè§£æå±‚ (fit_parser.py)"
        D --> F[éå†FITæ¶ˆæ¯]
        F --> G[parse_record_message<br/>ç§’çº§æ•°æ®]
        F --> H[parse_lap_message<br/>åœˆæ±‡æ€»æ•°æ®]
        F --> I[parse_session_message<br/>æ•´ä½“æ±‡æ€»]
        
        G --> J[extract_developer_fields<br/>IQæ‰©å±•å­—æ®µ]
        H --> J
        I --> J
    end
    
    subgraph "3. æ•°æ®å­˜å‚¨å±‚ (data_store.py)"
        G --> K[Activity.records<br/>List[Record]]
        H --> L[Activity.laps<br/>List[Lap]]
        I --> M[Activity.session<br/>Session]
        J --> N[iq_fields: Dict]
        
        K --> O[ä¿å­˜åˆ°data/activities/]
        L --> O
        M --> O
        N --> O
    end
    
    subgraph "4. APIå“åº”å±‚ (main.py)"
        O --> P[GET /api/activity/:id]
        P --> Q[è¯»å–JSONæ–‡ä»¶]
        Q --> R[è¿”å›Activityå¯¹è±¡]
    end
    
    subgraph "5. å‰ç«¯å±•ç¤ºå±‚ (frontend/)"
        R --> S[app.jsæ¥æ”¶æ•°æ®]
        S --> T[renderActivityDetail]
        T --> U[æ¸²æŸ“Sessionæ±‡æ€»]
        T --> V[renderLapsTable<br/>å•åœˆè¡¨æ ¼]
        T --> W[renderChart<br/>è¶‹åŠ¿å›¾]
        
        V --> X[formatFieldValue<br/>å•ä½è½¬æ¢]
        W --> X
        X --> Y[speed_to_pace<br/>é…é€Ÿè½¬æ¢]
        X --> Z[è®¾å¤‡é…ç½®æŸ¥è¯¢<br/>deviceFieldsMap]
    end
    
    subgraph "6. ç”¨æˆ·äº¤äº’"
        U --> AA[Sessionæ‘˜è¦å¡ç‰‡]
        V --> AB[åŠ¨æ€åˆ—è¡¨æ ¼]
        W --> AC[Chart.jså›¾è¡¨]
        
        AB --> AD[å­—æ®µé€‰æ‹©å™¨<br/>å‹¾é€‰æ˜¾ç¤ºå­—æ®µ]
        AC --> AD
        AD --> AE[localStorageæŒä¹…åŒ–]
    end
    
    style A fill:#e1f5ff
    style D fill:#fff4e1
    style O fill:#e8f5e9
    style R fill:#f3e5f5
    style X fill:#ffe0b2
    style AA fill:#e0f2f1
    style AB fill:#e0f2f1
    style AC fill:#e0f2f1
```

**è¯´æ˜**:
- ğŸ”µ è“è‰²: ç”¨æˆ·å…¥å£
- ğŸŸ¡ é»„è‰²: è§£æå±‚
- ğŸŸ¢ ç»¿è‰²: å­˜å‚¨å±‚
- ğŸŸ£ ç´«è‰²: APIå±‚
- ğŸŸ  æ©™è‰²: è½¬æ¢å±‚
- ğŸŸ¦ é’è‰²: å±•ç¤ºå±‚

---

### 14.2 FITæ–‡ä»¶è§£ææµæ°´çº¿

```mermaid
graph LR
    subgraph "FITæ¶ˆæ¯ç±»å‹"
        A[FIT File Messages] --> B[recordæ¶ˆæ¯<br/>æ—¶é—´åºåˆ—]
        A --> C[lapæ¶ˆæ¯<br/>åœˆæ±‡æ€»]
        A --> D[sessionæ¶ˆæ¯<br/>æ•´ä½“æ±‡æ€»]
        A --> E[device_infoæ¶ˆæ¯<br/>è®¾å¤‡ä¿¡æ¯]
    end
    
    subgraph "Recordè§£æ (ç§’çº§)"
        B --> F[æ ‡å‡†å­—æ®µ<br/>heart_rate, speed, cadence...]
        B --> G[GPSåæ ‡<br/>position_lat, position_long]
        B --> H[è¿åŠ¨åŠ¨æ€<br/>vertical_oscillation...]
        B --> I[IQæ‰©å±•å­—æ®µ<br/>dr_*, é¾™è±†ä¼ æ„Ÿå™¨æ•°æ®]
        
        F --> J[normalize_field_value<br/>å•ä½è½¬æ¢]
        G --> K[semicircles_to_degrees<br/>GPSè½¬æ¢]
        H --> J
        I --> L[DR_FIELD_MAPPING<br/>å­—æ®µæ˜ å°„]
    end
    
    subgraph "Lapè§£æ (åœˆæ±‡æ€»)"
        C --> M[æ ‡å‡†æ±‡æ€»<br/>avg_speed, avg_hr...]
        C --> N[åœˆIQå­—æ®µ<br/>dr_lap_avg_*]
        
        M --> O[ç›´æ¥è¯»å–FITå€¼<br/>éè®¡ç®—]
        N --> P[extract_developer_fields<br/>Lapæ¶ˆæ¯]
    end
    
    subgraph "Sessionè§£æ (æ•´ä½“)"
        D --> Q[Sessionæ±‡æ€»<br/>total_distance, avg_pace...]
        D --> R[SessionIQå­—æ®µ<br/>dr_s_avg_*]
        
        Q --> S[ç›´æ¥è¯»å–FITå€¼]
        R --> T[extract_developer_fields<br/>Sessionæ¶ˆæ¯]
    end
    
    subgraph "æ•°æ®æ¨¡å‹"
        J --> U[Recordå¯¹è±¡<br/>iq_fields: Dict]
        K --> U
        L --> U
        
        O --> V[Lapå¯¹è±¡<br/>iq_fields: Dict]
        P --> V
        
        S --> W[Sessionå¯¹è±¡<br/>iq_fields: Dict]
        T --> W
    end
    
    style B fill:#e3f2fd
    style C fill:#fff3e0
    style D fill:#f1f8e9
    style I fill:#fce4ec
    style N fill:#fce4ec
    style R fill:#fce4ec
```

**å…³é”®ç‚¹**:
- Record: 2000-3000æ¡/æ´»åŠ¨ï¼Œç”¨äºè¶‹åŠ¿å›¾
- Lap: 5-10æ¡/æ´»åŠ¨ï¼Œç”¨äºå•åœˆåˆ†æ
- Session: 1æ¡/æ´»åŠ¨ï¼Œç”¨äºæ•´ä½“æ‘˜è¦
- IQå­—æ®µåœ¨æ‰€æœ‰3ä¸ªçº§åˆ«éƒ½å¯èƒ½å­˜åœ¨

---

### 14.3 å­—æ®µç±»å‹åˆ†ç±»å†³ç­–æ ‘

```mermaid
graph TD
    A[å­—æ®µåç§°] --> B{ä»¥dr_å¼€å¤´?}
    B -->|æ˜¯| C{IQæ‰©å±•å­—æ®µ}
    B -->|å¦| D{æ ‡å‡†å­—æ®µ}
    
    C --> E{åŒ…å«lap_avg_?}
    C --> F{åŒ…å«s_avg_?}
    C --> G{æ— å‰ç¼€ä¿®é¥°}
    
    E --> H[åœˆçº§IQèšåˆ<br/>dr_lap_avg_speed]
    F --> I[Sessionçº§IQèšåˆ<br/>dr_s_avg_cadence]
    G --> J[Recordçº§IQå³æ—¶å€¼<br/>dr_speed, dr_gct]
    
    D --> K{åŒ…å«avg_/max_/min_?}
    K -->|æ˜¯| L{æ¥æºæ¶ˆæ¯ç±»å‹}
    K -->|å¦| M[Recordå³æ—¶æµ‹é‡<br/>speed, heart_rate]
    
    L -->|Lap| N[Lapæ ‡å‡†èšåˆ<br/>avg_speed, max_hr]
    L -->|Session| O[Sessionæ ‡å‡†èšåˆ<br/>avg_cadence, total_distance]
    
    subgraph "å‰ç«¯å±•ç¤ºç­–ç•¥"
        H --> P[ğŸ§® æ ‡è®°ä¸ºè®¡ç®—å€¼<br/>ä½¿ç”¨formatFieldValue]
        I --> P
        N --> P
        O --> P
        
        J --> Q[æ— æ ‡è®°<br/>å³æ—¶æµ‹é‡å€¼]
        M --> Q
    end
    
    subgraph "å•ä½è½¬æ¢è§„åˆ™"
        P --> R{å­—æ®µååŒ…å«speed?}
        R -->|æ˜¯| S[speed_to_pace<br/>m/s â†’ min/km]
        R -->|å¦| T{æŸ¥è¯¢deviceFieldsMap}
        
        T -->|requires_conversion=true| U[åº”ç”¨è½¬æ¢è§„åˆ™]
        T -->|å¦| V[ä½¿ç”¨åŸå§‹å€¼+ç²¾åº¦æ§åˆ¶]
        
        Q --> W[æ ¹æ®å­—æ®µç±»å‹è½¬æ¢<br/>GPS/å‚ç›´æŒ¯å¹…/æ­¥å¹…ç­‰]
    end
    
    style C fill:#fce4ec
    style H fill:#ffe0b2
    style I fill:#ffe0b2
    style N fill:#ffe0b2
    style O fill:#ffe0b2
    style S fill:#c5e1a5
```

**å†³ç­–ä¾æ®**:
1. **å‰ç¼€è¯†åˆ«**: `dr_` = IQå­—æ®µ, æ— å‰ç¼€ = æ ‡å‡†å­—æ®µ
2. **èšåˆæ¨¡å¼**: `_avg_`, `_max_`, `_min_` = è®¡ç®—å€¼
3. **çº§åˆ«è¯†åˆ«**: `lap_avg_` = Lapçº§, `s_avg_` = Sessionçº§
4. **è½¬æ¢è§„åˆ™**: é€Ÿåº¦ç±» â†’ é…é€Ÿï¼Œå…¶ä»–æŸ¥é…ç½®è¡¨

---

### 14.4 å•ä½è½¬æ¢ä¸æ ¼å¼åŒ–æµç¨‹

```mermaid
graph TB
    subgraph "è¡¨æ ¼æ¸²æŸ“å…¥å£"
        A[renderLapsTable] --> B[éå†selectedFields]
        B --> C{è·å–å­—æ®µå€¼}
        C -->|æ ‡å‡†å­—æ®µ| D[lap.avg_speed]
        C -->|IQå­—æ®µ| E[lap.iq_fields.dr_lap_avg_speed]
    end
    
    subgraph "æ ¼å¼åŒ–å†³ç­– (Bug #29ä¿®å¤)"
        D --> F{ç‰¹æ®Šæ ¼å¼å­—æ®µ?}
        E --> F
        
        F -->|start_time| G[formatRelativeTime<br/>+MM:SS]
        F -->|total_elapsed_time| H[formatDuration<br/>HH:MM:SS]
        F -->|total_distance| I[é™¤ä»¥1000<br/>X.XX km]
        F -->|total_ascent/descent| J[å››èˆäº”å…¥<br/>XXX m]
        F -->|æ•°å€¼ç±»å‹| K{è°ƒç”¨formatFieldValue}
    end
    
    subgraph "formatFieldValueæ ¸å¿ƒé€»è¾‘"
        K --> L{fieldName.includes<br/>'speed'?}
        L -->|æ˜¯| M[speed_to_pace<br/>1000/value/60]
        L -->|å¦| N{æŸ¥è¯¢deviceFieldsMap}
        
        N -->|æ‰¾åˆ°é…ç½®| O{requires_conversion?}
        O -->|true| P[åº”ç”¨è‡ªå®šä¹‰è½¬æ¢]
        O -->|false| Q[åº”ç”¨precisionç²¾åº¦]
        
        N -->|æœªæ‰¾åˆ°| Q
    end
    
    subgraph "speed_to_paceå®ç°"
        M --> R[è®¡ç®—: 1000 / speedMs]
        R --> S[åˆ†ç¦»åˆ†é’Ÿå’Œç§’]
        S --> T[æ ¼å¼åŒ–: M:SS]
        T --> U[è¿”å›: '6:05']
    end
    
    subgraph "è¡¨æ ¼å•å…ƒæ ¼æ¸²æŸ“"
        G --> V[<td>+0:00</td>]
        H --> V
        I --> V
        J --> V
        M --> V
        P --> V
        Q --> V
        U --> V
    end
    
    subgraph "è¡¨å¤´æ¸²æŸ“ (èšåˆæ ‡è®°)"
        B --> W{å­—æ®µååŒ¹é…<br/>èšåˆæ¨¡å¼?}
        W -->|/(avgï½œmaxï½œmin)_/| X[æ·»åŠ ğŸ§®å›¾æ ‡]
        W -->|å¦| Y[ä»…æ˜¾ç¤ºå­—æ®µæ ‡ç­¾]
        
        X --> Z[<th>ğŸ§® åœˆå¹³å‡é…é€Ÿ</th>]
        Y --> Z
    end
    
    style A fill:#e1f5ff
    style K fill:#fff4e1
    style M fill:#c5e1a5
    style U fill:#a5d6a7
    style X fill:#ffe0b2
```

**è½¬æ¢ä¼˜å…ˆçº§**:
1. ç‰¹æ®Šæ ¼å¼å­—æ®µï¼ˆæ—¶é—´ã€è·ç¦»ï¼‰â†’ ç›´æ¥è½¬æ¢
2. é€Ÿåº¦å­—æ®µï¼ˆå«speedå…³é”®å­—ï¼‰â†’ speed_to_pace()
3. è®¾å¤‡é…ç½®è½¬æ¢ â†’ deviceFieldsMapæŸ¥è¯¢
4. é»˜è®¤ç²¾åº¦æ§åˆ¶ â†’ toFixed(2)

---

### 14.5 è®¾å¤‡æ˜ å°„ç³»ç»Ÿå·¥ä½œæµ

```mermaid
graph TB
    subgraph "å¯åŠ¨æ—¶åˆå§‹åŒ–"
        A[æµè§ˆå™¨åŠ è½½] --> B[DOMContentLoaded]
        B --> C[loadDeviceFieldConfigs]
        C --> D[GET /api/device-mappings]
        D --> E[DeviceRegistry.get_all_devices_config]
    end
    
    subgraph "åç«¯è®¾å¤‡æ³¨å†Œè¡¨"
        E --> F[DRAGONRUN_FIELDS<br/>23ä¸ªå­—æ®µé…ç½®]
        F --> G[FieldMappingå¯¹è±¡<br/>display_label, unit, category...]
        
        E --> H[DRAGONRUN_FIELD_ALIASES<br/>25ä¸ªåˆ«åæ˜ å°„]
        H --> I[dr_stance â†’ dr_gct<br/>dr_vert_osc â†’ dr_v_osc]
    end
    
    subgraph "å‰ç«¯å…¨å±€Mapæ„å»º"
        G --> J[window.deviceFieldsMap<br/>Map<string, FieldConfig>]
        I --> J
        
        J --> K[dr_speed: {<br/>  display_label: 'é…é€Ÿ'<br/>  unit: 'min/km'<br/>  storage_unit: 'm/s'<br/>  requires_conversion: true<br/>}]
    end
    
    subgraph "å­—æ®µæ ‡ç­¾æŸ¥è¯¢"
        L[getFieldLabel<br/>'dr_gct'] --> M{deviceFieldsMap<br/>.has('dr_gct')?}
        M -->|æ‰¾åˆ°| N[è¿”å›full_label<br/>'DR_è§¦åœ°æ—¶é—´ (ms)']
        M -->|æœªæ‰¾åˆ°| O{æ˜¯Lapå­—æ®µ?<br/>dr_lap_avg_*}
        
        O -->|æ˜¯| P[æå–åŸºç¡€å­—æ®µ<br/>dr_lap_avg_speed â†’ dr_speed]
        P --> Q[æŸ¥è¯¢åŸºç¡€å­—æ®µé…ç½®]
        Q --> R[ç”Ÿæˆæ ‡ç­¾<br/>'åœˆå¹³å‡é…é€Ÿ (min/km)']
        
        O -->|å¦| S[å›é€€ç¡¬ç¼–ç <br/>FIELD_LABELSæˆ–åŸå§‹å]
    end
    
    subgraph "æ•°å€¼è½¬æ¢æŸ¥è¯¢"
        T[formatFieldValue<br/>'dr_speed', 2.5] --> U{deviceFieldsMap<br/>.get('dr_speed')}
        U --> V{requires_conversion?}
        V -->|true| W[æ£€æŸ¥å­—æ®µç±»å‹]
        W -->|speedç±»| X[speed_to_pace(2.5)<br/>è¿”å› '6:40']
        V -->|false| Y[value.toFixed(precision)<br/>è¿”å› '2.50']
    end
    
    subgraph "å­—æ®µå½’ä¸€åŒ– (åç«¯)"
        Z[FITå­—æ®µ: dr_stance] --> AA[DeviceRegistry<br/>.normalize_field_name]
        AA --> AB[æŸ¥è¯¢DRAGONRUN_FIELD_ALIASES]
        AB --> AC[è¿”å›: dr_gct]
        AC --> AD[å­˜å…¥Activity.laps[].iq_fields<br/>{'dr_gct': 245}]
    end
    
    style C fill:#e1f5ff
    style J fill:#fff4e1
    style N fill:#c5e1a5
    style X fill:#c5e1a5
    style AC fill:#f8bbd0
```

**ç³»ç»Ÿä¼˜åŠ¿**:
- âœ… å‰ç«¯é›¶ç¡¬ç¼–ç ï¼šæ‰€æœ‰æ ‡ç­¾/å•ä½ä»åç«¯é…ç½®
- âœ… æ‰©å±•æ€§å¼ºï¼šæ–°å¢è®¾å¤‡åªéœ€åç«¯æ³¨å†Œ
- âœ… ä¸€è‡´æ€§ä¿è¯ï¼šåˆ«åç»Ÿä¸€å½’ä¸€åŒ–
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼šå…¨å±€Map O(1)æŸ¥è¯¢

---

### 14.6 æµ‹è¯•è¦†ç›–çŸ©é˜µ

```mermaid
graph TB
    subgraph "æµ‹è¯•ç»´åº¦åˆ’åˆ†"
        A[æµ‹è¯•ç”¨ä¾‹] --> B[æ•°æ®çº§åˆ«ç»´åº¦]
        A --> C[å­—æ®µç±»å‹ç»´åº¦]
        A --> D[è½¬æ¢è§„åˆ™ç»´åº¦]
    end
    
    subgraph "æ•°æ®çº§åˆ« (3ç±»)"
        B --> E[Recordçº§<br/>ç§’çº§æ—¶é—´åºåˆ—]
        B --> F[Lapçº§<br/>åœˆæ±‡æ€»ç»Ÿè®¡]
        B --> G[Sessionçº§<br/>æ•´ä½“æ±‡æ€»]
    end
    
    subgraph "å­—æ®µç±»å‹ (4ç±»)"
        C --> H[æ ‡å‡†å­—æ®µ<br/>FIT SDKå®šä¹‰]
        C --> I[æ ‡å‡†èšåˆ<br/>avg_*, max_*, min_*]
        C --> J[IQå³æ—¶å€¼<br/>dr_speed, dr_gct]
        C --> K[IQèšåˆ<br/>dr_lap_avg_*, dr_s_avg_*]
    end
    
    subgraph "è½¬æ¢è§„åˆ™ (6ç±»)"
        D --> L[é€Ÿåº¦â†’é…é€Ÿ<br/>m/s â†’ min/km]
        D --> M[æ­¥é¢‘Ã—2<br/>RPM â†’ SPM]
        D --> N[å‚ç›´æŒ¯å¹…Ã·10<br/>mm â†’ cm]
        D --> O[æ­¥å¹…Ã·1000<br/>mm â†’ m]
        D --> P[GPSåæ ‡<br/>semicircles â†’ degrees]
        D --> Q[æ— è½¬æ¢<br/>å¿ƒç‡/åŠŸç‡/æ¸©åº¦]
    end
    
    subgraph "æµ‹è¯•çŸ©é˜µ (3Ã—4Ã—6 = 72ç»„åˆ)"
        E --> R[Record Ã— æ ‡å‡† Ã— é€Ÿåº¦â†’é…é€Ÿ<br/>âœ“ speed field conversion]
        F --> S[Lap Ã— IQèšåˆ Ã— é€Ÿåº¦â†’é…é€Ÿ<br/>âœ“ dr_lap_avg_speed â†’ pace]
        G --> T[Session Ã— æ ‡å‡†èšåˆ Ã— æ­¥é¢‘Ã—2<br/>âœ“ avg_cadence RPMâ†’SPM]
        
        E --> U[Record Ã— IQå³æ—¶ Ã— å‚ç›´æŒ¯å¹…<br/>âœ“ dr_v_osc mmâ†’cm]
        F --> V[Lap Ã— æ ‡å‡†èšåˆ Ã— æ­¥å¹…<br/>âœ“ avg_step_length mmâ†’m]
        G --> W[Session Ã— IQèšåˆ Ã— GPS<br/>âœ“ (å¦‚æœå­˜åœ¨)]
    end
    
    subgraph "æµ‹è¯•è¦†ç›–ç‡è¦æ±‚"
        R --> X[100% é€Ÿåº¦å­—æ®µå¿…æµ‹]
        S --> X
        T --> Y[100% èšåˆå­—æ®µå¿…æµ‹]
        V --> Y
        U --> Z[90% IQå­—æ®µæŠ½æ ·]
        W --> Z
        
        X --> AA[æµ‹è¯•è„šæœ¬<br/>test_lap_calculated_fields.py]
        Y --> AA
        Z --> AA
    end
    
    subgraph "éªŒè¯æ ‡å‡†"
        AA --> AB{å‰ç«¯æ˜¾ç¤ºæ ¼å¼}
        AB -->|é…é€Ÿ| AC[æ­£åˆ™: \\d+:\\d{2}]
        AB -->|æ•°å€¼| AD[ç²¾åº¦æ£€æŸ¥: Â±0.01]
        AB -->|GPS| AE[èŒƒå›´æ£€æŸ¥: -180~180]
        
        AA --> AF{åç«¯å­˜å‚¨å•ä½}
        AF --> AG[m/s for speed]
        AF --> AH[RPM for cadence]
        AF --> AI[mm for vertical_osc]
    end
    
    style X fill:#ffcdd2
    style Y fill:#ffcdd2
    style Z fill:#fff9c4
    style AA fill:#c5e1a5
```

**æµ‹è¯•ç­–ç•¥**:
1. **ä¼˜å…ˆçº§P0**: é€Ÿåº¦â†’é…é€Ÿè½¬æ¢ï¼ˆç”¨æˆ·æœ€æ•æ„Ÿï¼‰
2. **ä¼˜å…ˆçº§P1**: æ‰€æœ‰èšåˆå­—æ®µï¼ˆå½±å“ç»Ÿè®¡å‡†ç¡®æ€§ï¼‰
3. **ä¼˜å…ˆçº§P2**: IQå­—æ®µå•ä½è½¬æ¢ï¼ˆè®¾å¤‡å…¼å®¹æ€§ï¼‰
4. **è¦†ç›–ç‡ç›®æ ‡**: 100% å…³é”®è·¯å¾„ï¼Œ90% æ€»ä½“

**æµ‹è¯•æ•°æ®æ¥æº**:
- çœŸå®FITæ–‡ä»¶ï¼š`data/activities/546218476_ACTIVITY.fit`
- æ¨¡æ‹Ÿæ•°æ®ï¼š`test/fixtures/mock_lap_data.json`
- è¾¹ç•Œç”¨ä¾‹ï¼šæå€¼ã€ç©ºå€¼ã€å¼‚å¸¸å•ä½

---

### 14.7 CSVå¯¼å‡ºæ•°æ®æµ

```mermaid
graph LR
    subgraph "å¯¼å‡ºå…¥å£"
        A[ç”¨æˆ·ç‚¹å‡»å¯¼å‡º] --> B{é€‰æ‹©æ¨¡å¼}
        B -->|merged| C[å•æ–‡ä»¶æ¨¡å¼]
        B -->|categorized| D[åˆ†æ–‡ä»¶æ¨¡å¼]
    end
    
    subgraph "Mergedæ¨¡å¼"
        C --> E[csv_exporter.export_merged]
        E --> F[éå†æ‰€æœ‰records]
        F --> G[record_to_dict]
        G --> H[æ ¼å¼åŒ–å­—æ®µ<br/>format_pace, format_timestamp]
        H --> I[å•CSVæ–‡ä»¶<br/>2000+è¡Œ]
    end
    
    subgraph "Categorizedæ¨¡å¼"
        D --> J[csv_exporter.export_categorized]
        J --> K[records.csv<br/>ç§’çº§æ•°æ®]
        J --> L[laps.csv<br/>åœˆæ±‡æ€»]
        J --> M[session.csv<br/>æ•´ä½“æ±‡æ€»]
        
        K --> N[record_to_dict Ã— N]
        L --> O[lap_to_dict Ã— N]
        M --> P[session_to_dict Ã— 1]
    end
    
    subgraph "å­—æ®µæ˜ å°„"
        N --> Q[elapsed_time_sec<br/>heart_rate_bpm<br/>speed_mps<br/>iq_dr_speed]
        O --> R[avg_speed_mps<br/>avg_pace_min_km<br/>iq_dr_lap_avg_speed]
        P --> S[total_distance_km<br/>avg_cadence_spm<br/>iq_dr_s_avg_cadence]
    end
    
    subgraph "å•ä½è½¬æ¢ (åç«¯)"
        Q --> T[speedå·²æ˜¯m/s<br/>ç›´æ¥å†™å…¥]
        R --> U[avg_paceè°ƒç”¨<br/>format_pace]
        U --> V['6:05' æ ¼å¼å­—ç¬¦ä¸²]
        
        Q --> W[IQå­—æ®µ<br/>iq_å‰ç¼€ + åŸå€¼]
        R --> W
        S --> W
    end
    
    subgraph "å‹ç¼©æ‰“åŒ…"
        I --> X[activity_merged.csv]
        K --> Y[activity_categorized.zip]
        L --> Y
        M --> Y
        
        X --> Z[æµè§ˆå™¨ä¸‹è½½]
        Y --> Z
    end
    
    style E fill:#e1f5ff
    style J fill:#fff4e1
    style U fill:#c5e1a5
    style W fill:#f8bbd0
```

**CSVå¯¼å‡ºç‰¹ç‚¹**:
- âœ… åç«¯å®Œæˆæ‰€æœ‰å•ä½è½¬æ¢ï¼ˆä¸å‰ç«¯åˆ†ç¦»ï¼‰
- âœ… IQå­—æ®µä¿æŒåŸå§‹å€¼ï¼ˆä¾¿äºäºŒæ¬¡åˆ†æï¼‰
- âœ… é…é€Ÿå­—æ®µåŒæ—¶æä¾›m/så’Œmin/km
- âœ… æ—¶é—´æˆ³ç»Ÿä¸€ISO 8601æ ¼å¼

---

### 14.8 æµ‹è¯•ç­–ç•¥ä¸è¦†ç›–ç‡è¦æ±‚

#### 14.8.1 æµ‹è¯•åˆ†å±‚æ¶æ„

```mermaid
graph TB
    subgraph "æµ‹è¯•é‡‘å­—å¡”"
        A[å•å…ƒæµ‹è¯•<br/>Unit Tests] --> B[é›†æˆæµ‹è¯•<br/>Integration Tests]
        B --> C[ç«¯åˆ°ç«¯æµ‹è¯•<br/>E2E Tests]
    end
    
    subgraph "å•å…ƒæµ‹è¯• (70%)"
        A --> D[åç«¯å•ä½è½¬æ¢<br/>field_units.py]
        A --> E[FITå­—æ®µè§£æ<br/>fit_parser.py]
        A --> F[è®¾å¤‡æ˜ å°„æŸ¥è¯¢<br/>device_mappings.py]
        A --> G[å‰ç«¯æ ¼å¼åŒ–å‡½æ•°<br/>charts.jsæ¨¡æ‹Ÿ]
    end
    
    subgraph "é›†æˆæµ‹è¯• (20%)"
        B --> H[APIç«¯ç‚¹æµ‹è¯•<br/>test_api_device_mappings.py]
        B --> I[è®¡ç®—å­—æ®µéªŒè¯<br/>test_lap_calculated_fields.py]
        B --> J[CSVå¯¼å‡ºå®Œæ•´æ€§<br/>test_csv_exporter.py]
    end
    
    subgraph "E2Eæµ‹è¯• (10%)"
        C --> K[Playwrightæµè§ˆå™¨æµ‹è¯•<br/>MCPè‡ªåŠ¨åŒ–]
        C --> L[å®Œæ•´ç”¨æˆ·æµç¨‹<br/>ä¸Šä¼ â†’å±•ç¤ºâ†’å¯¼å‡º]
    end
    
    subgraph "è¦†ç›–ç‡ç›®æ ‡"
        D --> M[100% å…³é”®è½¬æ¢]
        E --> M
        I --> M
        
        F --> N[90% é…ç½®æŸ¥è¯¢]
        H --> N
        
        G --> O[80% å‰ç«¯å‡½æ•°]
        K --> O
    end
    
    style M fill:#c5e1a5
    style N fill:#fff9c4
    style O fill:#ffccbc
```

#### 14.8.2 è®¡ç®—å­—æ®µæµ‹è¯•çŸ©é˜µ

**æµ‹è¯•æ–‡ä»¶**: `test/backend/test_lap_calculated_fields.py`

```mermaid
graph TB
    subgraph "æµ‹è¯•ç»´åº¦"
        A[æµ‹è¯•ç”¨ä¾‹] --> B[æ•°æ®çº§åˆ«<br/>Record/Lap/Session]
        A --> C[å­—æ®µç±»å‹<br/>Standard/IQ]
        A --> D[è½¬æ¢ç±»å‹<br/>6ç§è§„åˆ™]
    end
    
    subgraph "å¿…æµ‹ç»„åˆ (P0ä¼˜å…ˆçº§)"
        B --> E[Lapæ ‡å‡†èšåˆ]
        C --> F[IQ Lapèšåˆ]
        D --> G[é€Ÿåº¦â†’é…é€Ÿ]
        
        E --> H[test_lap_avg_speed_is_valid<br/>âœ“ èŒƒå›´: 0.5-10 m/s]
        E --> I[test_lap_avg_cadence_is_doubled<br/>âœ“ SPM: 140-220]
        E --> J[test_lap_avg_vertical_oscillation_unit<br/>âœ“ cm: 3-20]
        
        F --> K[test_iq_lap_avg_speed_value_range<br/>âœ“ dr_lap_avg_speed: 0.5-10]
        F --> L[test_iq_fields_naming_pattern<br/>âœ“ dr_lap_avg_*, dr_s_avg_*]
        
        G --> M[test_speed_to_pace_conversion<br/>âœ“ 2.74â†’'6:05']
        G --> N[test_user_reported_bug_case<br/>âœ“ Bug #29: 2.76â†’'6:01']
    end
    
    subgraph "è¾¹ç•Œæµ‹è¯• (P1ä¼˜å…ˆçº§)"
        H --> O[æå€¼: 0.5 m/s, 10 m/s]
        I --> P[è¾¹ç•Œ: 140 SPM, 220 SPM]
        J --> Q[å¼‚å¸¸: null, 0, è´Ÿæ•°]
    end
    
    subgraph "å›å½’æµ‹è¯• (P2ä¼˜å…ˆçº§)"
        K --> R[max >= avgæ£€æŸ¥<br/>test_lap_max_speed_greater_than_avg]
        L --> S[å­—æ®µä¸€è‡´æ€§<br/>test_lap_data_exists]
        M --> T[æ ¼å¼éªŒè¯<br/>test_pace_format_validation]
    end
    
    subgraph "è¦†ç›–ç‡è¦æ±‚"
        H --> U[âœ… 100% é€Ÿåº¦å­—æ®µ]
        I --> U
        K --> U
        M --> U
        N --> U
        
        J --> V[âœ… 100% èšåˆå­—æ®µ]
        R --> V
        
        O --> W[âœ… 90% è¾¹ç•Œæƒ…å†µ]
        P --> W
        Q --> W
    end
    
    style U fill:#c5e1a5
    style V fill:#c5e1a5
    style W fill:#fff9c4
```

**æ‰§è¡Œæ ‡å‡†**:
- â— **100% Pass å¼ºåˆ¶è¦æ±‚**ï¼šä»»ä½•æµ‹è¯•å¤±è´¥ç¦æ­¢æäº¤ä»£ç 
- â±ï¸ **æ‰§è¡Œæ—¶é—´**: < 5ç§’ï¼ˆå•å…ƒæµ‹è¯•åº”å¿«é€Ÿåé¦ˆï¼‰
- ğŸ“Š **è¦†ç›–ç‡ç›‘æ§**: pytest-covç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- ğŸ”„ **CIé›†æˆ**: æ¯æ¬¡PRè‡ªåŠ¨è¿è¡Œæµ‹è¯•å¥—ä»¶

#### 14.8.3 æµ‹è¯•æ•°æ®ç®¡ç†

```mermaid
graph LR
    subgraph "çœŸå®æ•°æ®"
        A[data/activities/<br/>546218476_ACTIVITY.fit] --> B[å®Œæ•´FITæ–‡ä»¶<br/>2410æ¡record, 7ä¸ªlap]
        B --> C[ç”¨äºé›†æˆæµ‹è¯•<br/>çœŸå®åœºæ™¯éªŒè¯]
    end
    
    subgraph "Mockæ•°æ®"
        D[test/fixtures/<br/>mock_lap_data.json] --> E[ç²¾ç®€Lapæ•°æ®<br/>5æ¡å…¸å‹åœˆ]
        E --> F[ç”¨äºå•å…ƒæµ‹è¯•<br/>å¿«é€ŸéªŒè¯]
    end
    
    subgraph "è¾¹ç•Œæ•°æ®"
        G[test/fixtures/<br/>edge_cases.json] --> H[æå€¼æµ‹è¯•<br/>null, 0, æå¤§æå°]
        H --> I[å¼‚å¸¸å¤„ç†éªŒè¯]
    end
    
    subgraph "æµ‹è¯•æ‰§è¡Œ"
        C --> J[pytest fixture<br/>sample_activity]
        F --> K[pytest fixture<br/>mock_laps]
        I --> L[pytest parametrize<br/>è¾¹ç•Œå€¼å‚æ•°åŒ–]
        
        J --> M[test_lap_calculated_fields.py]
        K --> M
        L --> M
    end
    
    style B fill:#e1f5ff
    style E fill:#fff4e1
    style H fill:#ffccbc
    style M fill:#c5e1a5
```

**æ•°æ®ç»´æŠ¤åŸåˆ™**:
1. **çœŸå®ä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨çœŸå®FITæ–‡ä»¶æµ‹è¯•
2. **Mockè¡¥å……**: Mockæ•°æ®è¦†ç›–çœŸå®æ•°æ®æ— æ³•è§¦å‘çš„è¾¹ç•Œæƒ…å†µ
3. **ç‰ˆæœ¬æ§åˆ¶**: æµ‹è¯•æ•°æ®çº³å…¥Gitï¼Œç¡®ä¿å¯å¤ç°
4. **éšç§ä¿æŠ¤**: çœŸå®æ•°æ®è„±æ•å¤„ç†ï¼ˆGPSåæ ‡æ¨¡ç³ŠåŒ–ï¼‰

#### 14.8.4 å‰ç«¯æµ‹è¯•ç­–ç•¥

**æ–‡ä»¶**: `frontend/js/charts.test.js`

```mermaid
graph TB
    subgraph "å‰ç«¯å•å…ƒæµ‹è¯•"
        A[charts.test.js] --> B[formatFieldValueæµ‹è¯•]
        A --> C[speed_to_paceæµ‹è¯•]
        A --> D[getFieldLabelæµ‹è¯•]
        A --> E[èšåˆå­—æ®µæ£€æµ‹æµ‹è¯•]
    end
    
    subgraph "æ¨¡æ‹Ÿç¯å¢ƒ"
        B --> F[window.deviceFieldsMap<br/>Mockè®¾å¤‡é…ç½®]
        C --> G[JavaScriptå‡½æ•°<br/>ç›´æ¥è°ƒç”¨]
        D --> F
        E --> H[æ­£åˆ™æ¨¡å¼æµ‹è¯•<br/>/(avgï½œmaxï½œmin)_/]
    end
    
    subgraph "æµ‹è¯•ç”¨ä¾‹"
        F --> I[test_dr_speed_requires_conversion<br/>âœ“ æŸ¥è¯¢é…ç½®è¿”å›true]
        G --> J[test_speed_to_pace_2_76<br/>âœ“ Bug #29: 2.76â†’'6:01']
        F --> K[test_lap_label_generation<br/>âœ“ dr_lap_avg_speedâ†’'åœˆå¹³å‡é…é€Ÿ']
        H --> L[test_aggregate_pattern_matches<br/>âœ“ avg_speedåŒ¹é…, speedä¸åŒ¹é…]
    end
    
    subgraph "æµè§ˆå™¨æ‰§è¡Œ"
        I --> M[æµè§ˆå™¨æ§åˆ¶å°<br/>æ‰‹åŠ¨è¿è¡Œ]
        J --> M
        K --> M
        L --> M
        
        M --> N[TestRunner.summary<br/>æ˜¾ç¤ºPass/Fail]
    end
    
    subgraph "è‡ªåŠ¨åŒ–éªŒè¯"
        I --> O[Playwright MCP<br/>mcp_playwright_browser_run_code]
        O --> P[æ³¨å…¥charts.test.js]
        P --> Q[æ‰§è¡Œæµ‹è¯•å¹¶è¿”å›ç»“æœ]
        Q --> R[CIæµæ°´çº¿éªŒè¯]
    end
    
    style M fill:#e1f5ff
    style N fill:#c5e1a5
    style R fill:#c5e1a5
```

**å‰ç«¯æµ‹è¯•é™åˆ¶**:
- âš ï¸ æ— æ³•ç›´æ¥è®¿é—®DOMï¼ˆéœ€Playwrightç¯å¢ƒï¼‰
- âš ï¸ deviceFieldsMapä¾èµ–åç«¯APIï¼ˆéœ€Mockï¼‰
- âœ… çº¯å‡½æ•°æ˜“æµ‹ï¼šspeed_to_pace, formatFieldValue
- âœ… æ­£åˆ™æ¨¡å¼å¯ç‹¬ç«‹æµ‹è¯•

#### 14.8.5 Bug #29 ä¸“é¡¹æµ‹è¯•

**å›å½’é˜²æŠ¤**: ç¡®ä¿IQ Lapèšåˆå­—æ®µæ˜¾ç¤ºé—®é¢˜ä¸å†å¤ç°

```mermaid
graph TB
    subgraph "Bugå¤ç°æ¡ä»¶"
        A[ä¸Šä¼ å«IQæ•°æ®çš„FIT] --> B[æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…]
        B --> C[å‹¾é€‰iq_dr_lap_avg_speed]
        C --> D[è§‚å¯Ÿå•åœˆè¡¨æ ¼]
    end
    
    subgraph "é¢„æœŸè¡Œä¸º"
        D --> E{é…é€Ÿæ ¼å¼?}
        E -->|âœ“æ­£ç¡®| F["6:01" (M:SSæ ¼å¼)]
        E -->|âœ—é”™è¯¯| G["2.76" (åŸå§‹m/så€¼)]
    end
    
    subgraph "è‡ªåŠ¨åŒ–éªŒè¯"
        A --> H[test_user_reported_bug_case]
        H --> I[è¾“å…¥: 2.76 m/s]
        I --> J[è°ƒç”¨: speed_to_pace]
        J --> K[æ–­è¨€: ç»“æœåŒ¹é…/\d+:\d{2}/]
        K --> L[æ–­è¨€: ç»“æœ != "2.76"]
    end
    
    subgraph "Playwright E2E"
        A --> M[mcp_playwrightä¸Šä¼ FIT]
        M --> N[browser_clické€‰æ‹©IQå­—æ®µ]
        N --> O[browser_run_codeæå–è¡¨æ ¼]
        O --> P[éªŒè¯: innerTextåŒ¹é…é…é€Ÿæ ¼å¼]
    end
    
    subgraph "æµ‹è¯•æ•°æ®"
        Q[çœŸå®ç”¨æˆ·æ•°æ®] --> R[Lap 1: 2.76 m/s â†’ 6:01]
        R --> S[Lap 2: 2.79 m/s â†’ 5:58]
        S --> T[Lap 3: 2.77 m/s â†’ 6:01]
        
        Q --> U[é¢„æœŸè¡¨æ ¼HTML]
        U --> V[<td>6:01</td>]
        V --> W[<th>ğŸ§® åœˆå¹³å‡é…é€Ÿ</th>]
    end
    
    style F fill:#c5e1a5
    style G fill:#ffcdd2
    style K fill:#c5e1a5
    style P fill:#c5e1a5
```

**å›å½’æµ‹è¯•æ¸…å•**:
- [x] åç«¯å•ä½æµ‹è¯•: `test_iq_lap_avg_speed_value_range`
- [x] å‰ç«¯è½¬æ¢æµ‹è¯•: `test_speed_to_pace_conversion`
- [x] Bugæ¡ˆä¾‹æµ‹è¯•: `test_user_reported_bug_case`
- [x] æ¨¡å¼æ£€æµ‹æµ‹è¯•: `test_aggregate_pattern_matching`
- [ ] Playwright E2E: ä¸Šä¼ â†’é€‰æ‹©â†’éªŒè¯è¡¨æ ¼
- [ ] æˆªå›¾å¯¹æ¯”: ä¿®å¤å‰åè§†è§‰å›å½’æµ‹è¯•

#### 14.8.6 æŒç»­é›†æˆæµæ°´çº¿

```mermaid
graph LR
    subgraph "ä»£ç æäº¤"
        A[git push] --> B[GitHub Actionsè§¦å‘]
    end
    
    subgraph "åç«¯æµ‹è¯•"
        B --> C[pytest backend/**]
        C --> D[test_lap_calculated_fields.py]
        C --> E[test_device_mappings.py]
        C --> F[test_api.py]
        
        D --> G{100% Pass?}
        E --> G
        F --> G
    end
    
    subgraph "å‰ç«¯æµ‹è¯•"
        B --> H[å¯åŠ¨å¼€å‘æœåŠ¡å™¨]
        H --> I[Playwrightè¿æ¥]
        I --> J[æ‰§è¡Œcharts.test.js]
        J --> K{æ‰€æœ‰æµ‹è¯•Pass?}
    end
    
    subgraph "è¦†ç›–ç‡æ£€æŸ¥"
        G -->|Pass| L[pytest-covç”ŸæˆæŠ¥å‘Š]
        L --> M{è¦†ç›–ç‡ >= 90%?}
    end
    
    subgraph "éƒ¨ç½²å†³ç­–"
        M -->|Yes| N[æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶<br/>python build.py]
        K -->|Pass| N
        
        N --> O[æ‰“åŒ…åˆ†å‘]
        O --> P[Release v1.X.0]
    end
    
    subgraph "å¤±è´¥å¤„ç†"
        G -->|Fail| Q[âŒ é˜»æ­¢åˆå¹¶]
        K -->|Fail| Q
        M -->|No| Q
        
        Q --> R[é€šçŸ¥å¼€å‘è€…]
        R --> S[ä¿®å¤é—®é¢˜]
        S --> A
    end
    
    style G fill:#fff9c4
    style K fill:#fff9c4
    style M fill:#fff9c4
    style N fill:#c5e1a5
    style Q fill:#ffcdd2
```

**CIé…ç½®è¦æ±‚**:
- ğŸ Python 3.8+
- ğŸ“¦ ä¾èµ–: pytest, pytest-cov, fitdecode, pydantic
- ğŸŒ æµè§ˆå™¨: Chromium for Playwright
- â±ï¸ è¶…æ—¶: æ€»è®¡< 10åˆ†é’Ÿ
- ğŸ“Š æŠ¥å‘Š: HTMLè¦†ç›–ç‡æŠ¥å‘Š + JUnit XML

#### 14.8.7 æµ‹è¯•æ‰§è¡Œå‘½ä»¤

```bash
# åç«¯å•å…ƒæµ‹è¯•ï¼ˆå¿«é€Ÿåé¦ˆï¼‰
pytest test/backend/test_lap_calculated_fields.py -v

# æ‰€æœ‰åç«¯æµ‹è¯•
pytest test/backend/ -v --cov=backend --cov-report=html

# å‰ç«¯æµ‹è¯•ï¼ˆéœ€æµè§ˆå™¨ç¯å¢ƒï¼‰
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python -m backend.main

# 2. åœ¨æµè§ˆå™¨æ§åˆ¶å°åŠ è½½å¹¶è¿è¡Œ
# æ‰“å¼€ http://localhost:8082
# æ§åˆ¶å°ç²˜è´´ frontend/js/charts.test.js å†…å®¹

# é›†æˆæµ‹è¯•ï¼ˆéœ€çœŸå®FITæ–‡ä»¶ï¼‰
pytest test/integration/ -v

# Playwright E2Eæµ‹è¯•
# ï¼ˆé€šè¿‡MCPå·¥å…·æ‰‹åŠ¨è§¦å‘æˆ–CIè‡ªåŠ¨æ‰§è¡Œï¼‰
```

**æœ¬åœ°å¼€å‘å·¥ä½œæµ**:
1. ä¿®æ”¹ä»£ç  â†’ è¿è¡Œå¯¹åº”å•å…ƒæµ‹è¯• â†’ ç¡®ä¿Pass
2. æäº¤å‰ â†’ è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ â†’ 100% Pass
3. æ¨é€ä»£ç  â†’ CIè‡ªåŠ¨éªŒè¯ â†’ é€šè¿‡ååˆå¹¶

**æµ‹è¯•å¤±è´¥å¤„ç†**:
- ğŸ” æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯: `pytest -v --tb=long`
- ğŸ› è¿›å…¥è°ƒè¯•æ¨¡å¼: `pytest --pdb`
- ğŸ“Š æ£€æŸ¥è¦†ç›–ç‡ç¼ºå¤±: `pytest --cov-report=term-missing`

---

> è¿™æ˜¯ä¸€ä¸ªæ´»æ–‡æ¡£ï¼Œéšç€é¡¹ç›®è¿›å±•ä¼šæŒç»­æ›´æ–°å’Œå®Œå–„ã€‚

