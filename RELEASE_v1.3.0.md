# FIT跑步数据分析器 v1.3.0 发布说明

**发布日期**: 2025-12-11  
**版本号**: v1.3.0

## 📦 发布说明

本次发布主要修复了多个IQ扩展字段显示和功能问题，完善了多活动对比功能，提升了用户体验。

## 🐛 Bug修复

### Bug #11: 多活动对比字段选择器缺少IQ扩展字段分组
- **问题**: US-008重构后，多活动对比页面只显示"标准字段"分组，缺少"IQ扩展字段 (龙豆)"分组
- **修复**: 
  - 在`loadCompareFieldSelector()`中添加IQ字段收集逻辑
  - 改进`separateFieldTypes()`字段分类逻辑
- **影响**: 多活动对比功能现在可以正确选择和对比IQ字段

### Bug #12: 多活动对比IQ字段标签映射缺失
- **问题**: 部分IQ字段显示原始字段名而非中文标签（如"DR_dr at"、"DR_dr vert osc"）
- **修复**: 
  - 在`IQ_FIELD_LABELS`中添加`dr_at`和`dr_vert_osc`的映射
  - 移除旧版本无前缀字段映射，避免重复
- **影响**: 所有IQ字段现在都显示正确的中文标签

### Bug #13: 单活动详情页IQ字段无法绘制
- **问题**: 单活动详情页虽然显示IQ字段，但选中后无法在图表中绘制
- **根本原因**: 单活动和多活动页面的字段前缀不一致
- **修复**: 
  - 统一字段前缀处理，单活动页面也使用`iq_`前缀
  - 修复`getFieldLabel`函数的标签映射逻辑
- **影响**: 单活动详情页现在可以正常绘制IQ字段曲线

## ✨ 改进内容

### IQ字段显示优化
- ✅ 所有IQ字段都有正确的中文标签
- ✅ 完整支持8个龙豆DR字段：
  1. DR_腾空时间 (ms)
  2. DR_步频 (spm)
  3. DR_距离 (m)
  4. DR_触地时间 (ms)
  5. DR_速度 (m/s)
  6. DR_步幅 (cm)
  7. DR_垂直冲击峰值 (g)
  8. DR_垂直振幅 (cm)

### 用户体验提升
- ✅ 单活动和多活动页面字段选择器体验一致
- ✅ 图表图例显示准确的中文标签
- ✅ IQ字段数据正确从`iq_fields`中读取

## 📋 完整功能列表

### 数据解析
- ✅ 支持标准FIT字段解析（15个字段）
- ✅ 支持IQ扩展字段解析（8个DR字段）
- ✅ 智能单位转换和数据规范化

### 单活动分析
- ✅ 活动概览（距离、时长、配速、心率等）
- ✅ 趋势图可视化（标准字段 + IQ字段）
- ✅ X轴切换（时间/距离）
- ✅ 每圈数据展示
- ✅ CSV数据导出

### 多活动对比
- ✅ 多活动选择和对比
- ✅ 字段分组显示（标准字段 + IQ扩展字段）
- ✅ 对齐方式选择（时间/距离）
- ✅ 单字段多活动对比

## 🔧 技术改进

### 代码质量
- 统一了单活动和多活动的字段处理逻辑
- 完善了IQ字段标签映射配置
- 改进了字段分类和识别机制

### 测试覆盖
- 使用Playwright进行UI自动化测试
- 完整的Bug追踪和验证流程
- 详细的BUGS.md文档记录

## 📝 已知限制

- 现有FIT文件仅包含8个旧版DR字段
- 需要完整DragonValue 22字段FIT文件进行全面验证
- 新增字段（dr_timestamp、功率、冲击力等）暂未实际测试

## 🔗 相关文档

- `BUGS.md` - Bug追踪记录
- `agent.md` - 功能需求和实现记录
- `README.md` - 使用说明

## 📦 升级说明

从v1.2.0升级到v1.3.0：
1. 备份现有data目录（如需保留数据）
2. 替换所有程序文件
3. 重启服务器
4. 已有活动数据会自动兼容

## 🙏 致谢

感谢所有测试和反馈的用户！
